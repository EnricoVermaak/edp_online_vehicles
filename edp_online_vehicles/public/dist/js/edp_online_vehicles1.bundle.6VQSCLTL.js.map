{
  "version": 3,
  "sources": ["../../../../../apps/edp_online_vehicles/edp_online_vehicles/public/js/attach.js"],
  "sourcesContent": ["frappe.ui.form.ControlAttach = class ControlAttach extends (\n\tfrappe.ui.form.ControlData\n) {\n\tmake_input() {\n\t\tlet me = this;\n\t\tthis.$input = $('<button class=\"btn btn-default btn-sm btn-attach\">')\n\t\t\t.html(__(\"Attach\"))\n\t\t\t.prependTo(me.input_area)\n\t\t\t.on({\n\t\t\t\tclick: function () {\n\t\t\t\t\tme.on_attach_click();\n\t\t\t\t},\n\t\t\t\tattach_doc_image: function () {\n\t\t\t\t\tme.on_attach_doc_image();\n\t\t\t\t},\n\t\t\t});\n\t\tthis.$value = $(\n\t\t\t`<div class=\"attached-file flex justify-between align-center\">\n\t\t\t\t<div class=\"ellipsis\">\n\t\t\t\t${frappe.utils.icon(\"es-line-link\", \"sm\")}\n\t\t\t\t\t<a class=\"attached-file-link\" target=\"_blank\"></a>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<a class=\"btn btn-xs btn-default\" data-action=\"reload_attachment\">${__(\"Reload File\")}</a>\n\t\t\t\t\t<a class=\"btn btn-xs btn-default\" data-action=\"clear_attachment\">${__(\"Clear\")}</a>\n\t\t\t\t</div>\n\t\t\t</div>`,\n\t\t)\n\t\t\t.prependTo(me.input_area)\n\t\t\t.toggle(false);\n\t\tthis.input = this.$input.get(0);\n\t\tthis.set_input_attributes();\n\t\tthis.has_input = true;\n\n\t\tfrappe.utils.bind_actions_with_object(this.$value, this);\n\t\tthis.toggle_reload_button();\n\t}\n\tclear_attachment() {\n\t\tlet me = this;\n\t\tif (this.frm) {\n\t\t\tme.parse_validate_and_set_in_model(null);\n\t\t\tme.refresh();\n\t\t\tme.frm.attachments.remove_attachment_by_filename(\n\t\t\t\tme.value,\n\t\t\t\tasync () => {\n\t\t\t\t\tawait me.parse_validate_and_set_in_model(null);\n\t\t\t\t\tme.refresh();\n\t\t\t\t\tif (\n\t\t\t\t\t\tcur_frm.doc.doctype != \"Vehicles Order\" &&\n\t\t\t\t\t\tcur_frm.doc.doctype != \"Dealer Claims\"\n\t\t\t\t\t) {\n\t\t\t\t\t\tme.frm.doc.docstatus == 1\n\t\t\t\t\t\t\t? me.frm.save(\"Update\")\n\t\t\t\t\t\t\t: me.frm.save();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\t\t} else {\n\t\t\tthis.dataurl = null;\n\t\t\tthis.fileobj = null;\n\t\t\tthis.set_input(null);\n\t\t\tthis.parse_validate_and_set_in_model(null);\n\t\t\tthis.refresh();\n\t\t}\n\t}\n\treload_attachment() {\n\t\tif (this.file_uploader) {\n\t\t\tthis.file_uploader.uploader.upload_files();\n\t\t}\n\t}\n\ton_attach_click() {\n\t\tthis.set_upload_options();\n\t\tthis.file_uploader = new frappe.ui.FileUploader(this.upload_options);\n\t}\n\ton_attach_doc_image() {\n\t\tthis.set_upload_options();\n\t\tthis.upload_options.restrictions.allowed_file_types = [\"image/*\"];\n\t\tthis.file_uploader = new frappe.ui.FileUploader(this.upload_options);\n\t}\n\tset_upload_options() {\n\t\tlet options = {\n\t\t\tallow_multiple: false,\n\t\t\ton_success: (file) => {\n\t\t\t\tthis.on_upload_complete(file);\n\t\t\t\tthis.toggle_reload_button();\n\t\t\t},\n\t\t\trestrictions: {},\n\t\t};\n\n\t\tif (this.frm) {\n\t\t\toptions.doctype = this.frm.doctype;\n\t\t\toptions.docname = this.frm.docname;\n\t\t\toptions.fieldname = this.df.fieldname;\n\t\t\toptions.make_attachments_public =\n\t\t\t\tthis.frm.meta.make_attachments_public;\n\t\t}\n\n\t\tif (this.df.options) {\n\t\t\tObject.assign(options, this.df.options);\n\t\t}\n\t\tthis.upload_options = options;\n\t}\n\n\tset_input(value, dataurl) {\n\t\tthis.last_value = this.value;\n\t\tthis.value = value;\n\t\tif (this.value) {\n\t\t\tthis.$input.toggle(false);\n\t\t\t// value can also be using this format: FILENAME,DATA_URL\n\t\t\t// Important: We have to be careful because normal filenames may also contain \",\"\n\t\t\tlet file_url_parts = this.value.match(/^([^:]+),(.+):(.+)$/);\n\t\t\tlet filename;\n\t\t\tif (file_url_parts) {\n\t\t\t\tfilename = file_url_parts[1];\n\t\t\t\tdataurl = file_url_parts[2] + \":\" + file_url_parts[3];\n\t\t\t}\n\t\t\tthis.$value\n\t\t\t\t.toggle(true)\n\t\t\t\t.find(\".attached-file-link\")\n\t\t\t\t.html(filename || this.value)\n\t\t\t\t.attr(\"href\", dataurl || this.value);\n\t\t} else {\n\t\t\tthis.$input.toggle(true);\n\t\t\tthis.$value.toggle(false);\n\t\t}\n\t}\n\n\tget_value() {\n\t\treturn this.value || null;\n\t}\n\n\tasync on_upload_complete(attachment) {\n\t\tif (this.frm) {\n\t\t\tawait this.parse_validate_and_set_in_model(attachment.file_url);\n\t\t\tthis.frm.attachments.update_attachment(attachment);\n\t\t\tif (cur_frm.doc.doctype != \"Vehicles Order\") {\n\t\t\t\tthis.frm.doc.docstatus == 1\n\t\t\t\t\t? this.frm.save(\"Update\")\n\t\t\t\t\t: this.frm.save();\n\t\t\t}\n\t\t}\n\t\tthis.set_value(attachment.file_url);\n\t}\n\n\ttoggle_reload_button() {\n\t\tthis.$value\n\t\t\t.find('[data-action=\"reload_attachment\"]')\n\t\t\t.toggle(\n\t\t\t\tthis.file_uploader &&\n\t\t\t\t\tthis.file_uploader.uploader.files.length > 0,\n\t\t\t);\n\t}\n};\n"],
  "mappings": "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",
  "names": []
}
