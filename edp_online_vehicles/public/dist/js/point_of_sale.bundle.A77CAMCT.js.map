{
  "version": 3,
  "sources": ["../../../../../apps/erpnext/node_modules/onscan.js/onscan.js", "../../../../../apps/edp_online_vehicles/edp_online_vehicles/edp_online_vehicles/page/part_order_1/pos_item_selector.js", "../../../../../apps/edp_online_vehicles/edp_online_vehicles/edp_online_vehicles/page/part_order_1/pos_item_cart.js", "../../../../../apps/edp_online_vehicles/edp_online_vehicles/edp_online_vehicles/page/part_order_1/pos_item_details.js", "../../../../../apps/edp_online_vehicles/edp_online_vehicles/edp_online_vehicles/page/part_order_1/pos_number_pad.js", "../../../../../apps/edp_online_vehicles/edp_online_vehicles/edp_online_vehicles/page/part_order_1/pos_payment.js", "../../../../../apps/edp_online_vehicles/edp_online_vehicles/edp_online_vehicles/page/part_order_1/pos_past_order_list.js", "../../../../../apps/edp_online_vehicles/edp_online_vehicles/edp_online_vehicles/page/part_order_1/pos_past_order_summary.js", "../../../../../apps/edp_online_vehicles/edp_online_vehicles/edp_online_vehicles/page/part_order_1/pos_controller.js"],
  "sourcesContent": ["/*\n * onScan.js - scan-events for hardware barcodes scanners in javascript\n */\n;(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define(factory()) :\n    global.onScan = factory()\n}(this, (function () {\n\tvar onScan = {\t\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @param Object oOptions\n\t\t * @return self\n\t\t */\n\t\tattachTo: function(oDomElement, oOptions) {\n\t\n\t\t\tif(oDomElement.scannerDetectionData !== undefined){\n\t\t\t\tthrow new Error(\"onScan.js is already initialized for DOM element \" + oDomElement);\n\t\t\t}\n\t\n\t\t\tvar oDefaults = {\n\t\t\t\tonScan: function(sScanned, iQty){}, // Callback after detection of a successfull scanning:  function(){sScancode, iCount)}()\n\t\t\t\tonScanError: function(oDebug){}, // Callback after detection of a unsuccessfull scanning (scanned string in parameter)\n\t\t\t\tonKeyProcess: function(sChar, oEvent){}, // Callback after receiving and processing a char (scanned char in parameter)\n\t\t\t\tonKeyDetect: function(iKeyCode, oEvent){}, // Callback after detecting a keyDown (key char in parameter) - in contrast to onKeyProcess, this fires for non-character keys like tab, arrows, etc. too!\n\t\t\t\tonPaste: function(sPasted, oEvent){}, // Callback after receiving a value on paste, no matter if it is a valid code or not\n\t\t\t\tkeyCodeMapper: function(oEvent) {return onScan.decodeKeyEvent(oEvent)}, // Custom function to decode a keydown event into a character. Must return decoded character or NULL if the given event should not be processed.\n\t\t\t\tonScanButtonLongPress: function(){}, // Callback after detection of a successfull scan while the scan button was pressed and held down\n\t\t\t\tscanButtonKeyCode:false, // Key code of the scanner hardware button (if the scanner button a acts as a key itself) \n\t\t\t\tscanButtonLongPressTime:500, // How long (ms) the hardware button should be pressed, until a callback gets executed\n\t\t\t\ttimeBeforeScanTest:100, // Wait duration (ms) after keypress event to check if scanning is finished\n\t\t\t\tavgTimeByChar:30, // Average time (ms) between 2 chars. Used to do difference between keyboard typing and scanning\n\t\t\t\tminLength:6, // Minimum length for a scanning\n\t\t\t\tsuffixKeyCodes:[9,13], // Chars to remove and means end of scanning\n\t\t\t\tprefixKeyCodes:[], // Chars to remove and means start of scanning\n\t\t\t\tignoreIfFocusOn:false, // do not handle scans if the currently focused element matches this selector or object\n\t\t\t\tstopPropagation:false, // Stop immediate propagation on keypress event\n\t\t\t\tpreventDefault:false, // Prevent default action on keypress event\n\t\t\t\tcaptureEvents:false, // Get the events before any listeners deeper in the DOM\n\t\t\t\treactToKeydown:true, // look for scan input in keyboard events\n\t\t\t\treactToPaste:false, // look for scan input in paste events\n\t\t\t\tsingleScanQty: 1, // Quantity of Items put out to onScan in a single scan\n\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\toOptions = this._mergeOptions(oDefaults, oOptions);\n\t\n\t\t\t// initializing options and variables on DomElement\n\t\t\toDomElement.scannerDetectionData = {\n\t\t\t\t\toptions: oOptions,\n\t\t\t\t\tvars:{\n\t\t\t\t\t\tfirstCharTime: 0,\n\t\t\t\t\t\tlastCharTime: 0,\n\t\t\t\t\t\taccumulatedString: '',\n\t\t\t\t\t\ttestTimer: false,\n\t\t\t\t\t\tlongPressTimeStart: 0,\n\t\t\t\t\t\tlongPressed: false\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t};\n\t\t\t\n\t\t\t// initializing handlers (based on settings)\n\t\t\tif (oOptions.reactToPaste === true){\n\t\t\t\toDomElement.addEventListener(\"paste\", this._handlePaste, oOptions.captureEvents);\n\t\t\t}\n\t\t\tif (oOptions.scanButtonKeyCode !== false){\n\t\t\t\toDomElement.addEventListener(\"keyup\", this._handleKeyUp, oOptions.captureEvents);\n\t\t\t}\n\t\t\tif (oOptions.reactToKeydown === true || oOptions.scanButtonKeyCode !== false){\t\n\t\t\t\toDomElement.addEventListener(\"keydown\", this._handleKeyDown, oOptions.captureEvents);\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @return void\n\t\t */\n\t\tdetachFrom: function(oDomElement) {\n\t\t\t// detaching all used events\n\t\t\tif (oDomElement.scannerDetectionData.options.reactToPaste){\n\t\t\t\toDomElement.removeEventListener(\"paste\", this._handlePaste);\n\t\t\t}\n\t\t\tif (oDomElement.scannerDetectionData.options.scanButtonKeyCode !== false){\n\t\t\t\toDomElement.removeEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t}\n\t\t\toDomElement.removeEventListener(\"keydown\", this._handleKeyDown);\n\t\t\t\n\t\t\t// clearing data off DomElement\n\t\t\toDomElement.scannerDetectionData = undefined; \n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @return Object\n\t\t */\n\t\tgetOptions: function(oDomElement){\n\t\t\treturn oDomElement.scannerDetectionData.options;\t\t\t\n\t\t},\n\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @param Object oOptions\n\t\t * @return self\n\t\t */\n\t\tsetOptions: function(oDomElement, oOptions){\n\t\t\t// check if some handlers need to be changed based on possible option changes\n\t\t\tswitch (oDomElement.scannerDetectionData.options.reactToPaste){\n\t\t\t\tcase true: \n\t\t\t\t\tif (oOptions.reactToPaste === false){\n\t\t\t\t\t\toDomElement.removeEventListener(\"paste\", this._handlePaste);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase false:\n\t\t\t\t\tif (oOptions.reactToPaste === true){\n\t\t\t\t\t\toDomElement.addEventListener(\"paste\", this._handlePaste);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tswitch (oDomElement.scannerDetectionData.options.scanButtonKeyCode){\n\t\t\t\tcase false:\n\t\t\t\t\tif (oOptions.scanButtonKeyCode !== false){\n\t\t\t\t\t\toDomElement.addEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault: \n\t\t\t\t\tif (oOptions.scanButtonKeyCode === false){\n\t\t\t\t\t\toDomElement.removeEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\t// merge old and new options\n\t\t\toDomElement.scannerDetectionData.options = this._mergeOptions(oDomElement.scannerDetectionData.options, oOptions);\n\t\t\n\t\t\t// reinitiallize\n\t\t\tthis._reinitialize(oDomElement);\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Transforms key codes into characters.\n\t\t * \n\t\t * By default, only the follwing key codes are taken into account\n\t\t * - 48-90 (letters and regular numbers)\n\t\t * - 96-105 (numeric keypad numbers)\n\t\t * - 106-111 (numeric keypad operations)\n\t\t * \n\t\t * All other keys will yield empty strings!\n\t\t * \n\t\t * The above keycodes will be decoded using the KeyboardEvent.key property on modern\n\t\t * browsers. On older browsers the method will fall back to String.fromCharCode()\n\t\t * putting the result to upper/lower case depending on KeyboardEvent.shiftKey if\n\t\t * it is set.\n\t\t * \n\t\t * @param KeyboardEvent oEvent\n\t\t * @return string\n\t\t */\n\t\tdecodeKeyEvent : function (oEvent) {\n\t\t\tvar iCode = this._getNormalizedKeyNum(oEvent);\n\t\t\tswitch (true) {\n\t\t\t\tcase iCode >= 48 && iCode <= 90: // numbers and letters\n\t\t\t\tcase iCode >= 106 && iCode <= 111: // operations on numeric keypad (+, -, etc.)\n\t\t\t\t\tif (oEvent.key !== undefined && oEvent.key !== '') {\n\t\t\t\t\t\treturn oEvent.key;\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\tvar sDecoded = String.fromCharCode(iCode);\n\t\t\t\t\tswitch (oEvent.shiftKey) {\n\t\t\t\t\t\tcase false: sDecoded = sDecoded.toLowerCase(); break;\n\t\t\t\t\t\tcase true: sDecoded = sDecoded.toUpperCase(); break;\n\t\t\t\t\t}\n\t\t\t\t\treturn sDecoded;\n\t\t\t\tcase iCode >= 96 && iCode <= 105: // numbers on numeric keypad\n\t\t\t\t\treturn 0+(iCode-96);\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\t\n\t\t/**\n\t\t * Simulates a scan of the provided code.\n\t     *\n\t\t * The scan code can be defined as\n\t\t * - a string - in this case no keyCode decoding is done and the code is merely validated\n\t\t * against constraints like minLenght, etc.\n\t\t * - an array of keyCodes (e.g. `[70,71,80]`) - will produce `keydown` events with corresponding\n\t\t * `keyCode` properties. NOTE: these events will have empty `key` properties, so decoding may\n\t\t * yield different results than with native events.\n\t\t * - an array of objects (e.g. `[{keyCode: 70, key: \"F\", shiftKey: true}, {keyCode: 71, key: \"g\"}]`) -\n\t\t * this way almost any event can be simulated, but it's a lot of work to do.\n\t\t *\n\t\t * @param DomElement oDomElement\n\t\t * @param string|array mStringOrArray\n\t\t * @return self\n\t\t */\n\t\tsimulate: function(oDomElement, mStringOrArray){\n\t\t\tthis._reinitialize(oDomElement);\n\t\t\tif (Array.isArray(mStringOrArray)){\n\t\t\t\tmStringOrArray.forEach(function(mKey){\n\t\t\t\t\tvar oEventProps = {};\n\t\t\t\t\tif( (typeof mKey === \"object\" || typeof mKey === 'function') && (mKey !== null) ) {\n\t\t\t\t\t\toEventProps = mKey;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toEventProps.keyCode = parseInt(mKey);\n\t\t\t\t\t}\n\t\t\t\t\tvar oEvent = new KeyboardEvent('keydown', oEventProps);\n\t\t\t\t\tdocument.dispatchEvent(oEvent);\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis._validateScanCode(oDomElement, mStringOrArray);\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param DomElement oDomElement\n\t\t * @return void\n\t\t */\n\t\t_reinitialize: function(oDomElement){\n\t\t\tvar oVars = oDomElement.scannerDetectionData.vars;\n\t\t\toVars.firstCharTime = 0;\n\t\t\toVars.lastCharTime = 0;\n\t\t\toVars.accumulatedString = '';\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param DomElement oDomElement\n\t     * @return boolean\n\t\t */\n\t\t_isFocusOnIgnoredElement: function(oDomElement){\n\t\t\t\n\t\t\tvar ignoreSelectors = oDomElement.scannerDetectionData.options.ignoreIfFocusOn;\n\t\n\t        if(!ignoreSelectors){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\n\t\t\tvar oFocused = document.activeElement;\n\t\t\t\n\t\t\t// checks if ignored element is an array, and if so it checks if one of the elements of it is an active one\n\t\t\tif (Array.isArray(ignoreSelectors)){\n\t\t\t\tfor(var i=0; i<ignoreSelectors.length; i++){\n\t\t\t\t\tif(oFocused.matches(ignoreSelectors[i]) === true){\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t// if the option consists of an single element, it only checks this one\n\t\t\t} else if (oFocused.matches(ignoreSelectors)){\n\t\t\t\treturn true;\t\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// if the active element is not listed in the ignoreIfFocusOn option, return false\n\t\t    return false;\n\t    },\n\t\t\n\t    /**\n\t     * Validates the scan code accumulated by the given DOM element and fires the respective events.\n\t     * \n\t     * @private\n\t     * @param DomElement oDomElement\n\t     * @return boolean\n\t     */\n\t\t_validateScanCode: function(oDomElement, sScanCode){\n\t\t\tvar oScannerData = oDomElement.scannerDetectionData;\t\t\t\n\t\t\tvar oOptions = oScannerData.options;\n\t\t\tvar iSingleScanQty = oScannerData.options.singleScanQty;\n\t\t\tvar iFirstCharTime = oScannerData.vars.firstCharTime;\n\t\t\tvar iLastCharTime = oScannerData.vars.lastCharTime;\n\t\t\tvar oScanError = {};\n\t        var oEvent;\n\t        \n\t\t\tswitch(true){\n\t\t\t\t\n\t\t\t\t// detect codes that are too short\n\t\t\t\tcase (sScanCode.length < oOptions.minLength):\n\t\t\t\t\toScanError = {\n\t\t\t\t\t\tmessage: \"Receieved code is shorter then minimal length\"\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// detect codes that were entered too slow\t\n\t\t\t\tcase ((iLastCharTime - iFirstCharTime) > (sScanCode.length * oOptions.avgTimeByChar)):\n\t\t\t\t\toScanError = {\n\t\t\t\t\t\tmessage: \"Receieved code was not entered in time\"\n\t\t\t\t\t};\t\t\t\t\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// if a code was not filtered out earlier it is valid\t\n\t\t\t\tdefault:\n\t\t\t\t\toOptions.onScan.call(oDomElement, sScanCode, iSingleScanQty);\n\t\t\t\t\toEvent = new CustomEvent(\n\t\t\t\t\t\t'scan',\n\t\t\t\t\t\t{\t\n\t\t\t\t\t\t\tdetail: { \n\t\t\t\t\t\t\t\tscanCode: sScanCode,\n\t\t\t\t\t\t\t\tqty: iSingleScanQty\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\toDomElement.dispatchEvent(oEvent);\n\t\t\t\t\tonScan._reinitialize(oDomElement);\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\t// If an error occurred (otherwise the method would return earlier) create an object for errordetection\n\t\t\toScanError.scanCode = sScanCode;\n\t\t\toScanError.scanDuration = iLastCharTime - iFirstCharTime;\n\t\t\toScanError.avgTimeByChar = oOptions.avgTimeByChar;\n\t\t\toScanError.minLength = oOptions.minLength;\n\t\t\t\n\t\t\toOptions.onScanError.call(oDomElement, oScanError);\n\t\t\t\n\t\t\toEvent = new CustomEvent(\n\t\t\t\t'scanError', \n\t\t\t\t{detail: oScanError}\n\t\t\t);\n\t\t\toDomElement.dispatchEvent(oEvent);\n\t\t\t\n\t\t\tonScan._reinitialize(oDomElement);\n\t\t\treturn false;\n\t    },\n\t\n\t    /**\n\t     * @private\n\t     * @param Object oDefaults\n\t     * @param Object oOptions\n\t     * @return Object\n\t     */\n\t\t_mergeOptions: function(oDefaults, oOptions){\n\t\t\tvar oExtended = {};\n\t\t\tvar prop;\n\t\t\tfor (prop in oDefaults){\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(oDefaults, prop)){\n\t\t\t\t\toExtended[prop] = oDefaults[prop];\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\tfor (prop in oOptions){\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(oOptions, prop)){\n\t\t\t\t\toExtended[prop] = oOptions[prop];\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\treturn oExtended;\n\t\t},\n\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return int\n\t\t * @see https://www.w3schools.com/jsref/event_key_keycode.asp\n\t\t */\n\t\t_getNormalizedKeyNum: function(e){\n\t\t\treturn e.which || e.keyCode;\n\t\t},\n\t\n\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return void\n\t\t */\n\t\t_handleKeyDown: function(e){\n\t\t\tvar iKeyCode = onScan._getNormalizedKeyNum(e);\n\t\t\tvar oOptions = this.scannerDetectionData.options;\n\t\t\tvar oVars = this.scannerDetectionData.vars;\n\t\t\tvar bScanFinished = false;\n\t\t\t\n\t\t\tif (oOptions.onKeyDetect.call(this, iKeyCode, e) === false) {\n\t\t\t\treturn;\n\t\t\t}\t\t\n\t\t\t\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\t\t\t\n\t        // If it's just the button of the scanner, ignore it and wait for the real input\n\t\t    if(oOptions.scanButtonKeyCode !== false && iKeyCode==oOptions.scanButtonKeyCode) {\n\t\t\t\t\n\t\t\t\t// if the button was first pressed, start a timeout for the callback, which gets interrupted if the scanbutton gets released\n\t\t\t\tif (!oVars.longPressed){\n\t\t\t\t\toVars.longPressTimer = setTimeout( oOptions.onScanButtonLongPress, oOptions.scanButtonLongPressTime, this);\n\t\t\t\t\toVars.longPressed = true;\n\t\t\t\t}\n\t\n\t\t\t\treturn;\n\t        }\n\t\t\t\n\t\t\tswitch(true){\n\t\t\t\t// If it's not the first character and we encounter a terminating character, trigger scan process\n\t\t\t\tcase (oVars.firstCharTime && oOptions.suffixKeyCodes.indexOf(iKeyCode)!==-1):\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tbScanFinished=true;\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// If it's the first character and we encountered one of the starting characters, don't process the scan\t\n\t\t\t\tcase (!oVars.firstCharTime && oOptions.prefixKeyCodes.indexOf(iKeyCode)!==-1):\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tbScanFinished=false;\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// Otherwise, just add the character to the scan string we're building\t\n\t\t\t\tdefault:\n\t\t\t\t\tvar character = oOptions.keyCodeMapper.call(this, e);\n\t\t\t\t\tif (character === null){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\toVars.accumulatedString += character;\n\t\t\t\t\t\n\t\t\t\t\tif (oOptions.preventDefault) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\tif (oOptions.stopPropagation) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tbScanFinished=false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t        \n\t\t\tif(!oVars.firstCharTime){\n\t\t\t\toVars.firstCharTime=Date.now();\n\t\t\t}\n\t\t\t\n\t\t\toVars.lastCharTime=Date.now();\n\t\n\t\t\tif(oVars.testTimer){ \n\t\t\t\tclearTimeout(oVars.testTimer);\n\t\t\t}\n\t\t\t\n\t\t\tif(bScanFinished){\n\t\t\t\tonScan._validateScanCode(this, oVars.accumulatedString);\n\t\t\t\toVars.testTimer=false;\n\t\t\t} else {\n\t\t\t\toVars.testTimer=setTimeout(onScan._validateScanCode, oOptions.timeBeforeScanTest, this, oVars.accumulatedString);\n\t\t\t}\n\t\n\t\t\toOptions.onKeyProcess.call(this, character, e);\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param Event e\n\t\t * @return void\n\t\t */\n\t\t_handlePaste: function(e){\n\t\n\t\t\tvar oOptions = this.scannerDetectionData.options;\n\t\t\tvar oVars = this.scannerDetectionData.vars;\n\t\t\tvar sPasteString = (event.clipboardData || window.clipboardData).getData('text');\n\t\t\t\n\t\t\t// if the focus is on an ignored element, abort\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\te.preventDefault();\n\n\t\t\tif (oOptions.stopPropagation) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t}\n\t\t\t\t\t\t\n\t\t\toOptions.onPaste.call(this, sPasteString, event);\n\t\t\t\n\t\t\toVars.firstCharTime = 0;\n\t\t\toVars.lastCharTime = 0;\n\t\t\t\n\t\t\t// validate the string\n\t\t\tonScan._validateScanCode(this, sPasteString);\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return void\n\t\t */\n\t\t_handleKeyUp: function(e){\n\t\t\t// if the focus is on an ignored element, abort\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tvar iKeyCode = onScan._getNormalizedKeyNum(e);\n\t\t\t\n\t\t\t// if hardware key is not being pressed anymore stop the timeout and reset\n\t\t\tif (iKeyCode == this.scannerDetectionData.options.scanButtonKeyCode){\n\t\t\t\tclearTimeout(this.scannerDetectionData.vars.longPressTimer);\n\t\t\t\tthis.scannerDetectionData.vars.longPressed = false;\n\t\t\t}\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Returns TRUE the scanner is currently in the middle of a scan sequence.\n\t\t * \n\t\t * @param DomElement\n\t\t * @return boolean\n\t\t */\n\t\tisScanInProgressFor: function(oDomElement) {\n\t\t\treturn oDomElement.scannerDetectionData.vars.firstCharTime > 0;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Returns TRUE if onScan is attached to the given DOM element and FALSE otherwise.\n\t\t * \n\t\t * @param DomElement\n\t\t * @return boolean\n\t\t */\n\t\tisAttachedTo: function(oDomElement) {\n\t\t\treturn (oDomElement.scannerDetectionData !== undefined);\n\t\t}\n\t};\n\t\n\treturn onScan;\n})));", "import onScan from \"onscan.js\";\n\n/* global edp_online_vehicles */\n\nedp_online_vehicles.PartOrder.ItemSelector = class {\n\t// eslint-disable-next-line no-unused-vars\n\tconstructor({ frm, wrapper, events, pos_profile, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.pos_profile = \"\";\n\t\tthis.hide_images = false;\n\t\tthis.auto_add_item = false;\n\n\t\tthis.inti_component();\n\t}\n\n\tinti_component() {\n\t\tthis.prepare_dom();\n\t\tthis.make_search_bar();\n\t\tthis.load_items_data();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"items-selector\">\n\t\t\t\t<div class=\"filter-section\">\n\t\t\t\t\t<div class=\"label\">${__(\"All Items\")}</div>\n\t\t\t\t\t<div class=\"search-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"items-container\"></div>\n\t\t\t</section>`,\n\t\t);\n\n\t\tthis.$component = this.wrapper.find(\".items-selector\");\n\t\tthis.$items_container = this.$component.find(\".items-container\");\n\t}\n\n\tasync load_items_data() {\n\t\tif (!this.item_group) {\n\t\t\tconst res = await frappe.db.get_value(\n\t\t\t\t\"Item Group\",\n\t\t\t\t{ lft: 1, is_group: 1 },\n\t\t\t\t\"name\",\n\t\t\t);\n\t\t\tthis.parent_item_group = res.message.name;\n\t\t}\n\t\tif (!this.price_list) {\n\t\t\tconst company = await frappe.defaults.get_user_defaults(\"Company\");\n\t\t\tconst res = await frappe.db.get_value(\n\t\t\t\t\"Company\",\n\t\t\t\tcompany[0],\n\t\t\t\t\"custom_default_price_list\",\n\t\t\t);\n\t\t\tthis.price_list = res.message.custom_default_price_list;\n\t\t}\n\n\t\tthis.get_items({}).then(({ message }) => {\n\t\t\tthis.render_item_list(message.items);\n\t\t});\n\t}\n\n\tget_items({ start = 0, page_length = 40, search_term = \"\" }) {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst price_list = (doc && doc.selling_price_list) || this.price_list;\n\t\tlet item_group = \"Parts\";\n\n\t\tconsole.log(this);\n\t\tconsole.log(price_list);\n\n\t\t// !item_group && (item_group = this.parent_item_group);\n\n\t\treturn frappe.call({\n\t\t\tmethod: \"edp_online_vehicles.edp_online_vehicles.page.part_order_1.point_of_sale.get_items\",\n\t\t\tfreeze: true,\n\t\t\targs: { start, page_length, price_list, item_group, search_term },\n\t\t});\n\t}\n\n\trender_item_list(items) {\n\t\tthis.$items_container.html(\"\");\n\n\t\tconsole.log(items);\n\n\t\titems.forEach((item) => {\n\t\t\tconst item_html = this.get_item_html(item);\n\t\t\tthis.$items_container.append(item_html);\n\t\t});\n\t}\n\n\tget_item_html(item) {\n\t\tconst me = this;\n\n\t\t// eslint-disable-next-line no-unused-vars\n\t\tconst {\n\t\t\titem_image,\n\t\t\tserial_no,\n\t\t\tbatch_no,\n\t\t\tbarcode,\n\t\t\tactual_qty,\n\t\t\tuom,\n\t\t\tprice_list_rate,\n\t\t} = item;\n\t\tconst precision = flt(price_list_rate, 2) % 1 != 0 ? 2 : 0;\n\t\tlet indicator_color;\n\t\tlet qty_to_display = actual_qty;\n\n\t\tif (item.is_stock_item) {\n\t\t\tindicator_color =\n\t\t\t\tactual_qty > 10 ? \"green\" : actual_qty <= 0 ? \"red\" : \"orange\";\n\n\t\t\tif (Math.round(qty_to_display) > 999) {\n\t\t\t\tqty_to_display = Math.round(qty_to_display) / 1000;\n\t\t\t\tqty_to_display = qty_to_display.toFixed(1) + \"K\";\n\t\t\t}\n\t\t} else {\n\t\t\tindicator_color = \"\";\n\t\t\tqty_to_display = \"\";\n\t\t}\n\n\t\tfunction get_item_image_html() {\n\t\t\tif (actual_qty == 0 && item.dealer_qty > 0) {\n\t\t\t\tif (!me.hide_images && item_image) {\n\t\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap orange\">Dealer - ${item.dealer_qty}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"flex items-center justify-center border-b-grey text-6xl text-grey-100\" style=\"height:8rem; min-height:8rem\">\n\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\tonerror=\"cur_pos.item_selector.handle_broken_image(this)\"\n\t\t\t\t\t\t\t\t\tclass=\"h-full item-img\" src=\"${item_image}\"\n\t\t\t\t\t\t\t\t\talt=\"${frappe.get_abbr(item.item_name)}\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>`;\n\t\t\t\t} else {\n\t\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap orange\">Dealer</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"item-display abbr\">${frappe.get_abbr(item.item_name)}</div>`;\n\t\t\t\t}\n\t\t\t} else if (actual_qty == 0 && item.dealer_qty == 0) {\n\t\t\t\tif (!me.hide_images && item_image) {\n\t\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap red\">No Stock</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"flex items-center justify-center border-b-grey text-6xl text-grey-100\" style=\"height:8rem; min-height:8rem\">\n\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\tonerror=\"cur_pos.item_selector.handle_broken_image(this)\"\n\t\t\t\t\t\t\t\t\tclass=\"h-full item-img\" src=\"${item_image}\"\n\t\t\t\t\t\t\t\t\talt=\"${frappe.get_abbr(item.item_name)}\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>`;\n\t\t\t\t} else {\n\t\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap red\">No Stock</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"item-display abbr\">${frappe.get_abbr(item.item_name)}</div>`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!me.hide_images && item_image) {\n\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap green\">HQ - ${actual_qty}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex items-center justify-center border-b-grey text-6xl text-grey-100\" style=\"height:8rem; min-height:8rem\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tonerror=\"cur_pos.item_selector.handle_broken_image(this)\"\n\t\t\t\t\t\t\t\tclass=\"h-full item-img\" src=\"${item_image}\"\n\t\t\t\t\t\t\t\talt=\"${frappe.get_abbr(item.item_name)}\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap green\">HQ</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"item-display abbr\">${frappe.get_abbr(item.item_name)}</div>`;\n\t\t\t}\n\t\t}\n\n\t\treturn `<div class=\"item-wrapper\"\n\t\t\t\tdata-item-code=\"${escape(item.item_code)}\" data-serial-no=\"${escape(serial_no)}\"\n\t\t\t\tdata-hq-qty=\"${escape(actual_qty)}\" data-dealer-qty=\"${escape(item.dealer_qty)}\"\n\t\t\t\tdata-batch-no=\"${escape(batch_no)}\" data-uom=\"${escape(uom)}\"\n\t\t\t\tdata-rate=\"${escape(price_list_rate || 0)}\"\n\t\t\t\tdata-stock-uom=\"${escape(item.stock_uom)}\"\n\t\t\t\tdata-stock-image=\"${escape(item_image)}\"\n\t\t\t\ttitle=\"${item.item_name}\">\n\n\t\t\t\t${get_item_image_html()}\n\n\t\t\t\t<div class=\"item-detail\">\n\t\t\t\t\t<div class=\"item-name\">\n\t\t\t\t\t\t${frappe.ellipsis(item.item_name, 18)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"item-rate\">${\n\t\t\t\t\t\tformat_currency(\n\t\t\t\t\t\t\tprice_list_rate,\n\t\t\t\t\t\t\titem.currency,\n\t\t\t\t\t\t\tprecision,\n\t\t\t\t\t\t) || 0\n\t\t\t\t\t} / ${uom}</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr(\"alt\");\n\t\t$($img)\n\t\t\t.parent()\n\t\t\t.replaceWith(`<div class=\"item-display abbr\">${item_abbr}</div>`);\n\t}\n\n\tmake_search_bar() {\n\t\tconst me = this;\n\t\tthis.$component.find(\".search-field\").html(\"\");\n\t\t// this.$component.find(\".item-group-field\").html(\"\");\n\n\t\tthis.search_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Search\"),\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tplaceholder: __(\n\t\t\t\t\t\"Search by item code, serial number or barcode\",\n\t\t\t\t),\n\t\t\t},\n\t\t\tparent: this.$component.find(\".search-field\"),\n\t\t\trender_input: true,\n\t\t});\n\t\t// this.item_group_field = frappe.ui.form.make_control({\n\t\t// \tdf: {\n\t\t// \t\tlabel: __(\"Item Group\"),\n\t\t// \t\tfieldtype: \"Link\",\n\t\t// \t\toptions: \"Item Group\",\n\t\t// \t\tplaceholder: __(\"Select item group\"),\n\t\t// \t\tonchange: function () {\n\t\t// \t\t\tme.item_group = this.value;\n\t\t// \t\t\t!me.item_group && (me.item_group = me.parent_item_group);\n\t\t// \t\t\tme.filter_items();\n\t\t// \t\t},\n\t\t// \t\tget_query: function () {\n\t\t// \t\t\tconst doc = me.events.get_frm().doc;\n\t\t// \t\t\treturn {\n\t\t// \t\t\t\tquery: \"erpnext.selling.page.point_of_sale.point_of_sale.item_group_query\",\n\t\t// \t\t\t\tfilters: {\n\t\t// \t\t\t\t\tpos_profile: doc ? doc.pos_profile : \"\",\n\t\t// \t\t\t\t},\n\t\t// \t\t\t};\n\t\t// \t\t},\n\t\t// \t},\n\t\t// \tparent: this.$component.find(\".item-group-field\"),\n\t\t// \trender_input: true,\n\t\t// });\n\t\tthis.search_field.toggle_label(false);\n\t\t// this.item_group_field.toggle_label(false);\n\n\t\tthis.attach_clear_btn();\n\t}\n\n\tattach_clear_btn() {\n\t\tthis.search_field.$wrapper.find(\".control-input\").append(\n\t\t\t`<span class=\"link-btn\" style=\"top: 2px;\">\n\t\t\t\t<a class=\"btn-open no-decoration\" title=\"${__(\"Clear\")}\">\n\t\t\t\t\t${frappe.utils.icon(\"close\", \"sm\")}\n\t\t\t\t</a>\n\t\t\t</span>`,\n\t\t);\n\n\t\tthis.$clear_search_btn = this.search_field.$wrapper.find(\".link-btn\");\n\n\t\tthis.$clear_search_btn.on(\"click\", \"a\", () => {\n\t\t\tthis.set_search_value(\"\");\n\t\t\tthis.search_field.set_focus();\n\t\t});\n\t}\n\n\tset_search_value(value) {\n\t\t$(this.search_field.$input[0]).val(value).trigger(\"input\");\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\twindow.onScan = onScan;\n\n\t\tonScan.decodeKeyEvent = function (oEvent) {\n\t\t\tvar iCode = this._getNormalizedKeyNum(oEvent);\n\t\t\tswitch (true) {\n\t\t\t\tcase iCode >= 48 && iCode <= 90: // numbers and letters\n\t\t\t\tcase iCode >= 106 && iCode <= 111: // operations on numeric keypad (+, -, etc.)\n\t\t\t\tcase (iCode >= 160 && iCode <= 164) || iCode == 170: // ^ ! # $ *\n\t\t\t\tcase iCode >= 186 && iCode <= 194: // (; = , - . / `)\n\t\t\t\tcase iCode >= 219 && iCode <= 222: // ([ \\ ] ')\n\t\t\t\tcase iCode == 32: // spacebar\n\t\t\t\t\tif (oEvent.key !== undefined && oEvent.key !== \"\") {\n\t\t\t\t\t\treturn oEvent.key;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar sDecoded = String.fromCharCode(iCode);\n\t\t\t\t\tswitch (oEvent.shiftKey) {\n\t\t\t\t\t\tcase false:\n\t\t\t\t\t\t\tsDecoded = sDecoded.toLowerCase();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase true:\n\t\t\t\t\t\t\tsDecoded = sDecoded.toUpperCase();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\treturn sDecoded;\n\t\t\t\tcase iCode >= 96 && iCode <= 105: // numbers on numeric keypad\n\t\t\t\t\treturn 0 + (iCode - 96);\n\t\t\t}\n\t\t\treturn \"\";\n\t\t};\n\n\t\tonScan.attachTo(document, {\n\t\t\tonScan: (sScancode) => {\n\t\t\t\tif (this.search_field && this.$component.is(\":visible\")) {\n\t\t\t\t\tthis.search_field.set_focus();\n\t\t\t\t\tthis.set_search_value(sScancode);\n\t\t\t\t\tthis.barcode_scanned = true;\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.$component.on(\"click\", \".item-wrapper\", async function () {\n\t\t\tconst $item = $(this);\n\t\t\tconst part_no = unescape($item.attr(\"data-item-code\"));\n\t\t\tlet batch_no = unescape($item.attr(\"data-batch-no\"));\n\t\t\tlet serial_no = unescape($item.attr(\"data-serial-no\"));\n\t\t\tlet uom = unescape($item.attr(\"data-uom\"));\n\t\t\tlet rate = unescape($item.attr(\"data-rate\"));\n\t\t\tlet stock_uom = unescape($item.attr(\"data-stock-uom\"));\n\t\t\tlet item_name = unescape($item.attr(\"title\"));\n\t\t\tlet item_image = unescape($item.attr(\"data-stock-image\"));\n\t\t\tlet hq_qty = unescape($item.attr(\"data-hq-qty\"));\n\t\t\tlet dealer_qty = unescape($item.attr(\"data-dealer-qty\"));\n\n\t\t\tlet dealer_ordered_qty = 0;\n\t\t\tlet dealer_company = \"\";\n\t\t\tlet backorder = false;\n\n\t\t\t// Handle undefined values:\n\t\t\tbatch_no = batch_no === \"undefined\" ? undefined : batch_no;\n\t\t\tserial_no = serial_no === \"undefined\" ? undefined : serial_no;\n\t\t\tuom = uom === \"undefined\" ? undefined : uom;\n\t\t\trate = rate === \"undefined\" ? undefined : rate;\n\t\t\tstock_uom = stock_uom === \"undefined\" ? undefined : stock_uom;\n\n\t\t\t// Convert quantities to numbers:\n\t\t\tconst hq = parseFloat(hq_qty) || 0;\n\t\t\tconst dealer = parseFloat(dealer_qty) || 0;\n\n\t\t\t// If no HQ stock but dealer stock is available, trigger popup.\n\t\t\tif (hq === 0 && dealer > 0) {\n\t\t\t\ttry {\n\t\t\t\t\tlet { ordered_qty, company, is_backorder } =\n\t\t\t\t\t\tawait showDealerOrderPopup(part_no);\n\n\t\t\t\t\tif (is_backorder) {\n\t\t\t\t\t\tbackorder = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tdealer_ordered_qty = ordered_qty;\n\t\t\t\t\tdealer_company = company;\n\t\t\t\t} catch (error) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else if (hq === 0 && dealer === 0) {\n\t\t\t\tbackorder = true;\n\n\t\t\t\tawait frappe.call({\n\t\t\t\t\tmethod: \"edp_online_vehicles.events.get_hq_company.get_hq_company\",\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\tdealer_company = r.message;\n\t\t\t\t\t\t\tdealer_ordered_qty = 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Continue only if user clicks \"Order\" or if popup was never triggered.\n\t\t\tme.events.item_selected({\n\t\t\t\tfield: \"qty\",\n\t\t\t\tvalue: \"+1\",\n\t\t\t\titem: {\n\t\t\t\t\tpart_no,\n\t\t\t\t\tbatch_no,\n\t\t\t\t\tserial_no,\n\t\t\t\t\tuom,\n\t\t\t\t\trate,\n\t\t\t\t\tstock_uom,\n\t\t\t\t\titem_name,\n\t\t\t\t\titem_image,\n\t\t\t\t\tdealer_ordered_qty,\n\t\t\t\t\tdealer_company,\n\t\t\t\t\tbackorder,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tme.search_field.set_focus();\n\t\t});\n\n\t\tthis.search_field.$input.on(\"input\", (e) => {\n\t\t\tclearTimeout(this.last_search);\n\t\t\tthis.last_search = setTimeout(() => {\n\t\t\t\tconst search_term = e.target.value;\n\t\t\t\tthis.filter_items({ search_term });\n\t\t\t}, 300);\n\n\t\t\tthis.$clear_search_btn.toggle(\n\t\t\t\tBoolean(this.search_field.$input.val()),\n\t\t\t);\n\t\t});\n\n\t\tthis.search_field.$input.on(\"focus\", () => {\n\t\t\tthis.$clear_search_btn.toggle(\n\t\t\t\tBoolean(this.search_field.$input.val()),\n\t\t\t);\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? \"\u2318\" : \"Ctrl\";\n\t\tthis.search_field.parent.attr(\"title\", `${ctrl_label}+I`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+i\",\n\t\t\taction: () => this.search_field.set_focus(),\n\t\t\tcondition: () => this.$component.is(\":visible\"),\n\t\t\tdescription: __(\"Focus on search input\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page,\n\t\t});\n\t\t// this.item_group_field.parent.attr(\"title\", `${ctrl_label}+G`);\n\t\t// frappe.ui.keys.add_shortcut({\n\t\t// \tshortcut: \"ctrl+g\",\n\t\t// \taction: () => this.item_group_field.set_focus(),\n\t\t// \tcondition: () => this.$component.is(\":visible\"),\n\t\t// \tdescription: __(\"Focus on Item Group filter\"),\n\t\t// \tignore_inputs: true,\n\t\t// \tpage: cur_page.page.page,\n\t\t// });\n\n\t\t// for selecting the last filtered item on search\n\t\tfrappe.ui.keys.on(\"enter\", () => {\n\t\t\tconst selector_is_visible = this.$component.is(\":visible\");\n\t\t\tif (!selector_is_visible || this.search_field.get_value() === \"\")\n\t\t\t\treturn;\n\n\t\t\tif (this.items.length == 1) {\n\t\t\t\tthis.$items_container.find(\".item-wrapper\").click();\n\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\tthis.set_search_value(\"\");\n\t\t\t} else if (this.items.length == 0 && this.barcode_scanned) {\n\t\t\t\t// only show alert of barcode is scanned and enter is pressed\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"No items found. Scan barcode again.\"),\n\t\t\t\t\tindicator: \"orange\",\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\tthis.barcode_scanned = false;\n\t\t\t\tthis.set_search_value(\"\");\n\t\t\t}\n\t\t});\n\t}\n\n\tfilter_items({ search_term = \"\" } = {}) {\n\t\tconst selling_price_list = this.events.get_frm().doc.selling_price_list;\n\n\t\tif (search_term) {\n\t\t\tsearch_term = search_term.toLowerCase();\n\n\t\t\t// memoize\n\t\t\tthis.search_index = this.search_index || {};\n\t\t\tthis.search_index[selling_price_list] =\n\t\t\t\tthis.search_index[selling_price_list] || {};\n\t\t\tif (this.search_index[selling_price_list][search_term]) {\n\t\t\t\tconst items =\n\t\t\t\t\tthis.search_index[selling_price_list][search_term];\n\t\t\t\tthis.items = items;\n\t\t\t\tthis.render_item_list(items);\n\t\t\t\tthis.auto_add_item &&\n\t\t\t\t\tthis.items.length == 1 &&\n\t\t\t\t\tthis.add_filtered_item_to_cart();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.get_items({ search_term }).then(({ message }) => {\n\t\t\t// eslint-disable-next-line no-unused-vars\n\t\t\tconst { items, serial_no, batch_no, barcode } = message;\n\t\t\tif (search_term && !barcode) {\n\t\t\t\tthis.search_index[selling_price_list][search_term] = items;\n\t\t\t}\n\t\t\tthis.items = items;\n\t\t\tthis.render_item_list(items);\n\t\t\tthis.auto_add_item &&\n\t\t\t\tthis.items.length == 1 &&\n\t\t\t\tthis.add_filtered_item_to_cart();\n\t\t});\n\t}\n\n\tadd_filtered_item_to_cart() {\n\t\tthis.$items_container.find(\".item-wrapper\").click();\n\t\tthis.set_search_value(\"\");\n\t}\n\n\tresize_selector(minimize) {\n\t\tminimize\n\t\t\t? this.$component\n\t\t\t\t\t.find(\".filter-section\")\n\t\t\t\t\t.css(\"grid-template-columns\", \"repeat(1, minmax(0, 1fr))\")\n\t\t\t: this.$component\n\t\t\t\t\t.find(\".filter-section\")\n\t\t\t\t\t.css(\"grid-template-columns\", \"repeat(12, minmax(0, 1fr))\");\n\n\t\tminimize\n\t\t\t? this.$component\n\t\t\t\t\t.find(\".search-field\")\n\t\t\t\t\t.css(\"margin\", \"var(--margin-sm) 0px\")\n\t\t\t: this.$component\n\t\t\t\t\t.find(\".search-field\")\n\t\t\t\t\t.css(\"margin\", \"0px var(--margin-sm)\");\n\n\t\tminimize\n\t\t\t? this.$component.css(\"grid-column\", \"span 2 / span 2\")\n\t\t\t: this.$component.css(\"grid-column\", \"span 6 / span 6\");\n\n\t\tminimize\n\t\t\t? this.$items_container.css(\n\t\t\t\t\t\"grid-template-columns\",\n\t\t\t\t\t\"repeat(1, minmax(0, 1fr))\",\n\t\t\t\t)\n\t\t\t: this.$items_container.css(\n\t\t\t\t\t\"grid-template-columns\",\n\t\t\t\t\t\"repeat(4, minmax(0, 1fr))\",\n\t\t\t\t);\n\t}\n\n\ttoggle_component(show) {\n\t\tthis.set_search_value(\"\");\n\t\tthis.$component.css(\"display\", show ? \"flex\" : \"none\");\n\t}\n};\n\n/**\n * Displays a popup when an item is only available in dealer warehouses.\n * Uses a Promise to wait for user action before continuing execution.\n */\nfunction showDealerOrderPopup(part_no) {\n\treturn new Promise((resolve, reject) => {\n\t\tfrappe.call({\n\t\t\tmethod: \"edp_online_vehicles.events.get_item_details.get_item_details\",\n\t\t\targs: { part_no: part_no },\n\t\t\tcallback: function (r) {\n\t\t\t\tif (!r.message || r.message.length === 0) {\n\t\t\t\t\treturn reject(); // If no dealer stock, reject the Promise\n\t\t\t\t}\n\n\t\t\t\t// Ensure HQ row (allow_backorder: true) is first\n\t\t\t\tlet dealers = r.message;\n\t\t\t\tdealers.sort((a, b) => {\n\t\t\t\t\tif (a.allow_backorder && !b.allow_backorder) {\n\t\t\t\t\t\treturn -1;\n\t\t\t\t\t}\n\t\t\t\t\treturn 0;\n\t\t\t\t});\n\n\t\t\t\t// Create overlay to freeze page interactions\n\t\t\t\tlet $overlay = $(\n\t\t\t\t\t'<div class=\"custom-overlay\" style=\"position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1999;\"></div>',\n\t\t\t\t);\n\n\t\t\t\t// Generate dealer rows dynamically\n\t\t\t\tlet dealerRows = dealers\n\t\t\t\t\t.map((dealer) => {\n\t\t\t\t\t\t// For HQ row, do not set a max attribute so that users can order above current SOH.\n\t\t\t\t\t\tlet maxAttribute = dealer.allow_backorder\n\t\t\t\t\t\t\t? \"\"\n\t\t\t\t\t\t\t: `max=\"${dealer.soh}\"`;\n\t\t\t\t\t\treturn `\n                        <div class=\"dealer-row\" style=\"display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;\">\n                            <div style=\"flex: 2; text-align: left;\">${dealer.company}</div>\n                            <div style=\"flex: 1; text-align: center;\">${dealer.soh}</div>\n                            <div style=\"flex: 2; display: flex; align-items: center; justify-content: center;\">\n                                <button class=\"qty-minus\" data-company=\"${dealer.company}\" style=\"width: 25px; height: 25px; border: none; background-color: #ccc; cursor: pointer;\">-</button>\n                                <input type=\"number\" class=\"qty-input\" data-company=\"${dealer.company}\" value=\"0\" min=\"0\" ${maxAttribute} style=\"width: 40px; text-align: center; margin: 0 5px; border: 1px solid #ccc; border-radius: 3px;\">\n                                <button class=\"qty-plus\" data-company=\"${dealer.company}\" style=\"width: 25px; height: 25px; border: none; background-color: #ccc; cursor: pointer;\">+</button>\n                            </div>\n                        </div>\n                    `;\n\t\t\t\t\t})\n\t\t\t\t\t.join(\"\");\n\n\t\t\t\t// Create popup HTML\n\t\t\t\tlet $popup = $(`\n                    <div class=\"custom-popup\" style=\"\n                        position: fixed;\n                        top: 20px;\n                        left: 50%;\n                        transform: translateX(-50%);\n                        z-index: 2000;\n                        background-color: #fff;\n                        color: #000;\n                        padding: 20px;\n                        border-radius: 4px;\n                        box-shadow: 0 2px 5px rgba(0,0,0,0.3);\n                        width: 50%;\n                        max-width: 600px;\n                        text-align: center;\n                    \">\n                        <button class=\"popup-close\" style=\"position: absolute; top: 5px; right: 5px; background: transparent; border: none; font-size: 18px; cursor: pointer; color: #000;\">&times;</button>\n                        <div style=\"display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 10px;\">\n                            <div style=\"flex: 2; text-align: left;\">Dealer</div>\n                            <div style=\"flex: 1; text-align: center;\">SOH</div>\n                            <div style=\"flex: 2; text-align: center;\">Qty</div>\n                        </div>\n                        ${dealerRows}\n                        <button class=\"order-btn\" disabled style=\"\n                            margin-top: 15px;\n                            padding: 8px 16px;\n                            border: none;\n                            border-radius: 4px;\n                            background-color: #056fa6;\n                            color: #fff;\n                            font-weight: bold;\n                            cursor: not-allowed;\n                        \">Order</button>\n                    </div>\n                `);\n\n\t\t\t\t// Append overlay and popup to the container\n\t\t\t\t$(\".part-order-app\").append($overlay).append($popup);\n\n\t\t\t\t// Enable/Disable Order button based on selected qty\n\t\t\t\tfunction updateOrderButtonState() {\n\t\t\t\t\tlet totalQty = 0;\n\t\t\t\t\t$(\".qty-input\").each(function () {\n\t\t\t\t\t\ttotalQty += parseInt($(this).val(), 10) || 0;\n\t\t\t\t\t});\n\t\t\t\t\t$(\".order-btn\")\n\t\t\t\t\t\t.prop(\"disabled\", totalQty === 0)\n\t\t\t\t\t\t.css(\n\t\t\t\t\t\t\t\"cursor\",\n\t\t\t\t\t\t\ttotalQty > 0 ? \"pointer\" : \"not-allowed\",\n\t\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Handle \"+\" button clicks\n\t\t\t\t$(\".qty-plus\").click(function () {\n\t\t\t\t\tlet company = $(this).data(\"company\");\n\t\t\t\t\tlet $input = $(`.qty-input[data-company='${company}']`);\n\t\t\t\t\t// For dealer rows, use the max attribute; for HQ (no max) simply increment.\n\t\t\t\t\tlet maxQty = $input.attr(\"max\")\n\t\t\t\t\t\t? parseInt($input.attr(\"max\"), 10)\n\t\t\t\t\t\t: null;\n\t\t\t\t\tlet currentValue = parseInt($input.val(), 10) || 0;\n\t\t\t\t\tif (maxQty !== null && currentValue < maxQty) {\n\t\t\t\t\t\t$input.val(currentValue + 1);\n\t\t\t\t\t} else if (maxQty === null) {\n\t\t\t\t\t\t$input.val(currentValue + 1);\n\t\t\t\t\t}\n\t\t\t\t\tupdateOrderButtonState();\n\t\t\t\t});\n\n\t\t\t\t// Handle \"-\" button clicks\n\t\t\t\t$(\".qty-minus\").click(function () {\n\t\t\t\t\tlet company = $(this).data(\"company\");\n\t\t\t\t\tlet $input = $(`.qty-input[data-company='${company}']`);\n\t\t\t\t\tlet currentValue = parseInt($input.val(), 10) || 0;\n\t\t\t\t\tif (currentValue > 0) {\n\t\t\t\t\t\t$input.val(currentValue - 1);\n\t\t\t\t\t}\n\t\t\t\t\tupdateOrderButtonState();\n\t\t\t\t});\n\n\t\t\t\t// Prevent manual entry beyond limits for non-HQ rows\n\t\t\t\t$(\".qty-input\").on(\"input\", function () {\n\t\t\t\t\tlet maxQty = $(this).attr(\"max\")\n\t\t\t\t\t\t? parseInt($(this).attr(\"max\"), 10)\n\t\t\t\t\t\t: null;\n\t\t\t\t\tlet value = parseInt($(this).val(), 10) || 0;\n\t\t\t\t\tif (maxQty !== null && value > maxQty) {\n\t\t\t\t\t\t$(this).val(maxQty);\n\t\t\t\t\t}\n\t\t\t\t\tif (value < 0) {\n\t\t\t\t\t\t$(this).val(0);\n\t\t\t\t\t}\n\t\t\t\t\tupdateOrderButtonState();\n\t\t\t\t});\n\n\t\t\t\t// Handle \"Order\" click \u2192 Resolve Promise if at least one qty is > 0\n\t\t\t\t$(\".order-btn\").click(function () {\n\t\t\t\t\tif ($(this).prop(\"disabled\")) return;\n\n\t\t\t\t\tlet totalQty = 0;\n\t\t\t\t\tlet selectedCompany = \"\";\n\t\t\t\t\tlet isBackorder = false;\n\n\t\t\t\t\t$(\".qty-input\").each(function () {\n\t\t\t\t\t\tlet comp = $(this).data(\"company\");\n\t\t\t\t\t\tlet qty = parseInt($(this).val(), 10) || 0;\n\t\t\t\t\t\tif (qty > 0 && !selectedCompany) {\n\t\t\t\t\t\t\tselectedCompany = comp;\n\t\t\t\t\t\t\t// Check if the selected company allows backorder\n\t\t\t\t\t\t\tlet dealer = dealers.find(\n\t\t\t\t\t\t\t\t(d) => d.company === comp,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (dealer && dealer.allow_backorder) {\n\t\t\t\t\t\t\t\tisBackorder = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttotalQty += qty;\n\t\t\t\t\t});\n\n\t\t\t\t\t$popup.remove();\n\t\t\t\t\t$overlay.remove();\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tordered_qty: totalQty,\n\t\t\t\t\t\tcompany: selectedCompany,\n\t\t\t\t\t\tis_backorder: isBackorder,\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\t// Handle \"Close\" click \u2192 Reject Promise\n\t\t\t\t$(\".popup-close\").click(function () {\n\t\t\t\t\t$popup.remove();\n\t\t\t\t\t$overlay.remove();\n\t\t\t\t\treject();\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\t});\n}\n", "/* global edp_online_vehicles */\n\nedp_online_vehicles.PartOrder.ItemCart = class {\n\tconstructor({ wrapper, events, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.customer_info = undefined;\n\t\tthis.hide_images = false;\n\t\tthis.allowed_customer_groups = settings.customer_groups;\n\t\tthis.allow_rate_change = settings.allow_rate_change;\n\t\tthis.allow_discount_change = settings.allow_discount_change;\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_child_components();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"customer-cart-container\"></section>`,\n\t\t);\n\n\t\tthis.$component = this.wrapper.find(\".customer-cart-container\");\n\t}\n\n\tinit_child_components() {\n\t\tthis.init_customer_selector();\n\t\tthis.init_cart_components();\n\t}\n\n\tinit_customer_selector() {\n\t\tthis.$component.append(\n\t\t\t`<div class=\"customer-section\" style=\"display:none\"></div>`,\n\t\t);\n\t\tthis.$customer_section = this.$component.find(\".customer-section\");\n\n\t\tthis.$component.append(`<div class=\"legend-section\"></div>`);\n\t\tthis.$legend_section = this.$component.find(\".legend-section\");\n\n\t\tthis.make_legend_section();\n\n\t\tthis.make_customer_selector();\n\t}\n\n\treset_customer_selector() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrm.set_value(\"customer\", \"\");\n\t\tthis.make_customer_selector();\n\t\tthis.customer_field.set_focus();\n\t}\n\n\tinit_cart_components() {\n\t\tthis.$component.append(\n\t\t\t`<div class=\"cart-container\">\n\t\t\t\t<div class=\"abs-cart-container\">\n\t\t\t\t\t<div class=\"cart-label\">${__(\"Item Cart\")}</div>\n\t\t\t\t\t<div class=\"cart-header\">\n\t\t\t\t\t\t<div class=\"name-header\">${__(\"Item\")}</div>\n\t\t\t\t\t\t<div class=\"qty-header\">${__(\"Quantity\")}</div>\n\t\t\t\t\t\t<div class=\"rate-amount-header\">${__(\"Amount\")}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"cart-items-section\"></div>\n\t\t\t\t\t<div class=\"cart-totals-section\"></div>\n\t\t\t\t\t<div class=\"numpad-section\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`,\n\t\t);\n\t\tthis.$cart_container = this.$component.find(\".cart-container\");\n\n\t\tthis.make_cart_totals_section();\n\t\tthis.make_cart_items_section();\n\t\tthis.make_cart_numpad();\n\t}\n\n\tmake_cart_items_section() {\n\t\tthis.$cart_header = this.$component.find(\".cart-header\");\n\t\tthis.$cart_items_wrapper = this.$component.find(\".cart-items-section\");\n\n\t\tthis.make_no_items_placeholder();\n\t}\n\n\tmake_no_items_placeholder() {\n\t\tthis.$cart_header.css(\"display\", \"none\");\n\t\tthis.$cart_items_wrapper.html(\n\t\t\t`<div class=\"no-item-wrapper\">${__(\"No items in cart\")}</div>`,\n\t\t);\n\t}\n\n\tget_discount_icon() {\n\t\treturn `<svg class=\"discount-icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t<path d=\"M19 15.6213C19 15.2235 19.158 14.842 19.4393 14.5607L20.9393 13.0607C21.5251 12.4749 21.5251 11.5251 20.9393 10.9393L19.4393 9.43934C19.158 9.15804 19 8.7765 19 8.37868V6.5C19 5.67157 18.3284 5 17.5 5H15.6213C15.2235 5 14.842 4.84196 14.5607 4.56066L13.0607 3.06066C12.4749 2.47487 11.5251 2.47487 10.9393 3.06066L9.43934 4.56066C9.15804 4.84196 8.7765 5 8.37868 5H6.5C5.67157 5 5 5.67157 5 6.5V8.37868C5 8.7765 4.84196 9.15804 4.56066 9.43934L3.06066 10.9393C2.47487 11.5251 2.47487 12.4749 3.06066 13.0607L4.56066 14.5607C4.84196 14.842 5 15.2235 5 15.6213V17.5C5 18.3284 5.67157 19 6.5 19H8.37868C8.7765 19 9.15804 19.158 9.43934 19.4393L10.9393 20.9393C11.5251 21.5251 12.4749 21.5251 13.0607 20.9393L14.5607 19.4393C14.842 19.158 15.2235 19 15.6213 19H17.5C18.3284 19 19 18.3284 19 17.5V15.6213Z\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15 9L9 15\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M10.5 9.5C10.5 10.0523 10.0523 10.5 9.5 10.5C8.94772 10.5 8.5 10.0523 8.5 9.5C8.5 8.94772 8.94772 8.5 9.5 8.5C10.0523 8.5 10.5 8.94772 10.5 9.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15.5 14.5C15.5 15.0523 15.0523 15.5 14.5 15.5C13.9477 15.5 13.5 15.0523 13.5 14.5C13.5 13.9477 13.9477 13.5 14.5 13.5C15.0523 13.5 15.5 13.9477 15.5 14.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t</svg>`;\n\t}\n\n\tmake_cart_totals_section() {\n\t\tthis.$totals_section = this.$component.find(\".cart-totals-section\");\n\n\t\tthis.$totals_section.append(\n\t\t\t`<div class=\"add-discount-wrapper\" style=\"visibility: hidden\">\n\t\t\t\t${this.get_discount_icon()} ${__(\"Add Discount\")}\n\t\t\t</div>\n\t\t\t<div class=\"item-qty-total-container\">\n\t\t\t\t<div class=\"item-qty-total-label\">${__(\"Total Items\")}</div>\n\t\t\t\t<div class=\"item-qty-total-value\">0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"vat-total-container\">\n\t\t\t\t<div class=\"vat-total-label\">${__(\"VAT\")}</div>\n\t\t\t\t<div class=\"vat-total-value\">0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"net-total-container\">\n\t\t\t\t<div class=\"net-total-label\">${__(\"Net Total\")}</div>\n\t\t\t\t<div class=\"net-total-value\">0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"taxes-container\"></div>\n\t\t\t<div class=\"grand-total-container\">\n\t\t\t\t<div>${__(\"Grand Total\")}</div>\n\t\t\t\t<div>0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"checkout-btn\">${__(\"Checkout\")}</div>\n\t\t\t<div class=\"edit-cart-btn\">${__(\"Edit Cart\")}</div>`,\n\t\t);\n\n\t\tthis.$add_discount_elem = this.$component.find(\".add-discount-wrapper\");\n\t}\n\n\tmake_cart_numpad() {\n\t\tthis.$numpad_section = this.$component.find(\".numpad-section\");\n\n\t\tthis.number_pad = new edp_online_vehicles.PartOrder.NumberPad({\n\t\t\twrapper: this.$numpad_section,\n\t\t\tevents: {\n\t\t\t\tnumpad_event: this.on_numpad_event.bind(this),\n\t\t\t},\n\t\t\tcols: 5,\n\t\t\tkeys: [\n\t\t\t\t[1, 2, 3, \"Quantity\"],\n\t\t\t\t[4, 5, 6, \"Discount\"],\n\t\t\t\t[7, 8, 9, \"Rate\"],\n\t\t\t\t[\".\", 0, \"Delete\", \"Remove\"],\n\t\t\t],\n\t\t\tcss_classes: [\n\t\t\t\t[\"\", \"\", \"\", \"col-span-2\"],\n\t\t\t\t[\"\", \"\", \"\", \"col-span-2\"],\n\t\t\t\t[\"\", \"\", \"\", \"col-span-2\"],\n\t\t\t\t[\"\", \"\", \"\", \"col-span-2 remove-btn\"],\n\t\t\t],\n\t\t\tfieldnames_map: { Quantity: \"qty\" },\n\t\t\t//, Discount: \"discount_percentage\"\n\t\t});\n\n\t\tthis.$numpad_section.prepend(\n\t\t\t`<div class=\"numpad-totals\">\n\t\t\t<span class=\"numpad-item-qty-total\"></span>\n\t\t\t\t<span class=\"numpad-vat-total\"></span>\n\t\t\t\t<span class=\"numpad-net-total\"></span>\n\t\t\t\t<span class=\"numpad-grand-total\"></span>\n\t\t\t</div>`,\n\t\t);\n\n\t\tthis.$numpad_section.append(\n\t\t\t`<div class=\"numpad-btn checkout-btn\" data-button-value=\"checkout\">${__(\n\t\t\t\t\"Checkout\",\n\t\t\t)}</div>`,\n\t\t);\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\tthis.$customer_section.on(\"click\", \".reset-customer-btn\", function () {\n\t\t\tme.reset_customer_selector();\n\t\t});\n\n\t\tthis.$customer_section.on(\"click\", \".close-details-btn\", function () {\n\t\t\tme.toggle_customer_info(false);\n\t\t});\n\n\t\tthis.$customer_section.on(\"click\", \".customer-display\", function (e) {\n\t\t\tif ($(e.target).closest(\".reset-customer-btn\").length) return;\n\n\t\t\tconst show = me.$cart_container.is(\":visible\");\n\t\t\tme.toggle_customer_info(show);\n\t\t});\n\n\t\tthis.$cart_items_wrapper.on(\"click\", \".cart-item-wrapper\", function () {\n\t\t\tconst $cart_item = $(this);\n\n\t\t\tme.toggle_item_highlight(this);\n\n\t\t\tconst payment_section_hidden = !me.$totals_section\n\t\t\t\t.find(\".edit-cart-btn\")\n\t\t\t\t.is(\":visible\");\n\t\t\tif (!payment_section_hidden) {\n\t\t\t\t// payment section is visible\n\t\t\t\t// edit cart first and then open item details section\n\t\t\t\tme.$totals_section.find(\".edit-cart-btn\").click();\n\t\t\t}\n\n\t\t\tconst item_row_name = unescape($cart_item.attr(\"data-row-name\"));\n\t\t\tme.events.cart_item_clicked({ name: item_row_name });\n\t\t\tthis.numpad_value = \"\";\n\t\t});\n\n\t\tthis.$component.on(\"click\", \".checkout-btn\", async function () {\n\t\t\tif ($(this).attr(\"style\").indexOf(\"--blue-500\") == -1) return;\n\n\t\t\tawait me.events.checkout();\n\t\t\tme.toggle_checkout_btn(false);\n\n\t\t\tme.allow_discount_change &&\n\t\t\t\tme.$add_discount_elem.removeClass(\"d-none\");\n\t\t});\n\n\t\tthis.$totals_section.on(\"click\", \".edit-cart-btn\", () => {\n\t\t\tthis.events.edit_cart();\n\t\t\tthis.toggle_checkout_btn(true);\n\t\t});\n\n\t\t// this.$component.on(\"click\", \".add-discount-wrapper\", () => {\n\t\t// \tconst can_edit_discount = this.$add_discount_elem.find(\".edit-discount-btn\").length;\n\n\t\t// \tif (!this.discount_field || can_edit_discount) this.show_discount_control();\n\t\t// });\n\n\t\t// frappe.ui.form.on(\"Part Order\", \"paid_amount\", (frm) => {\n\t\t// \t// called when discount is applied\n\t\t// \tthis.update_totals_section(frm);\n\t\t// });\n\t}\n\n\tattach_shortcuts() {\n\t\tfor (let row of this.number_pad.keys) {\n\t\t\tfor (let btn of row) {\n\t\t\t\tif (typeof btn !== \"string\") continue; // do not make shortcuts for numbers\n\n\t\t\t\tlet shortcut_key = `ctrl+${frappe.scrub(String(btn))[0]}`;\n\t\t\t\tif (btn === \"Delete\") shortcut_key = \"ctrl+backspace\";\n\t\t\t\tif (btn === \"Remove\") shortcut_key = \"shift+ctrl+backspace\";\n\t\t\t\tif (btn === \".\") shortcut_key = \"ctrl+>\";\n\t\t\t\tif (btn === \"Discount\") shortcut_key = \"\";\n\t\t\t\tif (btn === \"Rate\") shortcut_key = \"\";\n\n\t\t\t\t// to account for fieldname map\n\t\t\t\tconst fieldname = this.number_pad.fieldnames[btn]\n\t\t\t\t\t? this.number_pad.fieldnames[btn]\n\t\t\t\t\t: typeof btn === \"string\"\n\t\t\t\t\t\t? frappe.scrub(btn)\n\t\t\t\t\t\t: btn;\n\n\t\t\t\tlet shortcut_label = \"\";\n\n\t\t\t\tif (shortcut_key) {\n\t\t\t\t\tshortcut_label = shortcut_key\n\t\t\t\t\t\t.split(\"+\")\n\t\t\t\t\t\t.map(frappe.utils.to_title_case)\n\t\t\t\t\t\t.join(\"+\");\n\t\t\t\t\tshortcut_label = frappe.utils.is_mac()\n\t\t\t\t\t\t? shortcut_label.replace(\"Ctrl\", \"\u2318\")\n\t\t\t\t\t\t: shortcut_label;\n\n\t\t\t\t\tthis.$numpad_section\n\t\t\t\t\t\t.find(`.numpad-btn[data-button-value=\"${fieldname}\"]`)\n\t\t\t\t\t\t.attr(\"title\", shortcut_label);\n\n\t\t\t\t\tfrappe.ui.keys.on(`${shortcut_key}`, () => {\n\t\t\t\t\t\tconst cart_is_visible = this.$component.is(\":visible\");\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tcart_is_visible &&\n\t\t\t\t\t\t\tthis.item_is_selected &&\n\t\t\t\t\t\t\tthis.$numpad_section.is(\":visible\")\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthis.$numpad_section\n\t\t\t\t\t\t\t\t.find(\n\t\t\t\t\t\t\t\t\t`.numpad-btn[data-button-value=\"${fieldname}\"]`,\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.click();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst ctrl_label = frappe.utils.is_mac() ? \"\u2318\" : \"Ctrl\";\n\t\tthis.$component\n\t\t\t.find(\".checkout-btn\")\n\t\t\t.attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+enter\",\n\t\t\taction: () => this.$component.find(\".checkout-btn\").click(),\n\t\t\tcondition: () =>\n\t\t\t\tthis.$component.is(\":visible\") &&\n\t\t\t\t!this.$totals_section.find(\".edit-cart-btn\").is(\":visible\"),\n\t\t\tdescription: __(\"Checkout Order / Submit Order / New Order\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page,\n\t\t});\n\t\tthis.$component.find(\".edit-cart-btn\").attr(\"title\", `${ctrl_label}+E`);\n\t\tfrappe.ui.keys.on(\"ctrl+e\", () => {\n\t\t\tconst item_cart_visible = this.$component.is(\":visible\");\n\t\t\tconst checkout_btn_invisible = !this.$totals_section\n\t\t\t\t.find(\".checkout-btn\")\n\t\t\t\t.is(\"visible\");\n\t\t\tif (item_cart_visible && checkout_btn_invisible) {\n\t\t\t\tthis.$component.find(\".edit-cart-btn\").click();\n\t\t\t}\n\t\t});\n\t\t// this.$component.find(\".add-discount-wrapper\").attr(\"title\", `${ctrl_label}+D`);\n\t\t// frappe.ui.keys.add_shortcut({\n\t\t// \tshortcut: \"ctrl+d\",\n\t\t// \taction: () => this.$component.find(\".add-discount-wrapper\").click(),\n\t\t// \tcondition: () => this.$add_discount_elem.is(\":visible\"),\n\t\t// \tdescription: __(\"Add Order Discount\"),\n\t\t// \tignore_inputs: true,\n\t\t// \tpage: cur_page.page.page,\n\t\t// });\n\t\tfrappe.ui.keys.on(\"escape\", () => {\n\t\t\tconst item_cart_visible = this.$component.is(\":visible\");\n\t\t\tif (\n\t\t\t\titem_cart_visible &&\n\t\t\t\tthis.discount_field &&\n\t\t\t\tthis.discount_field.parent.is(\":visible\")\n\t\t\t) {\n\t\t\t\tthis.discount_field.set_value(0);\n\t\t\t}\n\t\t});\n\t}\n\n\ttoggle_item_highlight(item) {\n\t\tconst $cart_item = $(item);\n\t\tconst item_is_highlighted =\n\t\t\t$cart_item.attr(\"style\") == \"background-color:var(--gray-50);\";\n\n\t\tif (!item || item_is_highlighted) {\n\t\t\tthis.item_is_selected = false;\n\t\t\tthis.$cart_container\n\t\t\t\t.find(\".cart-item-wrapper\")\n\t\t\t\t.css(\"background-color\", \"\");\n\t\t} else {\n\t\t\t$cart_item.css(\"background-color\", \"var(--control-bg)\");\n\t\t\tthis.item_is_selected = true;\n\t\t\tthis.$cart_container\n\t\t\t\t.find(\".cart-item-wrapper\")\n\t\t\t\t.not(item)\n\t\t\t\t.css(\"background-color\", \"\");\n\t\t}\n\t}\n\n\tmake_legend_section() {\n\t\tthis.$legend_section.html(`\n\t\t\t<div class=\"legend-field\">\n\t\t\t\t<p>\n\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap green\">\n\t\t\t\t\t\t<span>${__(\"HQ\")}</span>\n\t\t\t\t\t</span> - Stock Available at Head Office\n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap orange\">\n\t\t\t\t\t\t<span>${__(\"Dealer\")}</span>\n\t\t\t\t\t</span> - Stock Available at a Dealer\n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap red\">\n\t\t\t\t\t\t<span>${__(\"No Stock\")}</span>\n\t\t\t\t\t</span> - No Stock Available\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\tmake_customer_selector() {\n\t\tthis.$customer_section.html(`\n\t\t\t<div class=\"customer-field\"></div>\n\t\t`);\n\t\tconst me = this;\n\t\tconst allowed_customer_group = this.allowed_customer_groups || [];\n\t\tlet filters = {};\n\t\tif (allowed_customer_group.length) {\n\t\t\tfilters = {\n\t\t\t\tcustomer_group: [\"in\", allowed_customer_group],\n\t\t\t};\n\t\t}\n\t\tthis.customer_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Customer\"),\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Customer\",\n\t\t\t\tplaceholder: __(\"Search by customer name, phone, email.\"),\n\t\t\t\tget_query: function () {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: filters,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tonchange: function () {\n\t\t\t\t\tif (this.value) {\n\t\t\t\t\t\tconst frm = me.events.get_frm();\n\t\t\t\t\t\tfrappe.dom.freeze();\n\t\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\t\tfrm.doc.doctype,\n\t\t\t\t\t\t\tfrm.doc.name,\n\t\t\t\t\t\t\t\"customer\",\n\t\t\t\t\t\t\tthis.value,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tfrm.script_manager\n\t\t\t\t\t\t\t.trigger(\"customer\", frm.doc.doctype, frm.doc.name)\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t\t() => me.fetch_customer_details(this.value),\n\t\t\t\t\t\t\t\t\t() =>\n\t\t\t\t\t\t\t\t\t\tme.events.customer_details_updated(\n\t\t\t\t\t\t\t\t\t\t\tme.customer_info,\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t() => me.update_customer_section(),\n\t\t\t\t\t\t\t\t\t() => me.update_totals_section(),\n\t\t\t\t\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$customer_section.find(\".customer-field\"),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.customer_field.toggle_label(false);\n\t}\n\n\tfetch_customer_details(customer) {\n\t\tif (customer) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tfrappe.db\n\t\t\t\t\t.get_value(\"Customer\", customer, [\n\t\t\t\t\t\t\"email_id\",\n\t\t\t\t\t\t\"mobile_no\",\n\t\t\t\t\t\t\"image\",\n\t\t\t\t\t\t\"loyalty_program\",\n\t\t\t\t\t])\n\t\t\t\t\t.then(({ message }) => {\n\t\t\t\t\t\tconst { loyalty_program } = message;\n\t\t\t\t\t\t// if loyalty program then fetch loyalty points too\n\t\t\t\t\t\tif (loyalty_program) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.accounts.doctype.loyalty_program.loyalty_program.get_loyalty_program_details_with_points\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\tcustomer,\n\t\t\t\t\t\t\t\t\tloyalty_program,\n\t\t\t\t\t\t\t\t\tsilent: true,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\t\t\t\tloyalty_points,\n\t\t\t\t\t\t\t\t\t\tconversion_factor,\n\t\t\t\t\t\t\t\t\t} = r.message;\n\t\t\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\t\t\tthis.customer_info = {\n\t\t\t\t\t\t\t\t\t\t\t...message,\n\t\t\t\t\t\t\t\t\t\t\tcustomer,\n\t\t\t\t\t\t\t\t\t\t\tloyalty_points,\n\t\t\t\t\t\t\t\t\t\t\tconversion_factor,\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.customer_info = { ...message, customer };\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tthis.customer_info = {};\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\t}\n\n\tshow_discount_control() {\n\t\tthis.$add_discount_elem.css({ padding: \"0px\", border: \"none\" });\n\t\tthis.$add_discount_elem.html(`<div class=\"add-discount-field\"></div>`);\n\t\tconst me = this;\n\t\tconst frm = me.events.get_frm();\n\t\tlet discount = frm.doc.additional_discount_percentage;\n\n\t\tthis.discount_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Discount\"),\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tplaceholder: discount\n\t\t\t\t\t? discount + \"%\"\n\t\t\t\t\t: __(\"Enter discount percentage.\"),\n\t\t\t\tinput_class: \"input-xs\",\n\t\t\t\tonchange: function () {\n\t\t\t\t\tthis.value = flt(this.value);\n\t\t\t\t\tif (this.value > 100) {\n\t\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\t\ttitle: __(\"Invalid Discount\"),\n\t\t\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t\t\"Discount cannot be greater than 100%.\",\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.value = 0;\n\t\t\t\t\t}\n\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\tfrm.doc.doctype,\n\t\t\t\t\t\tfrm.doc.name,\n\t\t\t\t\t\t\"additional_discount_percentage\",\n\t\t\t\t\t\tflt(this.value),\n\t\t\t\t\t);\n\t\t\t\t\tme.hide_discount_control(this.value);\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$add_discount_elem.find(\".add-discount-field\"),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.discount_field.toggle_label(false);\n\t\tthis.discount_field.set_focus();\n\t}\n\n\thide_discount_control(discount) {\n\t\tif (!flt(discount)) {\n\t\t\tthis.$add_discount_elem.css({\n\t\t\t\tborder: \"1px dashed var(--gray-500)\",\n\t\t\t\tpadding: \"var(--padding-sm) var(--padding-md)\",\n\t\t\t});\n\t\t\tthis.$add_discount_elem.html(\n\t\t\t\t`${this.get_discount_icon()} ${__(\"Add Discount\")}`,\n\t\t\t);\n\t\t\tthis.discount_field = undefined;\n\t\t} else {\n\t\t\tthis.$add_discount_elem.css({\n\t\t\t\tborder: \"1px dashed var(--dark-green-500)\",\n\t\t\t\tpadding: \"var(--padding-sm) var(--padding-md)\",\n\t\t\t});\n\t\t\tthis.$add_discount_elem.html(\n\t\t\t\t`<div class=\"edit-discount-btn\">\n\t\t\t\t\t${this.get_discount_icon()} ${__(\"Additional\")}&nbsp;${String(discount).bold()}% ${__(\n\t\t\t\t\t\t\"discount applied\",\n\t\t\t\t\t)}\n\t\t\t\t</div>`,\n\t\t\t);\n\t\t}\n\t}\n\n\tupdate_customer_section() {\n\t\tconst me = this;\n\t\tconst {\n\t\t\tcustomer,\n\t\t\temail_id = \"\",\n\t\t\tmobile_no = \"\",\n\t\t\timage,\n\t\t} = this.customer_info || {};\n\n\t\tif (customer) {\n\t\t\tthis.$customer_section.html(\n\t\t\t\t`<div class=\"customer-details\">\n\t\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t\t<div class=\"customer-name\">${customer}</div>\n\t\t\t\t\t\t\t${get_customer_description()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"reset-customer-btn\" data-customer=\"${escape(customer)}\">\n\t\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`,\n\t\t\t);\n\t\t} else {\n\t\t\t// reset customer selector\n\t\t\tthis.reset_customer_selector();\n\t\t}\n\n\t\tfunction get_customer_description() {\n\t\t\tif (!email_id && !mobile_no) {\n\t\t\t\treturn `<div class=\"customer-desc\">${__(\"Click to add email / phone\")}</div>`;\n\t\t\t} else if (email_id && !mobile_no) {\n\t\t\t\treturn `<div class=\"customer-desc\">${email_id}</div>`;\n\t\t\t} else if (mobile_no && !email_id) {\n\t\t\t\treturn `<div class=\"customer-desc\">${mobile_no}</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"customer-desc\">${email_id} - ${mobile_no}</div>`;\n\t\t\t}\n\t\t}\n\t}\n\n\tget_customer_image() {\n\t\tconst { customer, image } = this.customer_info || {};\n\t\tif (image) {\n\t\t\treturn `<div class=\"customer-image\"><img src=\"${image}\" alt=\"${image}\"\"></div>`;\n\t\t} else {\n\t\t\treturn `<div class=\"customer-image customer-abbr\">${frappe.get_abbr(customer)}</div>`;\n\t\t}\n\t}\n\n\tupdate_totals_section(frm) {\n\t\tif (!frm) frm = this.events.get_frm();\n\n\t\tthis.render_net_total(frm.doc.total_excl);\n\t\tthis.render_vat_total(frm.doc.vat);\n\t\tthis.render_total_item_qty(frm.doc.table_avsu);\n\t\tconst grand_total = frm.doc.total_incl;\n\t\tthis.render_grand_total(grand_total);\n\n\t\t// this.render_taxes(frm.doc.taxes);\n\t}\n\n\trender_net_total(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section\n\t\t\t.find(\".net-total-container\")\n\t\t\t.html(\n\t\t\t\t`<div>${__(\"Net Total\")}</div><div>${format_currency(value, currency)}</div>`,\n\t\t\t);\n\n\t\tthis.$numpad_section\n\t\t\t.find(\".numpad-net-total\")\n\t\t\t.html(\n\t\t\t\t`<div>${__(\"Net Total\")}: <span>${format_currency(value, currency)}</span></div>`,\n\t\t\t);\n\t}\n\n\trender_vat_total(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section\n\t\t\t.find(\".vat-total-container\")\n\t\t\t.html(\n\t\t\t\t`<div>${__(\"VAT Total\")}</div><div>${format_currency(value, currency)}</div>`,\n\t\t\t);\n\n\t\tthis.$numpad_section\n\t\t\t.find(\".numpad-vat-total\")\n\t\t\t.html(\n\t\t\t\t`<div>${__(\"VAT Total\")}: <span>${format_currency(value, currency)}</span></div>`,\n\t\t\t);\n\t}\n\n\trender_total_item_qty(items) {\n\t\tvar total_item_qty = 0;\n\t\titems.map((item) => {\n\t\t\ttotal_item_qty = total_item_qty + item.qty;\n\t\t});\n\n\t\tthis.$totals_section\n\t\t\t.find(\".item-qty-total-container\")\n\t\t\t.html(\n\t\t\t\t`<div>${__(\"Total Quantity\")}</div><div>${total_item_qty}</div>`,\n\t\t\t);\n\n\t\tthis.$numpad_section\n\t\t\t.find(\".numpad-item-qty-total\")\n\t\t\t.html(\n\t\t\t\t`<div>${__(\"Total Quantity\")}: <span>${total_item_qty}</span></div>`,\n\t\t\t);\n\t}\n\n\trender_grand_total(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section\n\t\t\t.find(\".grand-total-container\")\n\t\t\t.html(\n\t\t\t\t`<div>${__(\"Grand Total\")}</div><div>${format_currency(value, currency)}</div>`,\n\t\t\t);\n\n\t\tthis.$numpad_section\n\t\t\t.find(\".numpad-grand-total\")\n\t\t\t.html(\n\t\t\t\t`<div>${__(\"Grand Total\")}: <span>${format_currency(value, currency)}</span></div>`,\n\t\t\t);\n\t}\n\n\trender_taxes(taxes) {\n\t\tif (taxes && taxes.length) {\n\t\t\tconst currency = this.events.get_frm().doc.currency;\n\t\t\tconst taxes_html = taxes\n\t\t\t\t.map((t) => {\n\t\t\t\t\tif (t.tax_amount_after_discount_amount == 0.0) return;\n\t\t\t\t\t// if tax rate is 0, don't print it.\n\t\t\t\t\tconst description = /[0-9]+/.test(t.description)\n\t\t\t\t\t\t? t.description\n\t\t\t\t\t\t: t.rate != 0\n\t\t\t\t\t\t\t? `${t.description} @ ${t.rate}%`\n\t\t\t\t\t\t\t: t.description;\n\t\t\t\t\treturn `<div class=\"tax-row\">\n\t\t\t\t\t<div class=\"tax-label\">${description}</div>\n\t\t\t\t\t<div class=\"tax-value\">${format_currency(t.tax_amount_after_discount_amount, currency)}</div>\n\t\t\t\t</div>`;\n\t\t\t\t})\n\t\t\t\t.join(\"\");\n\t\t\tthis.$totals_section\n\t\t\t\t.find(\".taxes-container\")\n\t\t\t\t.css(\"display\", \"flex\")\n\t\t\t\t.html(taxes_html);\n\t\t} else {\n\t\t\tthis.$totals_section\n\t\t\t\t.find(\".taxes-container\")\n\t\t\t\t.css(\"display\", \"none\")\n\t\t\t\t.html(\"\");\n\t\t}\n\t}\n\n\tget_cart_item({ name }) {\n\t\tconst item_selector = `.cart-item-wrapper[data-row-name=\"${escape(name)}\"]`;\n\t\treturn this.$cart_items_wrapper.find(item_selector);\n\t}\n\n\tget_item_from_frm(item) {\n\t\tconst doc = this.events.get_frm().doc;\n\t\treturn doc.table_avsu.find((i) => i.name == item.name);\n\t}\n\n\tupdate_item_html(item, remove_item) {\n\t\tconst $item = this.get_cart_item(item);\n\n\t\tif (remove_item) {\n\t\t\t$item && $item.next().remove() && $item.remove();\n\t\t} else {\n\t\t\tconst item_row = this.get_item_from_frm(item);\n\t\t\tthis.render_cart_item(item_row, $item);\n\t\t}\n\n\t\tconst no_of_cart_items =\n\t\t\tthis.$cart_items_wrapper.find(\".cart-item-wrapper\").length;\n\t\tthis.highlight_checkout_btn(no_of_cart_items > 0);\n\n\t\tthis.update_empty_cart_section(no_of_cart_items);\n\t}\n\n\trender_cart_item(item_data, $item_to_update) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tconst me = this;\n\n\t\tif (!$item_to_update.length) {\n\t\t\tthis.$cart_items_wrapper.append(\n\t\t\t\t`<div class=\"cart-item-wrapper\" data-row-name=\"${escape(item_data.name)}\"></div>\n\t\t\t\t<div class=\"seperator\"></div>`,\n\t\t\t);\n\t\t\t$item_to_update = this.get_cart_item(item_data);\n\t\t}\n\n\t\t$item_to_update.html(\n\t\t\t`${get_item_image_html()}\n\t\t\t<div class=\"item-name-desc\">\n\t\t\t\t<div class=\"item-name\">\n\t\t\t\t\t${item_data.description}\n\t\t\t\t</div>\n\t\t\t\t${get_description_html()}\n\t\t\t</div>\n\t\t\t${get_rate_discount_html()}`,\n\t\t);\n\n\t\tset_dynamic_rate_header_width();\n\n\t\tfunction set_dynamic_rate_header_width() {\n\t\t\tconst rate_cols = Array.from(\n\t\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\"),\n\t\t\t);\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", \"\");\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", \"\");\n\t\t\tlet max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\t\tif ($(elm).width() > max_width) max_width = $(elm).width();\n\t\t\t\treturn max_width;\n\t\t\t}, 0);\n\n\t\t\tmax_width += 1;\n\t\t\tif (max_width == 1) max_width = \"\";\n\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", max_width);\n\t\t\tme.$cart_items_wrapper\n\t\t\t\t.find(\".item-rate-amount\")\n\t\t\t\t.css(\"width\", max_width);\n\t\t}\n\n\t\tfunction get_rate_discount_html() {\n\t\t\tif (\n\t\t\t\titem_data.dealer_billing_excl &&\n\t\t\t\titem_data.total_excl &&\n\t\t\t\titem_data.dealer_billing_excl !== item_data.total_excl\n\t\t\t) {\n\t\t\t\tif (item_data.dealer_ordered_qty > 0) {\n\t\t\t\t\tif (item_data.backorder) {\n\t\t\t\t\t\treturn `\n\t\t\t\t\t\t<div class=\"item-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap orange\">\n\t\t\t\t\t\t\t\t<span>${__(\"Backorder\")}</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0}</span></div>\n\t\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.dealer_billing_excl, currency)}</div>\n\t\t\t\t\t\t\t\t<div class=\"item-amount\">${format_currency(item_data.total_excl, currency)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn `\n\t\t\t\t\t\t<div class=\"item-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap orange\">\n\t\t\t\t\t\t\t\t<span>${__(\"Dealer\")}</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0}</span></div>\n\t\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.dealer_billing_excl, currency)}</div>\n\t\t\t\t\t\t\t\t<div class=\"item-amount\">${format_currency(item_data.total_excl, currency)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-pill\">\n\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap green\">\n\t\t\t\t\t\t\t<span>${__(\"HQ\")}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0}</span></div>\n\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.dealer_billing_excl, currency)}</div>\n\t\t\t\t\t\t\t<div class=\"item-amount\">${format_currency(item_data.total_excl, currency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (item_data.dealer_ordered_qty > 0) {\n\t\t\t\t\tif (item_data.backorder) {\n\t\t\t\t\t\treturn `\n\t\t\t\t\t\t<div class=\"item-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap orange\">\n\t\t\t\t\t\t\t\t<span>${__(\"Backorder\")}</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0}</span></div>\n\t\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.dealer_billing_excl, currency)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn `\n\t\t\t\t\t\t<div class=\"item-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap orange\">\n\t\t\t\t\t\t\t\t<span>${__(\"Dealer\")}</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0}</span></div>\n\t\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.dealer_billing_excl, currency)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-pill\">\n\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap green\">\n\t\t\t\t\t\t\t<span>${__(\"HQ\")}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0}</span></div>\n\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.dealer_billing_excl, currency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction get_description_html() {\n\t\t\tif (item_data.description) {\n\t\t\t\tif (item_data.description.indexOf(\"<div>\") != -1) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\titem_data.description = $(item_data.description).text();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\titem_data.description = item_data.description\n\t\t\t\t\t\t\t.replace(/<div>/g, \" \")\n\t\t\t\t\t\t\t.replace(/<\\/div>/g, \" \")\n\t\t\t\t\t\t\t.replace(/ +/g, \" \");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\titem_data.description = frappe.ellipsis(\n\t\t\t\t\titem_data.description,\n\t\t\t\t\t45,\n\t\t\t\t);\n\t\t\t\treturn `<div class=\"item-desc\">${item_data.description}</div>`;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tfunction get_item_image_html() {\n\t\t\tconst { item_image, item_name } = item_data;\n\t\t\tif (!me.hide_images && item_image) {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-image\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tonerror=\"cur_pos.cart.handle_broken_image(this)\"\n\t\t\t\t\t\t\tsrc=\"${item_image}\" alt=\"${frappe.get_abbr(item_name)}\"\">\n\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-image item-abbr\">${frappe.get_abbr(item_name)}</div>`;\n\t\t\t}\n\t\t}\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr(\"alt\");\n\t\t$($img)\n\t\t\t.parent()\n\t\t\t.replaceWith(\n\t\t\t\t`<div class=\"item-image item-abbr\">${item_abbr}</div>`,\n\t\t\t);\n\t}\n\n\tupdate_selector_value_in_cart_item(selector, value, item) {\n\t\tconst $item_to_update = this.get_cart_item(item);\n\t\t$item_to_update.attr(`data-${selector}`, escape(value));\n\t}\n\n\ttoggle_checkout_btn(show_checkout) {\n\t\tif (show_checkout) {\n\t\t\tthis.$totals_section.find(\".checkout-btn\").css(\"display\", \"flex\");\n\t\t\tthis.$totals_section.find(\".edit-cart-btn\").css(\"display\", \"none\");\n\t\t} else {\n\t\t\tthis.$totals_section.find(\".checkout-btn\").css(\"display\", \"none\");\n\t\t\tthis.$totals_section.find(\".edit-cart-btn\").css(\"display\", \"flex\");\n\t\t}\n\t}\n\n\thighlight_checkout_btn(toggle) {\n\t\tif (toggle) {\n\t\t\tthis.$add_discount_elem.css(\"display\", \"flex\");\n\t\t\tthis.$cart_container.find(\".checkout-btn\").css({\n\t\t\t\t\"background-color\": \"var(--blue-500)\",\n\t\t\t});\n\t\t} else {\n\t\t\tthis.$add_discount_elem.css(\"display\", \"none\");\n\t\t\tthis.$cart_container.find(\".checkout-btn\").css({\n\t\t\t\t\"background-color\": \"var(--blue-200)\",\n\t\t\t});\n\t\t}\n\t}\n\n\tupdate_empty_cart_section(no_of_cart_items) {\n\t\tconst $no_item_element =\n\t\t\tthis.$cart_items_wrapper.find(\".no-item-wrapper\");\n\n\t\t// if cart has items and no item is present\n\t\tno_of_cart_items > 0 &&\n\t\t\t$no_item_element &&\n\t\t\t$no_item_element.remove() &&\n\t\t\tthis.$cart_header.css(\"display\", \"flex\");\n\n\t\tno_of_cart_items === 0 &&\n\t\t\t!$no_item_element.length &&\n\t\t\tthis.make_no_items_placeholder();\n\t}\n\n\ton_numpad_event($btn) {\n\t\tconst current_action = $btn.attr(\"data-button-value\");\n\t\tconst action_is_field_edit = [\n\t\t\t\"qty\",\n\t\t\t\"discount_percentage\",\n\t\t\t\"rate\",\n\t\t].includes(current_action);\n\t\tconst action_is_allowed = action_is_field_edit\n\t\t\t? (current_action == \"rate\" && this.allow_rate_change) ||\n\t\t\t\t(current_action == \"discount_percentage\" &&\n\t\t\t\t\tthis.allow_discount_change) ||\n\t\t\t\tcurrent_action == \"qty\"\n\t\t\t: true;\n\n\t\tconst action_is_pressed_twice = this.prev_action === current_action;\n\t\tconst first_click_event = !this.prev_action;\n\t\tconst field_to_edit_changed =\n\t\t\tthis.prev_action && this.prev_action != current_action;\n\n\t\tif (action_is_field_edit) {\n\t\t\tif (!action_is_allowed) {\n\t\t\t\tconst label =\n\t\t\t\t\tcurrent_action == \"rate\"\n\t\t\t\t\t\t? \"Rate\".bold()\n\t\t\t\t\t\t: \"Discount\".bold();\n\t\t\t\tconst message = __(\n\t\t\t\t\t\"Editing {0} is not allowed as per POS Profile settings\",\n\t\t\t\t\t[label],\n\t\t\t\t);\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\tmessage: message,\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (first_click_event || field_to_edit_changed) {\n\t\t\t\tthis.prev_action = current_action;\n\t\t\t} else if (action_is_pressed_twice) {\n\t\t\t\tthis.prev_action = undefined;\n\t\t\t}\n\t\t\tthis.numpad_value = \"\";\n\t\t} else if (current_action === \"checkout\") {\n\t\t\tthis.prev_action = undefined;\n\t\t\tthis.toggle_item_highlight();\n\t\t\tthis.events.numpad_event(undefined, current_action);\n\t\t\treturn;\n\t\t} else if (current_action === \"remove\") {\n\t\t\tthis.prev_action = undefined;\n\t\t\tthis.toggle_item_highlight();\n\t\t\tthis.events.numpad_event(undefined, current_action);\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.numpad_value =\n\t\t\t\tcurrent_action === \"delete\"\n\t\t\t\t\t? this.numpad_value.slice(0, -1)\n\t\t\t\t\t: this.numpad_value + current_action;\n\t\t\tthis.numpad_value = this.numpad_value || 0;\n\t\t}\n\n\t\tconst first_click_event_is_not_field_edit =\n\t\t\t!action_is_field_edit && first_click_event;\n\n\t\tif (first_click_event_is_not_field_edit) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tindicator: \"red\",\n\t\t\t\tmessage: __(\"Please select a field to edit from numpad\"),\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tflt(this.numpad_value) > 100 &&\n\t\t\tthis.prev_action === \"discount_percentage\"\n\t\t) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Discount cannot be greater than 100%\"),\n\t\t\t\tindicator: \"orange\",\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\tthis.numpad_value = current_action;\n\t\t}\n\n\t\tthis.highlight_numpad_btn($btn, current_action);\n\t\tthis.events.numpad_event(this.numpad_value, this.prev_action);\n\t}\n\n\thighlight_numpad_btn($btn, curr_action) {\n\t\tconst curr_action_is_highlighted = $btn.hasClass(\n\t\t\t\"highlighted-numpad-btn\",\n\t\t);\n\t\tconst curr_action_is_action = [\n\t\t\t\"qty\",\n\t\t\t\"discount_percentage\",\n\t\t\t\"rate\",\n\t\t\t\"done\",\n\t\t].includes(curr_action);\n\n\t\tif (!curr_action_is_highlighted) {\n\t\t\t$btn.addClass(\"highlighted-numpad-btn\");\n\t\t}\n\t\tif (this.prev_action === curr_action && curr_action_is_highlighted) {\n\t\t\t// if Qty is pressed twice\n\t\t\t$btn.removeClass(\"highlighted-numpad-btn\");\n\t\t}\n\t\tif (\n\t\t\tthis.prev_action &&\n\t\t\tthis.prev_action !== curr_action &&\n\t\t\tcurr_action_is_action\n\t\t) {\n\t\t\t// Order: Qty -> Rate then remove Qty highlight\n\t\t\tconst prev_btn = $(`[data-button-value='${this.prev_action}']`);\n\t\t\tprev_btn.removeClass(\"highlighted-numpad-btn\");\n\t\t}\n\t\tif (!curr_action_is_action || curr_action === \"done\") {\n\t\t\t// if numbers are clicked\n\t\t\tsetTimeout(() => {\n\t\t\t\t$btn.removeClass(\"highlighted-numpad-btn\");\n\t\t\t}, 200);\n\t\t}\n\t}\n\n\ttoggle_numpad(show) {\n\t\tif (show) {\n\t\t\tthis.$totals_section.css(\"display\", \"none\");\n\t\t\tthis.$numpad_section.css(\"display\", \"flex\");\n\t\t} else {\n\t\t\tthis.$totals_section.css(\"display\", \"flex\");\n\t\t\tthis.$numpad_section.css(\"display\", \"none\");\n\t\t}\n\t\tthis.reset_numpad();\n\t}\n\n\treset_numpad() {\n\t\tthis.numpad_value = \"\";\n\t\tthis.prev_action = undefined;\n\t\tthis.$numpad_section\n\t\t\t.find(\".highlighted-numpad-btn\")\n\t\t\t.removeClass(\"highlighted-numpad-btn\");\n\t}\n\n\ttoggle_numpad_field_edit(fieldname) {\n\t\tif ([\"qty\", \"discount_percentage\", \"rate\"].includes(fieldname)) {\n\t\t\tthis.$numpad_section\n\t\t\t\t.find(`[data-button-value=\"${fieldname}\"]`)\n\t\t\t\t.click();\n\t\t}\n\t}\n\n\ttoggle_customer_info(show) {\n\t\tif (show) {\n\t\t\tconst { customer } = this.customer_info || {};\n\n\t\t\tthis.$cart_container.css(\"display\", \"none\");\n\t\t\tthis.$customer_section.css({\n\t\t\t\theight: \"100%\",\n\t\t\t\t\"padding-top\": \"0px\",\n\t\t\t});\n\t\t\tthis.$customer_section.find(\".customer-details\").html(\n\t\t\t\t`<div class=\"header\">\n\t\t\t\t\t<div class=\"label\">${__(\"Contact Details\")}</div>\n\t\t\t\t\t<div class=\"close-details-btn\">\n\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t<div class=\"customer-name\">${customer}</div>\n\t\t\t\t\t\t<div class=\"customer-desc\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-fields-container\">\n\t\t\t\t\t<div class=\"email_id-field\"></div>\n\t\t\t\t\t<div class=\"mobile_no-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_program-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_points-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"transactions-label\">${__(\"Recent Transactions\")}</div>`,\n\t\t\t);\n\t\t\t// transactions need to be in diff div from sticky elem for scrolling\n\t\t\tthis.$customer_section.append(\n\t\t\t\t`<div class=\"customer-transactions\"></div>`,\n\t\t\t);\n\n\t\t\tthis.render_customer_fields();\n\t\t\tthis.fetch_customer_transactions();\n\t\t} else {\n\t\t\tthis.$cart_container.css(\"display\", \"flex\");\n\t\t\tthis.$customer_section.css({\n\t\t\t\theight: \"\",\n\t\t\t\t\"padding-top\": \"\",\n\t\t\t});\n\n\t\t\tthis.update_customer_section();\n\t\t}\n\t}\n\n\trender_customer_fields() {\n\t\tconst $customer_form = this.$customer_section.find(\n\t\t\t\".customer-fields-container\",\n\t\t);\n\n\t\tconst dfs = [\n\t\t\t{\n\t\t\t\tfieldname: \"email_id\",\n\t\t\t\tlabel: __(\"Email\"),\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\toptions: \"email\",\n\t\t\t\tplaceholder: __(\"Enter customer's email\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"mobile_no\",\n\t\t\t\tlabel: __(\"Phone Number\"),\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tplaceholder: __(\"Enter customer's phone number\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"loyalty_program\",\n\t\t\t\tlabel: __(\"Loyalty Program\"),\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Loyalty Program\",\n\t\t\t\tplaceholder: __(\"Select Loyalty Program\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"loyalty_points\",\n\t\t\t\tlabel: __(\"Loyalty Points\"),\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t];\n\n\t\tconst me = this;\n\t\tdfs.forEach((df) => {\n\t\t\tthis[`customer_${df.fieldname}_field`] =\n\t\t\t\tfrappe.ui.form.make_control({\n\t\t\t\t\tdf: df,\n\t\t\t\t\tparent: $customer_form.find(`.${df.fieldname}-field`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\tthis[`customer_${df.fieldname}_field`].$input?.on(\"blur\", () => {\n\t\t\t\thandle_customer_field_change.apply(\n\t\t\t\t\tthis[`customer_${df.fieldname}_field`],\n\t\t\t\t);\n\t\t\t});\n\t\t\tthis[`customer_${df.fieldname}_field`].set_value(\n\t\t\t\tthis.customer_info[df.fieldname],\n\t\t\t);\n\t\t});\n\n\t\tfunction handle_customer_field_change() {\n\t\t\tconst current_value = me.customer_info[this.df.fieldname];\n\t\t\tconst current_customer = me.customer_info.customer;\n\n\t\t\tif (\n\t\t\t\tthis.value &&\n\t\t\t\tcurrent_value != this.value &&\n\t\t\t\tthis.df.fieldname != \"loyalty_points\"\n\t\t\t) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.set_customer_info\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tfieldname: this.df.fieldname,\n\t\t\t\t\t\tcustomer: current_customer,\n\t\t\t\t\t\tvalue: this.value,\n\t\t\t\t\t},\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\tme.customer_info[this.df.fieldname] = this.value;\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t\t\t\"Customer contact updated successfully.\",\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tfetch_customer_transactions() {\n\t\t// frappe.db\n\t\t// \t.get_list(\"Part Order\", {\n\t\t// \t\tfilters: { customer: this.customer_info.customer, docstatus: 1 },\n\t\t// \t\tfields: [\"name\", \"grand_total\", \"status\", \"posting_date\", \"posting_time\", \"currency\"],\n\t\t// \t\tlimit: 20,\n\t\t// \t})\n\t\t// \t.then((res) => {\n\t\t// \t\tconst transaction_container = this.$customer_section.find(\".customer-transactions\");\n\t\t// \t\tif (!res.length) {\n\t\t// \t\t\ttransaction_container.html(\n\t\t// \t\t\t\t`<div class=\"no-transactions-placeholder\">${__(\"No recent transactions found\")}</div>`\n\t\t// \t\t\t);\n\t\t// \t\t\treturn;\n\t\t// \t\t}\n\t\t// \t\tconst elapsed_time = moment(res[0].posting_date + \" \" + res[0].posting_time).fromNow();\n\t\t// \t\tthis.$customer_section\n\t\t// \t\t\t.find(\".customer-desc\")\n\t\t// \t\t\t.html(`${__(\"Last transacted\")} ${__(elapsed_time)}`);\n\t\t// \t\tres.forEach((invoice) => {\n\t\t// \t\t\tconst posting_datetime = frappe.datetime.str_to_user(\n\t\t// \t\t\t\tinvoice.posting_date + \" \" + invoice.posting_time\n\t\t// \t\t\t);\n\t\t// \t\t\tlet indicator_color = {\n\t\t// \t\t\t\tPaid: \"green\",\n\t\t// \t\t\t\tDraft: \"red\",\n\t\t// \t\t\t\tReturn: \"gray\",\n\t\t// \t\t\t\tConsolidated: \"blue\",\n\t\t// \t\t\t};\n\t\t// \t\t\ttransaction_container.append(\n\t\t// \t\t\t\t`<div class=\"invoice-wrapper\" data-invoice-name=\"${escape(invoice.name)}\">\n\t\t// \t\t\t\t<div class=\"invoice-name-date\">\n\t\t// \t\t\t\t\t<div class=\"invoice-name\">${invoice.name}</div>\n\t\t// \t\t\t\t\t<div class=\"invoice-date\">${posting_datetime}</div>\n\t\t// \t\t\t\t</div>\n\t\t// \t\t\t\t<div class=\"invoice-total-status\">\n\t\t// \t\t\t\t\t<div class=\"invoice-total\">\n\t\t// \t\t\t\t\t\t${format_currency(invoice.grand_total, invoice.currency, 0) || 0}\n\t\t// \t\t\t\t\t</div>\n\t\t// \t\t\t\t\t<div class=\"invoice-status\">\n\t\t// \t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color[invoice.status]}\">\n\t\t// \t\t\t\t\t\t\t<span>${__(invoice.status)}</span>\n\t\t// \t\t\t\t\t\t</span>\n\t\t// \t\t\t\t\t</div>\n\t\t// \t\t\t\t</div>\n\t\t// \t\t\t</div>\n\t\t// \t\t\t<div class=\"seperator\"></div>`\n\t\t// \t\t\t);\n\t\t// \t\t});\n\t\t// \t});\n\t}\n\n\tattach_refresh_field_event(frm) {\n\t\t$(frm.wrapper).off(\"refresh-fields\");\n\t\t$(frm.wrapper).on(\"refresh-fields\", () => {\n\t\t\tif (frm.doc.table_avsu.length) {\n\t\t\t\tthis.$cart_items_wrapper.html(\"\");\n\t\t\t\tfrm.doc.table_avsu.forEach((item) => {\n\t\t\t\t\tthis.update_item_html(item);\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.update_totals_section(frm);\n\t\t});\n\t}\n\n\tload_invoice() {\n\t\tconst frm = this.events.get_frm();\n\n\t\tthis.attach_refresh_field_event(frm);\n\n\t\tthis.fetch_customer_details(frm.doc.customer).then(() => {\n\t\t\t// this.events.customer_details_updated(this.customer_info);\n\t\t\t// this.update_customer_section();\n\t\t});\n\n\t\tthis.$cart_items_wrapper.html(\"\");\n\t\tif (frm.doc.table_avsu.length) {\n\t\t\tfrm.doc.table_avsu.forEach((item) => {\n\t\t\t\tthis.update_item_html(item);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.make_no_items_placeholder();\n\t\t\tthis.highlight_checkout_btn(false);\n\t\t}\n\n\t\tthis.hide_discount_control(frm.doc.additional_discount_percentage);\n\t\tthis.update_totals_section(frm);\n\n\t\tif (frm.doc.docstatus === 1) {\n\t\t\tthis.$totals_section.find(\".checkout-btn\").css(\"display\", \"none\");\n\t\t\tthis.$totals_section.find(\".edit-cart-btn\").css(\"display\", \"none\");\n\t\t} else {\n\t\t\tthis.$totals_section.find(\".checkout-btn\").css(\"display\", \"flex\");\n\t\t\tthis.$totals_section.find(\".edit-cart-btn\").css(\"display\", \"none\");\n\t\t}\n\n\t\tthis.toggle_component(true);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow\n\t\t\t? this.$component.css(\"display\", \"flex\")\n\t\t\t: this.$component.css(\"display\", \"none\");\n\t}\n};\n", "/* global edp_online_vehicles, cur_pos, erpnext */\n\nedp_online_vehicles.PartOrder.ItemDetails = class {\n\tconstructor({ wrapper, events, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.allow_rate_change = settings.allow_rate_change;\n\t\tthis.allow_discount_change = settings.allow_discount_change;\n\t\tthis.current_item = {};\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_child_components();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"item-details-container\"></section>`,\n\t\t);\n\n\t\tthis.$component = this.wrapper.find(\".item-details-container\");\n\t}\n\n\tinit_child_components() {\n\t\tthis.$component.html(\n\t\t\t`<div class=\"item-details-header\">\n\t\t\t\t<div class=\"label\">${__(\"Item Details\")}</div>\n\t\t\t\t<div class=\"close-btn\">\n\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"item-display\">\n\t\t\t\t<div class=\"item-name-desc-price\">\n\t\t\t\t\t<div class=\"item-name\"></div>\n\t\t\t\t\t<div class=\"item-desc\"></div>\n\t\t\t\t\t<div class=\"item-price\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"item-image\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"discount-section\"></div>\n\t\t\t<div class=\"form-container\"></div>\n\t\t\t<div class=\"serial-batch-container\"></div>`,\n\t\t);\n\n\t\tthis.$item_name = this.$component.find(\".item-name\");\n\t\tthis.$item_description = this.$component.find(\".item-desc\");\n\t\tthis.$item_price = this.$component.find(\".item-price\");\n\t\tthis.$item_image = this.$component.find(\".item-image\");\n\t\tthis.$form_container = this.$component.find(\".form-container\");\n\t\tthis.$dicount_section = this.$component.find(\".discount-section\");\n\t\tthis.$serial_batch_container = this.$component.find(\n\t\t\t\".serial-batch-container\",\n\t\t);\n\t}\n\n\tcompare_with_current_item(item) {\n\t\t// returns true if `item` is currently being edited\n\t\treturn item && item.name == this.current_item.name;\n\t}\n\n\tasync toggle_item_details_section(item) {\n\t\tconst current_item_changed = !this.compare_with_current_item(item);\n\n\t\t// if item is null or highlighted cart item is clicked twice\n\t\tconst hide_item_details = !Boolean(item) || !current_item_changed;\n\n\t\tif ((!hide_item_details && current_item_changed) || hide_item_details) {\n\t\t\t// if item details is being closed OR if item details is opened but item is changed\n\t\t\t// in both cases, if the current item is a serialized item, then validate and remove the item\n\t\t\tawait this.validate_serial_batch_item();\n\t\t}\n\n\t\tthis.events.toggle_item_selector(!hide_item_details);\n\t\tthis.toggle_component(!hide_item_details);\n\n\t\tif (item && current_item_changed) {\n\t\t\tthis.doctype = item.doctype;\n\t\t\tthis.item_meta = frappe.get_meta(this.doctype);\n\t\t\tthis.name = item.name;\n\t\t\tthis.item_row = item;\n\t\t\tthis.currency = this.events.get_frm().doc.currency;\n\n\t\t\tthis.current_item = item;\n\n\t\t\tthis.render_dom(item);\n\t\t\tthis.render_discount_dom(item);\n\t\t\tthis.render_form(item);\n\t\t\tthis.events.highlight_cart_item(item);\n\t\t} else {\n\t\t\tthis.current_item = {};\n\t\t}\n\t}\n\n\tvalidate_serial_batch_item() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst item_row = doc.items.find((item) => item.name === this.name);\n\n\t\tif (!item_row) return;\n\n\t\tconst serialized = item_row.has_serial_no;\n\t\tconst batched = item_row.has_batch_no;\n\t\tconst no_bundle_selected =\n\t\t\t!item_row.serial_and_batch_bundle &&\n\t\t\t!item_row.serial_no &&\n\t\t\t!item_row.batch_no;\n\n\t\tif (\n\t\t\t(serialized && no_bundle_selected) ||\n\t\t\t(batched && no_bundle_selected)\n\t\t) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\n\t\t\t\t\t\"Item is removed since no serial / batch no selected.\",\n\t\t\t\t),\n\t\t\t\tindicator: \"orange\",\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\treturn this.events.remove_item_from_cart();\n\t\t}\n\t}\n\n\trender_dom(item) {\n\t\tlet { part_no, description, item_image, dealer_billing_excl } = item;\n\n\t\tfunction get_description_html() {\n\t\t\tif (description) {\n\t\t\t\tdescription =\n\t\t\t\t\tdescription.indexOf(\"...\") === -1 &&\n\t\t\t\t\tdescription.length > 140\n\t\t\t\t\t\t? description.substr(0, 139) + \"...\"\n\t\t\t\t\t\t: description;\n\t\t\t\treturn description;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tthis.$item_name.html(description);\n\t\tthis.$item_description.html(get_description_html());\n\t\tthis.$item_price.html(\n\t\t\tformat_currency(dealer_billing_excl, this.currency),\n\t\t);\n\t\tif (!this.hide_images && item_image) {\n\t\t\tthis.$item_image.html(\n\t\t\t\t`<img\n\t\t\t\t\tonerror=\"cur_pos.item_details.handle_broken_image(this)\"\n\t\t\t\t\tclass=\"h-full\" src=\"${item_image}\"\n\t\t\t\t\talt=\"${frappe.get_abbr(description)}\"\n\t\t\t\t\tstyle=\"object-fit: cover;\">`,\n\t\t\t);\n\t\t} else {\n\t\t\tthis.$item_image.html(\n\t\t\t\t`<div class=\"item-abbr\">${frappe.get_abbr(description)}</div>`,\n\t\t\t);\n\t\t}\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr(\"alt\");\n\t\t$($img).replaceWith(`<div class=\"item-abbr\">${item_abbr}</div>`);\n\t}\n\n\trender_discount_dom(item) {\n\t\tif (item.discount_percentage) {\n\t\t\tthis.$dicount_section.html(\n\t\t\t\t`<div class=\"item-rate\">${format_currency(\n\t\t\t\t\titem.price_list_rate,\n\t\t\t\t\tthis.currency,\n\t\t\t\t)}</div>\n\t\t\t\t<div class=\"item-discount\">${item.discount_percentage}% off</div>`,\n\t\t\t);\n\t\t\tthis.$item_price.html(format_currency(item.rate, this.currency));\n\t\t} else {\n\t\t\tthis.$dicount_section.html(``);\n\t\t}\n\t}\n\n\trender_form(item) {\n\t\tconst fields_to_display = this.get_form_fields(item);\n\t\tthis.$form_container.html(\"\");\n\n\t\tfields_to_display.forEach((fieldname, idx) => {\n\t\t\tthis.$form_container.append(\n\t\t\t\t`<div class=\"${fieldname}-control\" data-fieldname=\"${fieldname}\"></div>`,\n\t\t\t);\n\n\t\t\tconst field_meta = this.item_meta.fields.find(\n\t\t\t\t(df) => df.fieldname === fieldname,\n\t\t\t);\n\t\t\tfieldname === \"discount_percentage\"\n\t\t\t\t? (field_meta.label = __(\"Discount (%)\"))\n\t\t\t\t: \"\";\n\t\t\tconst me = this;\n\n\t\t\tthis[`${fieldname}_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\t...field_meta,\n\t\t\t\t\tonchange: function () {\n\t\t\t\t\t\tme.events.form_updated(\n\t\t\t\t\t\t\tme.current_item,\n\t\t\t\t\t\t\tfieldname,\n\t\t\t\t\t\t\tthis.value,\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tparent: this.$form_container.find(`.${fieldname}-control`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`${fieldname}_control`].set_value(item[fieldname]);\n\t\t});\n\n\t\tthis.make_auto_serial_selection_btn(item);\n\n\t\tthis.bind_custom_control_change_event();\n\t}\n\n\tget_form_fields(item) {\n\t\tconst fields = [\"qty\"];\n\t\tif (item.has_serial_no) fields.push(\"serial_no\");\n\t\tif (item.has_batch_no) fields.push(\"batch_no\");\n\t\treturn fields;\n\t}\n\n\tmake_auto_serial_selection_btn(item) {\n\t\tif (item.has_serial_no || item.has_batch_no) {\n\t\t\tif (item.has_serial_no && item.has_batch_no) {\n\t\t\t\tthis.$form_container.append(\n\t\t\t\t\t`<div class=\"btn btn-sm btn-secondary auto-fetch-btn\" style=\"margin-top: 6px\">${__(\n\t\t\t\t\t\t\"Select Serial No / Batch No\",\n\t\t\t\t\t)}</div>`,\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tconst classname = item.has_serial_no\n\t\t\t\t\t? \".serial_no-control\"\n\t\t\t\t\t: \".batch_no-control\";\n\t\t\t\tconst label = item.has_serial_no\n\t\t\t\t\t? __(\"Select Serial No\")\n\t\t\t\t\t: __(\"Select Batch No\");\n\t\t\t\tthis.$form_container\n\t\t\t\t\t.find(classname)\n\t\t\t\t\t.append(\n\t\t\t\t\t\t`<div class=\"btn btn-sm btn-secondary auto-fetch-btn\" style=\"margin-top: 6px\">${label}</div>`,\n\t\t\t\t\t);\n\t\t\t}\n\t\t\tthis.$form_container\n\t\t\t\t.find(\".serial_no-control\")\n\t\t\t\t.find(\"textarea\")\n\t\t\t\t.css(\"height\", \"6rem\");\n\t\t}\n\t}\n\n\tbind_custom_control_change_event() {\n\t\tconst me = this;\n\t\tif (this.rate_control) {\n\t\t\tthis.rate_control.df.onchange = function () {\n\t\t\t\tif (this.value || flt(this.value) === 0) {\n\t\t\t\t\tme.events\n\t\t\t\t\t\t.form_updated(me.current_item, \"rate\", this.value)\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tconst item_row = frappe.get_doc(\n\t\t\t\t\t\t\t\tme.doctype,\n\t\t\t\t\t\t\t\tme.name,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tconst doc = me.events.get_frm().doc;\n\t\t\t\t\t\t\tme.$item_price.html(\n\t\t\t\t\t\t\t\tformat_currency(item_row.rate, doc.currency),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tme.render_discount_dom(item_row);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.rate_control.df.read_only = !this.allow_rate_change;\n\t\t\tthis.rate_control.refresh();\n\t\t}\n\n\t\tif (this.discount_percentage_control && !this.allow_discount_change) {\n\t\t\tthis.discount_percentage_control.df.read_only = 1;\n\t\t\tthis.discount_percentage_control.refresh();\n\t\t}\n\n\t\tif (this.warehouse_control) {\n\t\t\tthis.warehouse_control.df.reqd = 1;\n\t\t\tthis.warehouse_control.df.onchange = function () {\n\t\t\t\tif (this.value) {\n\t\t\t\t\tme.events\n\t\t\t\t\t\t.form_updated(me.current_item, \"warehouse\", this.value)\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tme.item_stock_map = me.events.get_item_stock_map();\n\t\t\t\t\t\t\tconst available_qty =\n\t\t\t\t\t\t\t\tme.item_stock_map[me.item_row.item_code][\n\t\t\t\t\t\t\t\t\tthis.value\n\t\t\t\t\t\t\t\t][0];\n\t\t\t\t\t\t\tconst is_stock_item = Boolean(\n\t\t\t\t\t\t\t\tme.item_stock_map[me.item_row.item_code][\n\t\t\t\t\t\t\t\t\tthis.value\n\t\t\t\t\t\t\t\t][1],\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (available_qty === undefined) {\n\t\t\t\t\t\t\t\tme.events\n\t\t\t\t\t\t\t\t\t.get_available_stock(\n\t\t\t\t\t\t\t\t\t\tme.item_row.item_code,\n\t\t\t\t\t\t\t\t\t\tthis.value,\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\t\t// item stock map is updated now reset warehouse\n\t\t\t\t\t\t\t\t\t\tme.warehouse_control.set_value(\n\t\t\t\t\t\t\t\t\t\t\tthis.value,\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else if (available_qty === 0 && is_stock_item) {\n\t\t\t\t\t\t\t\tme.warehouse_control.set_value(\"\");\n\t\t\t\t\t\t\t\tconst bold_item_code =\n\t\t\t\t\t\t\t\t\tme.item_row.item_code.bold();\n\t\t\t\t\t\t\t\tconst bold_warehouse = this.value.bold();\n\t\t\t\t\t\t\t\tfrappe.throw(\n\t\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\t\"Item Code: {0} is not available under warehouse {1}.\",\n\t\t\t\t\t\t\t\t\t\t[bold_item_code, bold_warehouse],\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tme.actual_qty_control.set_value(available_qty);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.warehouse_control.df.get_query = () => {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\tcompany: this.events.get_frm().doc.company,\n\t\t\t\t\t\tis_group: 0,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t};\n\t\t\tthis.warehouse_control.refresh();\n\t\t}\n\n\t\tif (this.serial_no_control) {\n\t\t\tthis.serial_no_control.df.reqd = 1;\n\t\t\tthis.serial_no_control.df.onchange = async function () {\n\t\t\t\t!me.current_item.batch_no && (await me.auto_update_batch_no());\n\t\t\t\tme.events.form_updated(\n\t\t\t\t\tme.current_item,\n\t\t\t\t\t\"serial_no\",\n\t\t\t\t\tthis.value,\n\t\t\t\t);\n\t\t\t};\n\t\t\tthis.serial_no_control.refresh();\n\t\t}\n\n\t\tif (this.batch_no_control) {\n\t\t\tthis.batch_no_control.df.reqd = 1;\n\t\t\tthis.batch_no_control.df.get_query = () => {\n\t\t\t\treturn {\n\t\t\t\t\tquery: \"erpnext.controllers.queries.get_batch_no\",\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\titem_code: me.item_row.item_code,\n\t\t\t\t\t\twarehouse: me.item_row.warehouse,\n\t\t\t\t\t\tposting_date: me.events.get_frm().doc.posting_date,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t};\n\t\t\tthis.batch_no_control.refresh();\n\t\t}\n\n\t\tif (this.uom_control) {\n\t\t\tthis.uom_control.df.onchange = function () {\n\t\t\t\tme.events.form_updated(me.current_item, \"uom\", this.value);\n\n\t\t\t\tconst item_row = frappe.get_doc(me.doctype, me.name);\n\t\t\t\tme.conversion_factor_control.df.read_only =\n\t\t\t\t\titem_row.stock_uom == this.value;\n\t\t\t\tme.conversion_factor_control.refresh();\n\t\t\t};\n\t\t}\n\n\t\tfrappe.model.on(\n\t\t\t\"POS Invoice Item\",\n\t\t\t\"*\",\n\t\t\t(fieldname, value, item_row) => {\n\t\t\t\tconst field_control = this[`${fieldname}_control`];\n\t\t\t\tconst item_row_is_being_edited =\n\t\t\t\t\tthis.compare_with_current_item(item_row);\n\t\t\t\tif (\n\t\t\t\t\titem_row_is_being_edited &&\n\t\t\t\t\tfield_control &&\n\t\t\t\t\tfield_control.get_value() !== value &&\n\t\t\t\t\tvalue == item_row[fieldname]\n\t\t\t\t) {\n\t\t\t\t\tfield_control.set_value(value);\n\t\t\t\t\tcur_pos.update_cart_html(item_row);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tasync auto_update_batch_no() {\n\t\tif (this.serial_no_control && this.batch_no_control) {\n\t\t\tconst selected_serial_nos = this.serial_no_control\n\t\t\t\t.get_value()\n\t\t\t\t.split(`\\n`)\n\t\t\t\t.filter((s) => s);\n\t\t\tif (!selected_serial_nos.length) return;\n\n\t\t\t// find batch nos of the selected serial no\n\t\t\tconst serials_with_batch_no = await frappe.db.get_list(\n\t\t\t\t\"Serial No\",\n\t\t\t\t{\n\t\t\t\t\tfilters: { name: [\"in\", selected_serial_nos] },\n\t\t\t\t\tfields: [\"batch_no\", \"name\"],\n\t\t\t\t},\n\t\t\t);\n\t\t\tconst batch_serial_map = serials_with_batch_no.reduce((acc, r) => {\n\t\t\t\tif (!acc[r.batch_no]) {\n\t\t\t\t\tacc[r.batch_no] = [];\n\t\t\t\t}\n\t\t\t\tacc[r.batch_no] = [...acc[r.batch_no], r.name];\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t\t// set current item's batch no and serial no\n\t\t\tconst batch_no = Object.keys(batch_serial_map)[0];\n\t\t\tconst batch_serial_nos = batch_serial_map[batch_no].join(`\\n`);\n\t\t\t// eg. 10 selected serial no. -> 5 belongs to first batch other 5 belongs to second batch\n\t\t\tconst serial_nos_belongs_to_other_batch =\n\t\t\t\tselected_serial_nos.length !==\n\t\t\t\tbatch_serial_map[batch_no].length;\n\n\t\t\tconst current_batch_no = this.batch_no_control.get_value();\n\t\t\tcurrent_batch_no != batch_no &&\n\t\t\t\t(await this.batch_no_control.set_value(batch_no));\n\n\t\t\tif (serial_nos_belongs_to_other_batch) {\n\t\t\t\tthis.serial_no_control.set_value(batch_serial_nos);\n\t\t\t\tthis.qty_control.set_value(batch_serial_map[batch_no].length);\n\n\t\t\t\tdelete batch_serial_map[batch_no];\n\t\t\t\tthis.events.clone_new_batch_item_in_frm(\n\t\t\t\t\tbatch_serial_map,\n\t\t\t\t\tthis.current_item,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tthis.bind_auto_serial_fetch_event();\n\t\tthis.bind_fields_to_numpad_fields();\n\n\t\tthis.$component.on(\"click\", \".close-btn\", () => {\n\t\t\tthis.events.close_item_details();\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tthis.wrapper.find(\".close-btn\").attr(\"title\", \"Esc\");\n\t\tfrappe.ui.keys.on(\"escape\", () => {\n\t\t\tconst item_details_visible = this.$component.is(\":visible\");\n\t\t\tif (item_details_visible) {\n\t\t\t\tthis.events.close_item_details();\n\t\t\t}\n\t\t});\n\t}\n\n\tbind_fields_to_numpad_fields() {\n\t\tconst me = this;\n\t\tthis.$form_container.on(\"click\", \".input-with-feedback\", function () {\n\t\t\tconst fieldname = $(this).attr(\"data-fieldname\");\n\t\t\tif (this.last_field_focused != fieldname) {\n\t\t\t\tme.events.item_field_focused(fieldname);\n\t\t\t\tthis.last_field_focused = fieldname;\n\t\t\t}\n\t\t});\n\t}\n\n\tbind_auto_serial_fetch_event() {\n\t\tthis.$form_container.on(\"click\", \".auto-fetch-btn\", () => {\n\t\t\tlet frm = this.events.get_frm();\n\t\t\tlet item_row = this.item_row;\n\t\t\titem_row.type_of_transaction = \"Outward\";\n\n\t\t\tnew erpnext.SerialBatchPackageSelector(frm, item_row, (r) => {\n\t\t\t\tif (r) {\n\t\t\t\t\tfrappe.model.set_value(item_row.doctype, item_row.name, {\n\t\t\t\t\t\tserial_and_batch_bundle: r.name,\n\t\t\t\t\t\tqty: Math.abs(r.total_qty),\n\t\t\t\t\t\tuse_serial_batch_fields: 0,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\ttoggle_component(show) {\n\t\tshow\n\t\t\t? this.$component.css(\"display\", \"flex\")\n\t\t\t: this.$component.css(\"display\", \"none\");\n\t}\n};\n", "/* global edp_online_vehicles */\n\nedp_online_vehicles.PartOrder.NumberPad = class {\n\tconstructor({ wrapper, events, cols, keys, css_classes, fieldnames_map }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.cols = cols;\n\t\tthis.keys = keys;\n\t\tthis.css_classes = css_classes || [];\n\t\tthis.fieldnames = fieldnames_map || {};\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.bind_events();\n\t}\n\n\tprepare_dom() {\n\t\tconst { cols, keys, css_classes, fieldnames } = this;\n\n\t\tfunction get_keys() {\n\t\t\treturn keys.reduce((a, row, i) => {\n\t\t\t\treturn (\n\t\t\t\t\ta +\n\t\t\t\t\trow.reduce((a2, number, j) => {\n\t\t\t\t\t\tconst class_to_append =\n\t\t\t\t\t\t\tcss_classes && css_classes[i]\n\t\t\t\t\t\t\t\t? css_classes[i][j]\n\t\t\t\t\t\t\t\t: \"\";\n\t\t\t\t\t\tconst fieldname =\n\t\t\t\t\t\t\tfieldnames && fieldnames[number]\n\t\t\t\t\t\t\t\t? fieldnames[number]\n\t\t\t\t\t\t\t\t: typeof number === \"string\"\n\t\t\t\t\t\t\t\t\t? frappe.scrub(number)\n\t\t\t\t\t\t\t\t\t: number;\n\n\t\t\t\t\t\tif (number == \"Discount\" || number == \"Rate\") {\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\ta2 +\n\t\t\t\t\t\t\t\t`<div class=\"numpad-btn ${class_to_append}\" data-button-value=\"${fieldname}\" style=\"visibility:hidden\">${__(\n\t\t\t\t\t\t\t\t\tnumber,\n\t\t\t\t\t\t\t\t)}</div>`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\ta2 +\n\t\t\t\t\t\t\t\t`<div class=\"numpad-btn ${class_to_append}\" data-button-value=\"${fieldname}\">${__(\n\t\t\t\t\t\t\t\t\tnumber,\n\t\t\t\t\t\t\t\t)}</div>`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, \"\")\n\t\t\t\t);\n\t\t\t}, \"\");\n\t\t}\n\n\t\tthis.wrapper.html(\n\t\t\t`<div class=\"numpad-container\">\n\t\t\t\t${get_keys()}\n\t\t\t</div>`,\n\t\t);\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\tthis.wrapper.on(\"click\", \".numpad-btn\", function () {\n\t\t\tconst $btn = $(this);\n\t\t\tme.events.numpad_event($btn);\n\t\t});\n\t}\n};\n", "/* eslint-disable no-unused-vars */\n/* global edp_online_vehicles */\nedp_online_vehicles.PartOrder.Payment = class {\n\tconstructor({ events, wrapper }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.initialize_numpad();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"payment-container\">\n\t\t\t\t<div class=\"section-label payment-section\">${__(\"Payment Method\")}</div>\n\t\t\t\t<div class=\"payment-modes\"></div>\n\t\t\t\t<div class=\"fields-numpad-container\">\n\t\t\t\t\t<div class=\"fields-section\">\n\t\t\t\t\t\t<div class=\"section-label\">${__(\"Additional Information\")}</div>\n\t\t\t\t\t\t<div class=\"invoice-fields\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"number-pad\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"totals-section\">\n\t\t\t\t\t<div class=\"totals\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"submit-order-btn\">${__(\"Complete Order\")}</div>\n\t\t\t</section>`,\n\t\t);\n\t\tthis.$component = this.wrapper.find(\".payment-container\");\n\t\tthis.$payment_modes = this.$component.find(\".payment-modes\");\n\t\tthis.$totals_section = this.$component.find(\".totals-section\");\n\t\tthis.$totals = this.$component.find(\".totals\");\n\t\tthis.$numpad = this.$component.find(\".number-pad\");\n\t\tthis.$invoice_fields_section = this.$component.find(\".fields-section\");\n\t}\n\n\tmake_invoice_fields_control() {\n\t\tfrappe.db.get_doc(\"POS Settings\", undefined).then((doc) => {\n\t\t\tconst fields = doc.invoice_fields;\n\t\t\tif (!fields.length) return;\n\n\t\t\tthis.$invoice_fields =\n\t\t\t\tthis.$invoice_fields_section.find(\".invoice-fields\");\n\t\t\tthis.$invoice_fields.html(\"\");\n\t\t\tconst frm = this.events.get_frm();\n\n\t\t\tfields.forEach((df) => {\n\t\t\t\tthis.$invoice_fields.append(\n\t\t\t\t\t`<div class=\"invoice_detail_field ${df.fieldname}-field\" data-fieldname=\"${df.fieldname}\"></div>`,\n\t\t\t\t);\n\t\t\t\tlet df_events = {\n\t\t\t\t\tonchange: function () {\n\t\t\t\t\t\tfrm.set_value(this.df.fieldname, this.get_value());\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tif (df.fieldtype == \"Button\") {\n\t\t\t\t\tdf_events = {\n\t\t\t\t\t\tclick: function () {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tfrm.script_manager.has_handlers(\n\t\t\t\t\t\t\t\t\tdf.fieldname,\n\t\t\t\t\t\t\t\t\tfrm.doc.doctype,\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tfrm.script_manager.trigger(\n\t\t\t\t\t\t\t\t\tdf.fieldname,\n\t\t\t\t\t\t\t\t\tfrm.doc.doctype,\n\t\t\t\t\t\t\t\t\tfrm.doc.docname,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis[`${df.fieldname}_field`] = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\t...df,\n\t\t\t\t\t\t...df_events,\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$invoice_fields.find(`.${df.fieldname}-field`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tthis[`${df.fieldname}_field`].set_value(frm.doc[df.fieldname]);\n\t\t\t});\n\t\t});\n\t}\n\n\tinitialize_numpad() {\n\t\tconst me = this;\n\t\tthis.number_pad = new edp_online_vehicles.PartOrder.NumberPad({\n\t\t\twrapper: this.$numpad,\n\t\t\tevents: {\n\t\t\t\tnumpad_event: function ($btn) {\n\t\t\t\t\tme.on_numpad_clicked($btn);\n\t\t\t\t},\n\t\t\t},\n\t\t\tcols: 3,\n\t\t\tkeys: [\n\t\t\t\t[1, 2, 3],\n\t\t\t\t[4, 5, 6],\n\t\t\t\t[7, 8, 9],\n\t\t\t\t[\".\", 0, \"Delete\"],\n\t\t\t],\n\t\t});\n\n\t\tthis.numpad_value = \"\";\n\t}\n\n\ton_numpad_clicked($btn) {\n\t\tconst button_value = $btn.attr(\"data-button-value\");\n\n\t\thighlight_numpad_btn($btn);\n\t\tthis.numpad_value =\n\t\t\tbutton_value === \"delete\"\n\t\t\t\t? this.numpad_value.slice(0, -1)\n\t\t\t\t: this.numpad_value + button_value;\n\t\tthis.selected_mode.$input.get(0).focus();\n\t\tthis.selected_mode.set_value(this.numpad_value);\n\n\t\tfunction highlight_numpad_btn($btn) {\n\t\t\t$btn.addClass(\"shadow-base-inner bg-selected\");\n\t\t\tsetTimeout(() => {\n\t\t\t\t$btn.removeClass(\"shadow-base-inner bg-selected\");\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\n\t\tthis.$payment_modes.on(\"click\", \".mode-of-payment\", function (e) {\n\t\t\tconst mode_clicked = $(this);\n\t\t\t// if clicked element doesn't have .mode-of-payment class then return\n\t\t\tif (!$(e.target).is(mode_clicked)) return;\n\n\t\t\tconst scrollLeft =\n\t\t\t\tmode_clicked.offset().left -\n\t\t\t\tme.$payment_modes.offset().left +\n\t\t\t\tme.$payment_modes.scrollLeft();\n\t\t\tme.$payment_modes.animate({ scrollLeft });\n\n\t\t\tconst mode = mode_clicked.attr(\"data-mode\");\n\n\t\t\t// hide all control fields and shortcuts\n\t\t\t$(`.mode-of-payment-control`).css(\"display\", \"none\");\n\t\t\t$(`.cash-shortcuts`).css(\"display\", \"none\");\n\t\t\tme.$payment_modes.find(`.pay-amount`).css(\"display\", \"inline\");\n\t\t\tme.$payment_modes\n\t\t\t\t.find(`.loyalty-amount-name`)\n\t\t\t\t.css(\"display\", \"none\");\n\n\t\t\t// remove highlight from all mode-of-payments\n\t\t\t$(\".mode-of-payment\").removeClass(\"border-primary\");\n\n\t\t\tif (mode_clicked.hasClass(\"border-primary\")) {\n\t\t\t\t// clicked one is selected then unselect it\n\t\t\t\tmode_clicked.removeClass(\"border-primary\");\n\t\t\t\tme.selected_mode = \"\";\n\t\t\t} else {\n\t\t\t\t// clicked one is not selected then select it\n\t\t\t\tmode_clicked.addClass(\"border-primary\");\n\t\t\t\tmode_clicked\n\t\t\t\t\t.find(\".mode-of-payment-control\")\n\t\t\t\t\t.css(\"display\", \"flex\");\n\t\t\t\tmode_clicked.find(\".cash-shortcuts\").css(\"display\", \"grid\");\n\t\t\t\tme.$payment_modes\n\t\t\t\t\t.find(`.${mode}-amount`)\n\t\t\t\t\t.css(\"display\", \"none\");\n\t\t\t\tme.$payment_modes\n\t\t\t\t\t.find(`.${mode}-name`)\n\t\t\t\t\t.css(\"display\", \"inline\");\n\n\t\t\t\tme.selected_mode = me[`${mode}_control`];\n\t\t\t\tme.selected_mode && me.selected_mode.$input.get(0).focus();\n\t\t\t\tme.auto_set_remaining_amount();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on(\"POS Invoice\", \"contact_mobile\", (frm) => {\n\t\t\tconst contact = frm.doc.contact_mobile;\n\t\t\tconst request_button = $(this.request_for_payment_field?.$input[0]);\n\t\t\tif (contact) {\n\t\t\t\trequest_button\n\t\t\t\t\t.removeClass(\"btn-default\")\n\t\t\t\t\t.addClass(\"btn-primary\");\n\t\t\t} else {\n\t\t\t\trequest_button\n\t\t\t\t\t.removeClass(\"btn-primary\")\n\t\t\t\t\t.addClass(\"btn-default\");\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on(\"POS Invoice\", \"coupon_code\", (frm) => {\n\t\t\tif (frm.doc.coupon_code && !frm.applying_pos_coupon_code) {\n\t\t\t\tif (!frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrm.applying_pos_coupon_code = true;\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => (frm.doc.ignore_pricing_rule = 1),\n\t\t\t\t\t\t() => frm.trigger(\"ignore_pricing_rule\"),\n\t\t\t\t\t\t() => (frm.doc.ignore_pricing_rule = 0),\n\t\t\t\t\t\t() => frm.trigger(\"apply_pricing_rule\"),\n\t\t\t\t\t\t() => frm.save(),\n\t\t\t\t\t\t() => this.update_totals_section(frm.doc),\n\t\t\t\t\t\t() => (frm.applying_pos_coupon_code = false),\n\t\t\t\t\t]);\n\t\t\t\t} else if (frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t\"Ignore Pricing Rule is enabled. Cannot apply coupon code.\",\n\t\t\t\t\t\t),\n\t\t\t\t\t\tindicator: \"orange\",\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.setup_listener_for_payments();\n\n\t\tthis.$payment_modes.on(\"click\", \".shortcut\", function () {\n\t\t\tconst value = $(this).attr(\"data-value\");\n\t\t\tme.selected_mode.set_value(value);\n\t\t});\n\n\t\tthis.$component.on(\"click\", \".submit-order-btn\", () => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst paid_amount = doc.paid_amount;\n\t\t\tconst items = doc.items;\n\n\t\t\tif (paid_amount == 0 || !items.length) {\n\t\t\t\tconst message = items.length\n\t\t\t\t\t? __(\"You cannot submit the order without payment.\")\n\t\t\t\t\t: __(\"You cannot submit empty order.\");\n\t\t\t\tfrappe.show_alert({ message, indicator: \"orange\" });\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.events.submit_invoice();\n\t\t});\n\n\t\tfrappe.ui.form.on(\"POS Invoice\", \"paid_amount\", (frm) => {\n\t\t\tthis.update_totals_section(frm.doc);\n\n\t\t\t// need to re calculate cash shortcuts after discount is applied\n\t\t\tconst is_cash_shortcuts_invisible = !this.$payment_modes\n\t\t\t\t.find(\".cash-shortcuts\")\n\t\t\t\t.is(\":visible\");\n\t\t\tthis.attach_cash_shortcuts(frm.doc);\n\t\t\t!is_cash_shortcuts_invisible &&\n\t\t\t\tthis.$payment_modes\n\t\t\t\t\t.find(\".cash-shortcuts\")\n\t\t\t\t\t.css(\"display\", \"grid\");\n\t\t\tthis.render_payment_mode_dom();\n\t\t});\n\n\t\tfrappe.ui.form.on(\"POS Invoice\", \"loyalty_amount\", (frm) => {\n\t\t\tconst formatted_currency = format_currency(\n\t\t\t\tfrm.doc.loyalty_amount,\n\t\t\t\tfrm.doc.currency,\n\t\t\t);\n\t\t\tthis.$payment_modes\n\t\t\t\t.find(`.loyalty-amount-amount`)\n\t\t\t\t.html(formatted_currency);\n\t\t});\n\n\t\tfrappe.ui.form.on(\n\t\t\t\"Sales Invoice Payment\",\n\t\t\t\"amount\",\n\t\t\t(frm, cdt, cdn) => {\n\t\t\t\t// for setting correct amount after loyalty points are redeemed\n\t\t\t\tconst default_mop = locals[cdt][cdn];\n\t\t\t\tconst mode = this.sanitize_mode_of_payment(\n\t\t\t\t\tdefault_mop.mode_of_payment,\n\t\t\t\t);\n\t\t\t\tif (\n\t\t\t\t\tthis[`${mode}_control`] &&\n\t\t\t\t\tthis[`${mode}_control`].get_value() != default_mop.amount\n\t\t\t\t) {\n\t\t\t\t\tthis[`${mode}_control`].set_value(default_mop.amount);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tsetup_listener_for_payments() {\n\t\tfrappe.realtime.on(\"process_phone_payment\", (data) => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst { response, amount, success, failure_message } = data;\n\t\t\tlet message, title;\n\n\t\t\tif (success) {\n\t\t\t\ttitle = __(\"Payment Received\");\n\t\t\t\tconst grand_total = cint(\n\t\t\t\t\tfrappe.sys_defaults.disable_rounded_total,\n\t\t\t\t)\n\t\t\t\t\t? doc.grand_total\n\t\t\t\t\t: doc.rounded_total;\n\t\t\t\tif (amount >= grand_total) {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t\tmessage = __(\"Payment of {0} received successfully.\", [\n\t\t\t\t\t\tformat_currency(amount, doc.currency, 0),\n\t\t\t\t\t]);\n\t\t\t\t\tthis.events.submit_invoice();\n\t\t\t\t\tcur_frm.reload_doc();\n\t\t\t\t} else {\n\t\t\t\t\tmessage = __(\n\t\t\t\t\t\t\"Payment of {0} received successfully. Waiting for other requests to complete...\",\n\t\t\t\t\t\t[format_currency(amount, doc.currency, 0)],\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else if (failure_message) {\n\t\t\t\tmessage = failure_message;\n\t\t\t\ttitle = __(\"Payment Failed\");\n\t\t\t}\n\n\t\t\tfrappe.msgprint({ message: message, title: title });\n\t\t});\n\t}\n\n\tauto_set_remaining_amount() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n\t\t\t? doc.grand_total\n\t\t\t: doc.rounded_total;\n\t\tconst remaining_amount = grand_total - doc.paid_amount;\n\t\tconst current_value = this.selected_mode\n\t\t\t? this.selected_mode.get_value()\n\t\t\t: undefined;\n\t\tif (!current_value && remaining_amount > 0 && this.selected_mode) {\n\t\t\tthis.selected_mode.set_value(remaining_amount);\n\t\t}\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? \"\u2318\" : \"Ctrl\";\n\t\tthis.$component\n\t\t\t.find(\".submit-order-btn\")\n\t\t\t.attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.on(\"ctrl+enter\", () => {\n\t\t\tconst payment_is_visible = this.$component.is(\":visible\");\n\t\t\tconst active_mode = this.$payment_modes.find(\".border-primary\");\n\t\t\tif (payment_is_visible && active_mode.length) {\n\t\t\t\tthis.$component.find(\".submit-order-btn\").click();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"tab\",\n\t\t\taction: () => {\n\t\t\t\tconst payment_is_visible = this.$component.is(\":visible\");\n\t\t\t\tlet active_mode = this.$payment_modes.find(\".border-primary\");\n\t\t\t\tactive_mode = active_mode.length\n\t\t\t\t\t? active_mode.attr(\"data-mode\")\n\t\t\t\t\t: undefined;\n\n\t\t\t\tif (!active_mode) return;\n\n\t\t\t\tconst mode_of_payments = Array.from(\n\t\t\t\t\tthis.$payment_modes.find(\".mode-of-payment\"),\n\t\t\t\t).map((m) => $(m).attr(\"data-mode\"));\n\t\t\t\tconst mode_index = mode_of_payments.indexOf(active_mode);\n\t\t\t\tconst next_mode_index =\n\t\t\t\t\t(mode_index + 1) % mode_of_payments.length;\n\t\t\t\tconst next_mode_to_be_clicked = this.$payment_modes.find(\n\t\t\t\t\t`.mode-of-payment[data-mode=\"${mode_of_payments[next_mode_index]}\"]`,\n\t\t\t\t);\n\n\t\t\t\tif (payment_is_visible && mode_index != next_mode_index) {\n\t\t\t\t\tnext_mode_to_be_clicked.click();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcondition: () =>\n\t\t\t\tthis.$component.is(\":visible\") &&\n\t\t\t\tthis.$payment_modes.find(\".border-primary\").length,\n\t\t\tdescription: __(\"Switch Between Payment Modes\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page,\n\t\t});\n\t}\n\n\ttoggle_numpad() {\n\t\t// pass\n\t}\n\n\trender_payment_section() {\n\t\tthis.render_payment_mode_dom();\n\t\tthis.make_invoice_fields_control();\n\t\tthis.update_totals_section();\n\t\tthis.focus_on_default_mop();\n\t}\n\n\tafter_render() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrm.script_manager.trigger(\n\t\t\t\"after_payment_render\",\n\t\t\tfrm.doc.doctype,\n\t\t\tfrm.doc.docname,\n\t\t);\n\t}\n\n\tedit_cart() {\n\t\tthis.events.toggle_other_sections(false);\n\t\tthis.toggle_component(false);\n\t}\n\n\tcheckout() {\n\t\tfrappe.model.sync(this.frm.doc);\n\t\tfrappe.set_route(\"Form\", this.frm.doc.doctype, this.frm.doc.name);\n\n\t\t// const frm = this.events.get_frm();\n\t\t// frm.cscript.calculate_outstanding_amount();\n\t\t// frm.refresh_field(\"outstanding_amount\");\n\t\t// frm.refresh_field(\"paid_amount\");\n\t\t// frm.refresh_field(\"base_paid_amount\");\n\t\t// this.events.toggle_other_sections(true);\n\t\t// this.toggle_component(true);\n\n\t\t// this.render_payment_section();\n\t\t// this.after_render();\n\t}\n\n\ttoggle_remarks_control() {\n\t\tif (this.$remarks.find(\".frappe-control\").length) {\n\t\t\tthis.$remarks.html(\"+ Add Remark\");\n\t\t} else {\n\t\t\tthis.$remarks.html(\"\");\n\t\t\tthis[`remark_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __(\"Remark\"),\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\tonchange: function () {},\n\t\t\t\t},\n\t\t\t\tparent: this.$totals_section.find(`.remarks`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`remark_control`].set_value(\"\");\n\t\t}\n\t}\n\n\trender_payment_mode_dom() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst payments = doc.payments;\n\t\tconst currency = doc.currency;\n\n\t\tthis.$payment_modes.html(\n\t\t\t`${payments\n\t\t\t\t.map((p, i) => {\n\t\t\t\t\tconst mode = this.sanitize_mode_of_payment(\n\t\t\t\t\t\tp.mode_of_payment,\n\t\t\t\t\t);\n\t\t\t\t\tconst payment_type = p.type;\n\t\t\t\t\tconst margin = i % 2 === 0 ? \"pr-2\" : \"pl-2\";\n\t\t\t\t\tconst amount =\n\t\t\t\t\t\tp.amount > 0 ? format_currency(p.amount, currency) : \"\";\n\n\t\t\t\t\treturn `\n\t\t\t\t\t<div class=\"payment-mode-wrapper\">\n\t\t\t\t\t\t<div class=\"mode-of-payment\" data-mode=\"${mode}\" data-payment-type=\"${payment_type}\">\n\t\t\t\t\t\t\t${p.mode_of_payment}\n\t\t\t\t\t\t\t<div class=\"${mode}-amount pay-amount\">${amount}</div>\n\t\t\t\t\t\t\t<div class=\"${mode} mode-of-payment-control\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t\t})\n\t\t\t\t.join(\"\")}`,\n\t\t);\n\n\t\tpayments.forEach((p) => {\n\t\t\tconst mode = this.sanitize_mode_of_payment(p.mode_of_payment);\n\t\t\tconst me = this;\n\t\t\tthis[`${mode}_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: p.mode_of_payment,\n\t\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\t\tplaceholder: __(\"Enter {0} amount.\", [p.mode_of_payment]),\n\t\t\t\t\tonchange: function () {\n\t\t\t\t\t\tconst current_value = frappe.model.get_value(\n\t\t\t\t\t\t\tp.doctype,\n\t\t\t\t\t\t\tp.name,\n\t\t\t\t\t\t\t\"amount\",\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (current_value != this.value) {\n\t\t\t\t\t\t\tfrappe.model\n\t\t\t\t\t\t\t\t.set_value(\n\t\t\t\t\t\t\t\t\tp.doctype,\n\t\t\t\t\t\t\t\t\tp.name,\n\t\t\t\t\t\t\t\t\t\"amount\",\n\t\t\t\t\t\t\t\t\tflt(this.value),\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.then(() => me.update_totals_section());\n\n\t\t\t\t\t\t\tconst formatted_currency = format_currency(\n\t\t\t\t\t\t\t\tthis.value,\n\t\t\t\t\t\t\t\tcurrency,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tme.$payment_modes\n\t\t\t\t\t\t\t\t.find(`.${mode}-amount`)\n\t\t\t\t\t\t\t\t.html(formatted_currency);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tparent: this.$payment_modes.find(\n\t\t\t\t\t`.${mode}.mode-of-payment-control`,\n\t\t\t\t),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`${mode}_control`].toggle_label(false);\n\t\t\tthis[`${mode}_control`].set_value(p.amount);\n\t\t});\n\n\t\tthis.render_loyalty_points_payment_mode();\n\n\t\tthis.attach_cash_shortcuts(doc);\n\t}\n\n\tfocus_on_default_mop() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst payments = doc.payments;\n\t\tpayments.forEach((p) => {\n\t\t\tconst mode = this.sanitize_mode_of_payment(p.mode_of_payment);\n\t\t\tif (p.default) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.$payment_modes\n\t\t\t\t\t\t.find(`.${mode}.mode-of-payment-control`)\n\t\t\t\t\t\t.parent()\n\t\t\t\t\t\t.click();\n\t\t\t\t}, 500);\n\t\t\t}\n\t\t});\n\t}\n\n\tattach_cash_shortcuts(doc) {\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n\t\t\t? doc.grand_total\n\t\t\t: doc.rounded_total;\n\t\tconst currency = doc.currency;\n\n\t\tconst shortcuts = this.get_cash_shortcuts(flt(grand_total));\n\n\t\tthis.$payment_modes.find(\".cash-shortcuts\").remove();\n\t\tlet shortcuts_html = shortcuts\n\t\t\t.map((s) => {\n\t\t\t\treturn `<div class=\"shortcut\" data-value=\"${s}\">${format_currency(\n\t\t\t\t\ts,\n\t\t\t\t\tcurrency,\n\t\t\t\t)}</div>`;\n\t\t\t})\n\t\t\t.join(\"\");\n\n\t\tthis.$payment_modes\n\t\t\t.find('[data-payment-type=\"Cash\"]')\n\t\t\t.find(\".mode-of-payment-control\")\n\t\t\t.after(`<div class=\"cash-shortcuts\">${shortcuts_html}</div>`);\n\t}\n\n\tget_cash_shortcuts(grand_total) {\n\t\tlet steps = [1, 5, 10];\n\t\tconst digits = String(Math.round(grand_total)).length;\n\n\t\tsteps = steps.map((x) => x * 10 ** (digits - 2));\n\n\t\tconst get_nearest = (amount, x) => {\n\t\t\tlet nearest_x = Math.ceil(amount / x) * x;\n\t\t\treturn nearest_x === amount ? nearest_x + x : nearest_x;\n\t\t};\n\n\t\treturn steps.reduce((finalArr, x) => {\n\t\t\tlet nearest_x = get_nearest(grand_total, x);\n\t\t\tnearest_x =\n\t\t\t\tfinalArr.indexOf(nearest_x) != -1 ? nearest_x + x : nearest_x;\n\t\t\treturn [...finalArr, nearest_x];\n\t\t}, []);\n\t}\n\n\trender_loyalty_points_payment_mode() {\n\t\tconst me = this;\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst { loyalty_program, loyalty_points, conversion_factor } =\n\t\t\tthis.events.get_customer_details();\n\n\t\tthis.$payment_modes\n\t\t\t.find(`.mode-of-payment[data-mode=\"loyalty-amount\"]`)\n\t\t\t.parent()\n\t\t\t.remove();\n\n\t\tif (!loyalty_program) return;\n\n\t\tlet description, read_only, max_redeemable_amount;\n\t\tif (!loyalty_points) {\n\t\t\tdescription = __(\"You don't have enough points to redeem.\");\n\t\t\tread_only = true;\n\t\t} else {\n\t\t\tmax_redeemable_amount = flt(\n\t\t\t\tflt(loyalty_points) * flt(conversion_factor),\n\t\t\t\tprecision(\"loyalty_amount\", doc),\n\t\t\t);\n\t\t\tdescription = __(\"You can redeem upto {0}.\", [\n\t\t\t\tformat_currency(max_redeemable_amount),\n\t\t\t]);\n\t\t\tread_only = false;\n\t\t}\n\n\t\tconst margin =\n\t\t\tthis.$payment_modes.children().length % 2 === 0 ? \"pr-2\" : \"pl-2\";\n\t\tconst amount =\n\t\t\tdoc.loyalty_amount > 0\n\t\t\t\t? format_currency(doc.loyalty_amount, doc.currency)\n\t\t\t\t: \"\";\n\t\tthis.$payment_modes.append(\n\t\t\t`<div class=\"payment-mode-wrapper\">\n\t\t\t\t<div class=\"mode-of-payment loyalty-card\" data-mode=\"loyalty-amount\" data-payment-type=\"loyalty-amount\">\n\t\t\t\t\tRedeem Loyalty Points\n\t\t\t\t\t<div class=\"loyalty-amount-amount pay-amount\">${amount}</div>\n\t\t\t\t\t<div class=\"loyalty-amount-name\">${loyalty_program}</div>\n\t\t\t\t\t<div class=\"loyalty-amount mode-of-payment-control\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`,\n\t\t);\n\n\t\tthis[\"loyalty-amount_control\"] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Redeem Loyalty Points\"),\n\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\tplaceholder: __(\"Enter amount to be redeemed.\"),\n\t\t\t\toptions: \"company:currency\",\n\t\t\t\tread_only,\n\t\t\t\tonchange: async function () {\n\t\t\t\t\tif (!loyalty_points) return;\n\n\t\t\t\t\tif (this.value > max_redeemable_amount) {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"You cannot redeem more than {0}.\", [\n\t\t\t\t\t\t\t\tformat_currency(max_redeemable_amount),\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\tme[\"loyalty-amount_control\"].set_value(0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst redeem_loyalty_points = this.value > 0 ? 1 : 0;\n\t\t\t\t\tawait frappe.model.set_value(\n\t\t\t\t\t\tdoc.doctype,\n\t\t\t\t\t\tdoc.name,\n\t\t\t\t\t\t\"redeem_loyalty_points\",\n\t\t\t\t\t\tredeem_loyalty_points,\n\t\t\t\t\t);\n\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\tdoc.doctype,\n\t\t\t\t\t\tdoc.name,\n\t\t\t\t\t\t\"loyalty_points\",\n\t\t\t\t\t\tparseInt(this.value / conversion_factor),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tdescription,\n\t\t\t},\n\t\t\tparent: this.$payment_modes.find(\n\t\t\t\t`.loyalty-amount.mode-of-payment-control`,\n\t\t\t),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis[\"loyalty-amount_control\"].toggle_label(false);\n\n\t\t// this.render_add_payment_method_dom();\n\t}\n\n\trender_add_payment_method_dom() {\n\t\tconst docstatus = this.events.get_frm().doc.docstatus;\n\t\tif (docstatus === 0)\n\t\t\tthis.$payment_modes.append(\n\t\t\t\t`<div class=\"w-full pr-2\">\n\t\t\t\t\t<div class=\"add-mode-of-payment w-half text-grey mb-4 no-select pointer\">+ Add Payment Method</div>\n\t\t\t\t</div>`,\n\t\t\t);\n\t}\n\n\tupdate_totals_section(doc) {\n\t\tif (!doc) doc = this.events.get_frm().doc;\n\t\tconst paid_amount = doc.paid_amount;\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n\t\t\t? doc.grand_total\n\t\t\t: doc.rounded_total;\n\t\tconst remaining = grand_total - doc.paid_amount;\n\t\tconst change =\n\t\t\tdoc.change_amount || remaining <= 0 ? -1 * remaining : undefined;\n\t\tconst currency = doc.currency;\n\t\tconst label = __(\"Change Amount\");\n\n\t\tthis.$totals.html(\n\t\t\t`<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${__(\"Grand Total\")}</div>\n\t\t\t\t<div class=\"value\">${format_currency(grand_total, currency)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator-y\"></div>\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${__(\"Paid Amount\")}</div>\n\t\t\t\t<div class=\"value\">${format_currency(paid_amount, currency)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator-y\"></div>\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${label}</div>\n\t\t\t\t<div class=\"value\">${format_currency(change || remaining, currency)}</div>\n\t\t\t</div>`,\n\t\t);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow\n\t\t\t? this.$component.css(\"display\", \"flex\")\n\t\t\t: this.$component.css(\"display\", \"none\");\n\t}\n\n\tsanitize_mode_of_payment(mode_of_payment) {\n\t\treturn mode_of_payment\n\t\t\t.replace(/ +/g, \"_\")\n\t\t\t.replace(/[^\\p{L}\\p{N}_-]/gu, \"\")\n\t\t\t.replace(/^[^_a-zA-Z\\p{L}]+/u, \"\")\n\t\t\t.toLowerCase();\n\t}\n};\n", "/* global edp_online_vehicles */\n\nedp_online_vehicles.PartOrder.PastOrderList = class {\n\tconstructor({ wrapper, events }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.make_filter_section();\n\t\tthis.bind_events();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-list\">\n\t\t\t\t<div class=\"filter-section\">\n\t\t\t\t\t<div class=\"label\">${__(\"Recent Orders\")}</div>\n\t\t\t\t\t<div class=\"search-field\"></div>\n\t\t\t\t\t<div class=\"status-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoices-container\"></div>\n\t\t\t</section>`,\n\t\t);\n\n\t\tthis.$component = this.wrapper.find(\".past-order-list\");\n\t\tthis.$invoices_container = this.$component.find(\".invoices-container\");\n\t}\n\n\tbind_events() {\n\t\tthis.search_field.$input.on(\"input\", (e) => {\n\t\t\tclearTimeout(this.last_search);\n\t\t\tthis.last_search = setTimeout(() => {\n\t\t\t\tconst search_term = e.target.value;\n\t\t\t\tthis.refresh_list(search_term, this.status_field.get_value());\n\t\t\t}, 300);\n\t\t});\n\t\tconst me = this;\n\t\tthis.$invoices_container.on(\"click\", \".invoice-wrapper\", function () {\n\t\t\tconst invoice_name = unescape($(this).attr(\"data-invoice-name\"));\n\n\t\t\tme.events.open_invoice_data(invoice_name);\n\t\t});\n\t}\n\n\tmake_filter_section() {\n\t\tconst me = this;\n\t\tthis.search_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Search\"),\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tplaceholder: __(\"Search by invoice id or customer name\"),\n\t\t\t},\n\t\t\tparent: this.$component.find(\".search-field\"),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.status_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Invoice Status\"),\n\t\t\t\tfieldtype: \"Select\",\n\t\t\t\toptions: `Draft\\nPaid\\nConsolidated\\nReturn`,\n\t\t\t\tplaceholder: __(\"Filter by invoice status\"),\n\t\t\t\tonchange: function () {\n\t\t\t\t\tif (me.$component.is(\":visible\")) me.refresh_list();\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$component.find(\".status-field\"),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.search_field.toggle_label(false);\n\t\tthis.status_field.toggle_label(false);\n\t\tthis.status_field.set_value(\"Draft\");\n\t}\n\n\trefresh_list() {\n\t\tfrappe.dom.freeze();\n\t\tthis.events.reset_summary();\n\t\tconst search_term = this.search_field.get_value();\n\t\tconst status = this.status_field.get_value();\n\n\t\tthis.$invoices_container.html(\"\");\n\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.get_past_order_list\",\n\t\t\tfreeze: true,\n\t\t\targs: { search_term, status },\n\t\t\tcallback: (response) => {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tresponse.message.forEach((invoice) => {\n\t\t\t\t\tconst invoice_html = this.get_invoice_html(invoice);\n\t\t\t\t\tthis.$invoices_container.append(invoice_html);\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\t}\n\n\tget_invoice_html(invoice) {\n\t\tconst posting_datetime = frappe.datetime.str_to_user(\n\t\t\tinvoice.posting_date + \" \" + invoice.posting_time,\n\t\t);\n\t\treturn `<div class=\"invoice-wrapper\" data-invoice-name=\"${escape(invoice.name)}\">\n\t\t\t\t<div class=\"invoice-name-date\">\n\t\t\t\t\t<div class=\"invoice-name\">${invoice.name}</div>\n\t\t\t\t\t<div class=\"invoice-date\">\n\t\t\t\t\t\t<svg class=\"mr-2\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n\t\t\t\t\t\t\t<path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"/><circle cx=\"12\" cy=\"7\" r=\"4\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t${frappe.ellipsis(invoice.customer, 20)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-total-status\">\n\t\t\t\t\t<div class=\"invoice-total\">${format_currency(invoice.grand_total, invoice.currency) || 0}</div>\n\t\t\t\t\t<div class=\"invoice-date\">${posting_datetime}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator\"></div>`;\n\t}\n\n\ttoggle_component(show) {\n\t\tshow\n\t\t\t? this.$component.css(\"display\", \"flex\") && this.refresh_list()\n\t\t\t: this.$component.css(\"display\", \"none\");\n\t}\n};\n", "/* global edp_online_vehicles */\n\nedp_online_vehicles.PartOrder.PastOrderSummary = class {\n\tconstructor({ wrapper, events, pos_profile }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.pos_profile = pos_profile;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_email_print_dialog();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-summary\">\n\t\t\t\t<div class=\"no-summary-placeholder\">\n\t\t\t\t\t${__(\"Select an invoice to load summary data\")}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-summary-wrapper\">\n\t\t\t\t\t<div class=\"abs-container\">\n\t\t\t\t\t\t<div class=\"upper-section\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__(\"Items\")}</div>\n\t\t\t\t\t\t<div class=\"items-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__(\"Totals\")}</div>\n\t\t\t\t\t\t<div class=\"totals-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__(\"Payments\")}</div>\n\t\t\t\t\t\t<div class=\"payments-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"summary-btns\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</section>`,\n\t\t);\n\n\t\tthis.$component = this.wrapper.find(\".past-order-summary\");\n\t\tthis.$summary_wrapper = this.$component.find(\n\t\t\t\".invoice-summary-wrapper\",\n\t\t);\n\t\tthis.$summary_container = this.$component.find(\".abs-container\");\n\t\tthis.$upper_section = this.$summary_container.find(\".upper-section\");\n\t\tthis.$items_container =\n\t\t\tthis.$summary_container.find(\".items-container\");\n\t\tthis.$totals_container =\n\t\t\tthis.$summary_container.find(\".totals-container\");\n\t\tthis.$payment_container = this.$summary_container.find(\n\t\t\t\".payments-container\",\n\t\t);\n\t\tthis.$summary_btns = this.$summary_container.find(\".summary-btns\");\n\t}\n\n\tinit_email_print_dialog() {\n\t\tconst email_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Email Receipt\"),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"email_id\",\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\toptions: \"Email\",\n\t\t\t\t\tlabel: \"Email ID\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"content\",\n\t\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\t\tlabel: \"Message (if any)\",\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.send_email();\n\t\t\t},\n\t\t\tprimary_action_label: __(\"Send\"),\n\t\t});\n\t\tthis.email_dialog = email_dialog;\n\n\t\tconst print_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Print Receipt\"),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"print\",\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\tlabel: \"Print Preview\",\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.print_receipt();\n\t\t\t},\n\t\t\tprimary_action_label: __(\"Print\"),\n\t\t});\n\t\tthis.print_dialog = print_dialog;\n\t}\n\n\tget_upper_section_html(doc) {\n\t\tconst { status } = doc;\n\t\tlet indicator_color = \"\";\n\n\t\t[\"Paid\", \"Consolidated\"].includes(status) &&\n\t\t\t(indicator_color = \"green\");\n\t\tstatus === \"Draft\" && (indicator_color = \"red\");\n\t\tstatus === \"Return\" && (indicator_color = \"grey\");\n\n\t\treturn `<div class=\"left-section\">\n\t\t\t\t\t<div class=\"customer-name\">${doc.customer}</div>\n\t\t\t\t\t<div class=\"customer-email\">${this.customer_email}</div>\n\t\t\t\t\t<div class=\"cashier\">${__(\"Sold by\")}: ${doc.owner}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"right-section\">\n\t\t\t\t\t<div class=\"paid-amount\">${format_currency(doc.paid_amount, doc.currency)}</div>\n\t\t\t\t\t<div class=\"invoice-name\">${doc.name}</div>\n\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\"><span>${__(\n\t\t\t\t\t\tdoc.status,\n\t\t\t\t\t)}</span></span>\n\t\t\t\t</div>`;\n\t}\n\n\tget_item_html(doc, item_data) {\n\t\treturn `<div class=\"item-row-wrapper\">\n\t\t\t\t\t<div class=\"item-name\">${item_data.item_name}</div>\n\t\t\t\t\t<div class=\"item-qty\">${item_data.qty || 0} ${item_data.uom}</div>\n\t\t\t\t\t<div class=\"item-rate-disc\">${get_rate_discount_html()}</div>\n\t\t\t\t</div>`;\n\n\t\tfunction get_rate_discount_html() {\n\t\t\tif (\n\t\t\t\titem_data.rate &&\n\t\t\t\titem_data.price_list_rate &&\n\t\t\t\titem_data.rate !== item_data.price_list_rate\n\t\t\t) {\n\t\t\t\treturn `<span class=\"item-disc\">(${item_data.discount_percentage}% off)</span>\n\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.rate, doc.currency)}</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-rate\">${format_currency(\n\t\t\t\t\titem_data.price_list_rate || item_data.rate,\n\t\t\t\t\tdoc.currency,\n\t\t\t\t)}</div>`;\n\t\t\t}\n\t\t}\n\t}\n\n\tget_discount_html(doc) {\n\t\tif (doc.discount_amount) {\n\t\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t\t<div>${__(\"Discount\")} (${doc.additional_discount_percentage} %)</div>\n\t\t\t\t\t\t<div>${format_currency(doc.discount_amount, doc.currency)}</div>\n\t\t\t\t\t</div>`;\n\t\t} else {\n\t\t\treturn ``;\n\t\t}\n\t}\n\n\tget_net_total_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t<div>${__(\"Net Total\")}</div>\n\t\t\t\t\t<div>${format_currency(doc.net_total, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_taxes_html(doc) {\n\t\tif (!doc.taxes.length) return \"\";\n\n\t\tlet taxes_html = doc.taxes\n\t\t\t.map((t) => {\n\t\t\t\t// if tax rate is 0, don't print it.\n\t\t\t\tconst description = /[0-9]+/.test(t.description)\n\t\t\t\t\t? t.description\n\t\t\t\t\t: t.rate != 0\n\t\t\t\t\t\t? `${t.description} @ ${t.rate}%`\n\t\t\t\t\t\t: t.description;\n\t\t\t\treturn `\n\t\t\t\t<div class=\"tax-row\">\n\t\t\t\t\t<div class=\"tax-label\">${description}</div>\n\t\t\t\t\t<div class=\"tax-value\">${format_currency(t.tax_amount_after_discount_amount, doc.currency)}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\t})\n\t\t\t.join(\"\");\n\n\t\treturn `<div class=\"taxes-wrapper\">${taxes_html}</div>`;\n\t}\n\n\tget_grand_total_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper grand-total\">\n\t\t\t\t\t<div>${__(\"Grand Total\")}</div>\n\t\t\t\t\t<div>${format_currency(doc.grand_total, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_payment_html(doc, payment) {\n\t\treturn `<div class=\"summary-row-wrapper payments\">\n\t\t\t\t\t<div>${__(payment.mode_of_payment)}</div>\n\t\t\t\t\t<div>${format_currency(payment.amount, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tbind_events() {\n\t\tthis.$summary_container.on(\"click\", \".return-btn\", () => {\n\t\t\tthis.events.process_return(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component\n\t\t\t\t.find(\".no-summary-placeholder\")\n\t\t\t\t.css(\"display\", \"flex\");\n\t\t\tthis.$summary_wrapper.css(\"display\", \"none\");\n\t\t});\n\n\t\tthis.$summary_container.on(\"click\", \".edit-btn\", () => {\n\t\t\tthis.events.edit_order(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component\n\t\t\t\t.find(\".no-summary-placeholder\")\n\t\t\t\t.css(\"display\", \"flex\");\n\t\t\tthis.$summary_wrapper.css(\"display\", \"none\");\n\t\t});\n\n\t\tthis.$summary_container.on(\"click\", \".delete-btn\", () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t});\n\n\t\tthis.$summary_container.on(\"click\", \".delete-btn\", () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t\t// this.toggle_component(false);\n\t\t\t// this.$component.find('.no-summary-placeholder').removeClass('d-none');\n\t\t\t// this.$summary_wrapper.addClass('d-none');\n\t\t});\n\n\t\tthis.$summary_container.on(\"click\", \".new-btn\", () => {\n\t\t\tthis.events.new_order();\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component\n\t\t\t\t.find(\".no-summary-placeholder\")\n\t\t\t\t.css(\"display\", \"flex\");\n\t\t\tthis.$summary_wrapper.css(\"display\", \"none\");\n\t\t});\n\n\t\tthis.$summary_container.on(\"click\", \".email-btn\", () => {\n\t\t\tthis.email_dialog.fields_dict.email_id.set_value(\n\t\t\t\tthis.customer_email,\n\t\t\t);\n\t\t\tthis.email_dialog.show();\n\t\t});\n\n\t\tthis.$summary_container.on(\"click\", \".print-btn\", () => {\n\t\t\tthis.print_receipt();\n\t\t});\n\t}\n\n\tprint_receipt() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrappe.utils.print(\n\t\t\tthis.doc.doctype,\n\t\t\tthis.doc.name,\n\t\t\tfrm.pos_print_format,\n\t\t\tthis.doc.letter_head,\n\t\t\tthis.doc.language || frappe.boot.lang,\n\t\t);\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? \"\u2318\" : \"Ctrl\";\n\t\tthis.$summary_container\n\t\t\t.find(\".print-btn\")\n\t\t\t.attr(\"title\", `${ctrl_label}+P`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+p\",\n\t\t\taction: () => this.$summary_container.find(\".print-btn\").click(),\n\t\t\tcondition: () =>\n\t\t\t\tthis.$component.is(\":visible\") &&\n\t\t\t\tthis.$summary_container.find(\".print-btn\").is(\":visible\"),\n\t\t\tdescription: __(\"Print Receipt\"),\n\t\t\tpage: cur_page.page.page,\n\t\t});\n\t\tthis.$summary_container\n\t\t\t.find(\".new-btn\")\n\t\t\t.attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.on(\"ctrl+enter\", () => {\n\t\t\tconst summary_is_visible = this.$component.is(\":visible\");\n\t\t\tif (\n\t\t\t\tsummary_is_visible &&\n\t\t\t\tthis.$summary_container.find(\".new-btn\").is(\":visible\")\n\t\t\t) {\n\t\t\t\tthis.$summary_container.find(\".new-btn\").click();\n\t\t\t}\n\t\t});\n\t\tthis.$summary_container\n\t\t\t.find(\".edit-btn\")\n\t\t\t.attr(\"title\", `${ctrl_label}+E`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+e\",\n\t\t\taction: () => this.$summary_container.find(\".edit-btn\").click(),\n\t\t\tcondition: () =>\n\t\t\t\tthis.$component.is(\":visible\") &&\n\t\t\t\tthis.$summary_container.find(\".edit-btn\").is(\":visible\"),\n\t\t\tdescription: __(\"Edit Receipt\"),\n\t\t\tpage: cur_page.page.page,\n\t\t});\n\t}\n\n\tsend_email() {\n\t\tconst frm = this.events.get_frm();\n\t\tconst recipients = this.email_dialog.get_values().email_id;\n\t\tconst content = this.email_dialog.get_values().content;\n\t\tconst doc = this.doc || frm.doc;\n\t\tconst print_format = frm.pos_print_format;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.communication.email.make\",\n\t\t\targs: {\n\t\t\t\trecipients: recipients,\n\t\t\t\tsubject: __(frm.meta.name) + \": \" + doc.name,\n\t\t\t\tcontent: content\n\t\t\t\t\t? content\n\t\t\t\t\t: __(frm.meta.name) + \": \" + doc.name,\n\t\t\t\tdoctype: doc.doctype,\n\t\t\t\tname: doc.name,\n\t\t\t\tsend_email: 1,\n\t\t\t\tprint_format,\n\t\t\t\tsender_full_name: frappe.user.full_name(),\n\t\t\t\t_lang: doc.language,\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.utils.play_sound(\"email\");\n\t\t\t\t\tif (r.message[\"emails_not_sent_to\"]) {\n\t\t\t\t\t\tfrappe.msgprint(\n\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\"Email not sent to {0} (unsubscribed / disabled)\",\n\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\tfrappe.utils.escape_html(\n\t\t\t\t\t\t\t\t\t\tr.message[\"emails_not_sent_to\"],\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"Email sent successfully.\"),\n\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.email_dialog.hide();\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\"There were errors while sending email. Please try again.\",\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tadd_summary_btns(map) {\n\t\tthis.$summary_btns.html(\"\");\n\t\tmap.forEach((m) => {\n\t\t\tif (m.condition) {\n\t\t\t\tm.visible_btns.forEach((b) => {\n\t\t\t\t\tconst class_name = b.split(\" \")[0].toLowerCase();\n\t\t\t\t\tconst btn = __(b);\n\t\t\t\t\tthis.$summary_btns.append(\n\t\t\t\t\t\t`<div class=\"summary-btn btn btn-default ${class_name}-btn\">${btn}</div>`,\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis.$summary_btns.children().last().removeClass(\"mr-4\");\n\t}\n\n\ttoggle_summary_placeholder(show) {\n\t\tif (show) {\n\t\t\tthis.$summary_wrapper.css(\"display\", \"none\");\n\t\t\tthis.$component\n\t\t\t\t.find(\".no-summary-placeholder\")\n\t\t\t\t.css(\"display\", \"flex\");\n\t\t} else {\n\t\t\tthis.$summary_wrapper.css(\"display\", \"flex\");\n\t\t\tthis.$component\n\t\t\t\t.find(\".no-summary-placeholder\")\n\t\t\t\t.css(\"display\", \"none\");\n\t\t}\n\t}\n\n\tget_condition_btn_map(after_submission) {\n\t\tif (after_submission)\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tcondition: true,\n\t\t\t\t\tvisible_btns: [\n\t\t\t\t\t\t\"Print Receipt\",\n\t\t\t\t\t\t\"Email Receipt\",\n\t\t\t\t\t\t\"New Order\",\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t];\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tcondition: this.doc.docstatus === 0,\n\t\t\t\tvisible_btns: [\"Edit Order\", \"Delete Order\"],\n\t\t\t},\n\t\t\t{\n\t\t\t\tcondition: !this.doc.is_return && this.doc.docstatus === 1,\n\t\t\t\tvisible_btns: [\"Print Receipt\", \"Email Receipt\", \"Return\"],\n\t\t\t},\n\t\t\t{\n\t\t\t\tcondition: this.doc.is_return && this.doc.docstatus === 1,\n\t\t\t\tvisible_btns: [\"Print Receipt\", \"Email Receipt\"],\n\t\t\t},\n\t\t];\n\t}\n\n\tload_summary_of(doc, after_submission = false) {\n\t\tafter_submission\n\t\t\t? this.$component.css(\"grid-column\", \"span 10 / span 10\")\n\t\t\t: this.$component.css(\"grid-column\", \"span 6 / span 6\");\n\n\t\tthis.toggle_summary_placeholder(false);\n\n\t\tthis.doc = doc;\n\n\t\tthis.attach_document_info(doc);\n\n\t\tthis.attach_items_info(doc);\n\n\t\tthis.attach_totals_info(doc);\n\n\t\tthis.attach_payments_info(doc);\n\n\t\tconst condition_btns_map = this.get_condition_btn_map(after_submission);\n\n\t\tthis.add_summary_btns(condition_btns_map);\n\n\t\tif (after_submission) {\n\t\t\tthis.print_receipt_on_order_complete();\n\t\t}\n\t}\n\n\tattach_document_info(doc) {\n\t\tfrappe.db\n\t\t\t.get_value(\"Customer\", this.doc.customer, \"email_id\")\n\t\t\t.then(({ message }) => {\n\t\t\t\tthis.customer_email = message.email_id || \"\";\n\t\t\t\tconst upper_section_dom = this.get_upper_section_html(doc);\n\t\t\t\tthis.$upper_section.html(upper_section_dom);\n\t\t\t});\n\t}\n\n\tattach_items_info(doc) {\n\t\tthis.$items_container.html(\"\");\n\t\tdoc.items.forEach((item) => {\n\t\t\tconst item_dom = this.get_item_html(doc, item);\n\t\t\tthis.$items_container.append(item_dom);\n\t\t\tthis.set_dynamic_rate_header_width();\n\t\t});\n\t}\n\n\tset_dynamic_rate_header_width() {\n\t\tconst rate_cols = Array.from(\n\t\t\tthis.$items_container.find(\".item-rate-disc\"),\n\t\t);\n\t\tthis.$items_container.find(\".item-rate-disc\").css(\"width\", \"\");\n\t\tlet max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\tif ($(elm).width() > max_width) max_width = $(elm).width();\n\t\t\treturn max_width;\n\t\t}, 0);\n\n\t\tmax_width += 1;\n\t\tif (max_width == 1) max_width = \"\";\n\n\t\tthis.$items_container.find(\".item-rate-disc\").css(\"width\", max_width);\n\t}\n\n\tattach_payments_info(doc) {\n\t\tthis.$payment_container.html(\"\");\n\t\tdoc.payments.forEach((p) => {\n\t\t\tif (p.amount) {\n\t\t\t\tconst payment_dom = this.get_payment_html(doc, p);\n\t\t\t\tthis.$payment_container.append(payment_dom);\n\t\t\t}\n\t\t});\n\t\tif (doc.redeem_loyalty_points && doc.loyalty_amount) {\n\t\t\tconst payment_dom = this.get_payment_html(doc, {\n\t\t\t\tmode_of_payment: \"Loyalty Points\",\n\t\t\t\tamount: doc.loyalty_amount,\n\t\t\t});\n\t\t\tthis.$payment_container.append(payment_dom);\n\t\t}\n\t}\n\n\tattach_totals_info(doc) {\n\t\tthis.$totals_container.html(\"\");\n\n\t\tconst net_total_dom = this.get_net_total_html(doc);\n\t\tconst taxes_dom = this.get_taxes_html(doc);\n\t\tconst discount_dom = this.get_discount_html(doc);\n\t\tconst grand_total_dom = this.get_grand_total_html(doc);\n\t\tthis.$totals_container.append(net_total_dom);\n\t\tthis.$totals_container.append(taxes_dom);\n\t\tthis.$totals_container.append(discount_dom);\n\t\tthis.$totals_container.append(grand_total_dom);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow\n\t\t\t? this.$component.css(\"display\", \"flex\")\n\t\t\t: this.$component.css(\"display\", \"none\");\n\t}\n\n\tasync print_receipt_on_order_complete() {\n\t\tconst res = await frappe.db.get_value(\n\t\t\t\"POS Profile\",\n\t\t\tthis.pos_profile,\n\t\t\t\"print_receipt_on_order_complete\",\n\t\t);\n\n\t\tif (res.message.print_receipt_on_order_complete) {\n\t\t\tthis.print_receipt();\n\t\t}\n\t}\n};\n", "/* global edp_online_vehicles */\n\nedp_online_vehicles.PartOrder.Controller = class {\n\tconstructor(wrapper) {\n\t\tthis.wrapper = $(wrapper).find(\".layout-main-section\");\n\t\tthis.page = wrapper.page;\n\n\t\tthis.check_opening_entry();\n\t}\n\n\tfetch_opening_entry() {\n\t\treturn frappe.call(\n\t\t\t\"edp_online_vehicles.edp_online_vehicles.page.part_order_1.point_of_sale.check_opening_entry\",\n\t\t\t{\n\t\t\t\tuser: frappe.session.user,\n\t\t\t},\n\t\t);\n\t}\n\n\tcheck_opening_entry() {\n\t\tthis.prepare_app_defaults();\n\t}\n\n\tcreate_opening_voucher() {\n\t\tconst me = this;\n\t\tconst table_fields = [\n\t\t\t{\n\t\t\t\tfieldname: \"mode_of_payment\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tin_list_view: 1,\n\t\t\t\tlabel: __(\"Mode of Payment\"),\n\t\t\t\toptions: \"Mode of Payment\",\n\t\t\t\treqd: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"opening_amount\",\n\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\tin_list_view: 1,\n\t\t\t\tlabel: __(\"Opening Amount\"),\n\t\t\t\toptions: \"company:company_currency\",\n\t\t\t\tchange: function () {\n\t\t\t\t\tdialog.fields_dict.balance_details.df.data.some((d) => {\n\t\t\t\t\t\tif (d.idx == this.doc.idx) {\n\t\t\t\t\t\t\td.opening_amount = this.value;\n\t\t\t\t\t\t\tdialog.fields_dict.balance_details.grid.refresh();\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\t\tconst fetch_pos_payment_methods = () => {\n\t\t\tconst pos_profile = dialog.fields_dict.pos_profile.get_value();\n\t\t\tif (!pos_profile) return;\n\t\t\tfrappe.db\n\t\t\t\t.get_doc(\"POS Profile\", pos_profile)\n\t\t\t\t.then(({ payments }) => {\n\t\t\t\t\tdialog.fields_dict.balance_details.df.data = [];\n\t\t\t\t\tpayments.forEach((pay) => {\n\t\t\t\t\t\tconst { mode_of_payment } = pay;\n\t\t\t\t\t\tdialog.fields_dict.balance_details.df.data.push({\n\t\t\t\t\t\t\tmode_of_payment,\n\t\t\t\t\t\t\topening_amount: \"0\",\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tdialog.fields_dict.balance_details.grid.refresh();\n\t\t\t\t});\n\t\t};\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Create POS Opening Entry\"),\n\t\t\tstatic: true,\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\tlabel: __(\"Company\"),\n\t\t\t\t\tdefault: frappe.defaults.get_default(\"company\"),\n\t\t\t\t\toptions: \"Company\",\n\t\t\t\t\tfieldname: \"company\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\tlabel: __(\"POS Profile\"),\n\t\t\t\t\toptions: \"POS Profile\",\n\t\t\t\t\tfieldname: \"pos_profile\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tget_query: () => pos_profile_query(),\n\t\t\t\t\tonchange: () => fetch_pos_payment_methods(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"balance_details\",\n\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\tlabel: __(\"Opening Balance Details\"),\n\t\t\t\t\tcannot_add_rows: false,\n\t\t\t\t\tin_place_edit: true,\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdata: [],\n\t\t\t\t\tfields: table_fields,\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action: async function ({\n\t\t\t\tcompany,\n\t\t\t\tpos_profile,\n\t\t\t\tbalance_details,\n\t\t\t}) {\n\t\t\t\tif (!balance_details.length) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t\"Please add Mode of payments and opening balance details.\",\n\t\t\t\t\t\t),\n\t\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\t});\n\t\t\t\t\treturn frappe.utils.play_sound(\"error\");\n\t\t\t\t}\n\n\t\t\t\t// filter balance details for empty rows\n\t\t\t\tbalance_details = balance_details.filter(\n\t\t\t\t\t(d) => d.mode_of_payment,\n\t\t\t\t);\n\n\t\t\t\tconst method =\n\t\t\t\t\t\"erpnext.selling.page.point_of_sale.point_of_sale.create_opening_voucher\";\n\t\t\t\tconst res = await frappe.call({\n\t\t\t\t\tmethod,\n\t\t\t\t\targs: { pos_profile, company, balance_details },\n\t\t\t\t\tfreeze: true,\n\t\t\t\t});\n\t\t\t\t!res.exc && me.prepare_app_defaults(res.message);\n\t\t\t\tdialog.hide();\n\t\t\t},\n\t\t\tprimary_action_label: __(\"Submit\"),\n\t\t});\n\t\tdialog.show();\n\t\tconst pos_profile_query = () => {\n\t\t\treturn {\n\t\t\t\tquery: \"erpnext.accounts.doctype.pos_profile.pos_profile.pos_profile_query\",\n\t\t\t\tfilters: { company: dialog.fields_dict.company.get_value() },\n\t\t\t};\n\t\t};\n\t}\n\n\tasync prepare_app_defaults(data) {\n\t\t// this.pos_opening = data.name;\n\t\t// this.company = data.company;\n\t\t// this.pos_profile = data.pos_profile;\n\t\t// this.pos_opening_time = data.period_start_date;\n\t\t// this.item_stock_map = {};\n\t\tthis.settings = {};\n\n\t\tfrappe.db\n\t\t\t.get_value(\"Stock Settings\", undefined, \"allow_negative_stock\")\n\t\t\t.then(({ message }) => {\n\t\t\t\tthis.allow_negative_stock =\n\t\t\t\t\tflt(message.allow_negative_stock) || false;\n\t\t\t});\n\n\t\tthis.make_app();\n\n\t\t// frappe.call({\n\t\t// \tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.get_pos_profile_data\",\n\t\t// \targs: { pos_profile: this.pos_profile },\n\t\t// \tcallback: (res) => {\n\t\t// \t\tconst profile = res.message;\n\t\t// \t\tObject.assign(this.settings, profile);\n\t\t// \t\tthis.settings.customer_groups = profile.customer_groups.map((group) => group.name);\n\n\t\t// \t},\n\t\t// });\n\t}\n\n\tset_opening_entry_status() {\n\t\tthis.page.set_title_sub(\n\t\t\t`<span class=\"indicator orange\">\n\t\t\t\t<a class=\"text-muted\" href=\"#Form/POS%20Opening%20Entry/${this.pos_opening}\">\n\t\t\t\t\tOpened at ${frappe.datetime.str_to_user(this.pos_opening_time)}\n\t\t\t\t</a>\n\t\t\t</span>`,\n\t\t);\n\t}\n\n\tmake_app() {\n\t\tlet route_options = frappe.route_options;\n\n\t\tthis.prepare_dom();\n\t\tthis.prepare_components();\n\t\tthis.prepare_menu();\n\t\tthis.prepare_fullscreen_btn();\n\t\tthis.make_new_invoice().then(() => {\n\t\t\tthis.check_route_options(route_options);\n\t\t});\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(`<div class=\"part-order-app\"></div>`);\n\n\t\tthis.$components_wrapper = this.wrapper.find(\".part-order-app\");\n\t}\n\n\tprepare_components() {\n\t\tthis.init_item_selector();\n\t\tthis.init_item_details();\n\t\tthis.init_item_cart();\n\t\tthis.init_payments();\n\t\tthis.init_recent_order_list();\n\t\tthis.init_order_summary();\n\t}\n\n\tcheck_route_options(route_options) {\n\t\tif (route_options && route_options.parts) {\n\t\t\tlet items = route_options.parts;\n\n\t\t\tconsole.log(items);\n\n\t\t\t// Clear the route options so this check only runs once\n\t\t\tfrappe.route_options = null;\n\n\t\t\t// Loop through each declined item and call on_cart_update\n\t\t\titems.forEach((item) => {\n\t\t\t\tthis.on_cart_update({\n\t\t\t\t\tfield: \"qty\",\n\t\t\t\t\tvalue: item.qty,\n\t\t\t\t\titem: item,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tprepare_menu() {\n\t\tthis.page.clear_menu();\n\n\t\tthis.page.add_menu_item(\n\t\t\t__(\"Open Form View\"),\n\t\t\tthis.open_form_view.bind(this),\n\t\t\tfalse,\n\t\t\t\"Ctrl+F\",\n\t\t);\n\t}\n\n\tprepare_fullscreen_btn() {\n\t\tthis.page.page_actions.find(\".custom-actions\").empty();\n\n\t\tthis.page.add_button(__(\"Full Screen\"), null, {\n\t\t\tbtn_class: \"btn-default fullscreen-btn\",\n\t\t});\n\n\t\tthis.bind_fullscreen_events();\n\t}\n\n\tbind_fullscreen_events() {\n\t\tthis.$fullscreen_btn = this.page.page_actions.find(\".fullscreen-btn\");\n\n\t\tthis.$fullscreen_btn.on(\"click\", function () {\n\t\t\tif (!document.fullscreenElement) {\n\t\t\t\tdocument.documentElement.requestFullscreen();\n\t\t\t} else if (document.exitFullscreen) {\n\t\t\t\tdocument.exitFullscreen();\n\t\t\t}\n\t\t});\n\n\t\t$(document).on(\n\t\t\t\"fullscreenchange\",\n\t\t\tthis.handle_fullscreen_change_event.bind(this),\n\t\t);\n\t}\n\n\thandle_fullscreen_change_event() {\n\t\tlet enable_fullscreen_label = __(\"Full Screen\");\n\t\tlet exit_fullscreen_label = __(\"Exit Full Screen\");\n\n\t\tif (document.fullscreenElement) {\n\t\t\tthis.$fullscreen_btn[0].innerText = exit_fullscreen_label;\n\t\t} else {\n\t\t\tthis.$fullscreen_btn[0].innerText = enable_fullscreen_label;\n\t\t}\n\t}\n\n\topen_form_view() {\n\t\tfrappe.model.sync(this.frm.doc);\n\t\tfrappe.set_route(\"Form\", this.frm.doc.doctype, this.frm.doc.name);\n\t}\n\n\ttoggle_recent_order() {\n\t\tconst show = this.recent_order_list.$component.is(\":hidden\");\n\t\tthis.toggle_recent_order_list(show);\n\t}\n\n\tsave_draft_invoice() {\n\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\n\t\tif (this.frm.doc.items.length == 0) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\n\t\t\t\t\t\"You must add atleast one item to save it as draft.\",\n\t\t\t\t),\n\t\t\t\tindicator: \"red\",\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.frm\n\t\t\t.save(undefined, undefined, undefined, () => {\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"There was an error saving the document.\"),\n\t\t\t\t\tindicator: \"red\",\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t\t() => this.make_new_invoice(),\n\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t]);\n\t\t\t});\n\t}\n\n\tclose_pos() {\n\t\t// if (!this.$components_wrapper.is(\":visible\")) return;\n\t\t// let voucher = frappe.model.get_new_doc(\"POS Closing Entry\");\n\t\t// voucher.pos_profile = this.frm.doc.pos_profile;\n\t\t// voucher.user = frappe.session.user;\n\t\t// voucher.company = this.frm.doc.company;\n\t\t// voucher.pos_opening_entry = this.pos_opening;\n\t\t// voucher.period_end_date = frappe.datetime.now_datetime();\n\t\t// voucher.posting_date = frappe.datetime.now_date();\n\t\t// voucher.posting_time = frappe.datetime.now_time();\n\t\t// frappe.set_route(\"Form\", \"POS Closing Entry\", voucher.name);\n\t}\n\n\tinit_item_selector() {\n\t\tthis.item_selector = new edp_online_vehicles.PartOrder.ItemSelector({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tpos_profile: this.pos_profile,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\titem_selected: (args) => this.on_cart_update(args),\n\n\t\t\t\tget_frm: () => this.frm || {},\n\t\t\t},\n\t\t});\n\t}\n\n\tinit_item_cart() {\n\t\tthis.cart = new edp_online_vehicles.PartOrder.ItemCart({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\tcart_item_clicked: (item) => {\n\t\t\t\t\tconst item_row = this.get_item_from_frm(item);\n\t\t\t\t\tthis.item_details.toggle_item_details_section(item_row);\n\t\t\t\t},\n\n\t\t\t\tnumpad_event: (value, action) =>\n\t\t\t\t\tthis.update_item_field(value, action),\n\n\t\t\t\tcheckout: () => this.save_and_checkout(),\n\n\t\t\t\tedit_cart: () => this.payment.edit_cart(),\n\n\t\t\t\tcustomer_details_updated: (details) => {\n\t\t\t\t\tthis.item_selector.load_items_data();\n\t\t\t\t\tthis.customer_details = details;\n\t\t\t\t\t// will add/remove LP payment method\n\t\t\t\t\tthis.payment.render_loyalty_points_payment_mode();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tinit_item_details() {\n\t\tthis.item_details = new edp_online_vehicles.PartOrder.ItemDetails({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\ttoggle_item_selector: (minimize) => {\n\t\t\t\t\tthis.item_selector.resize_selector(minimize);\n\t\t\t\t\tthis.cart.toggle_numpad(minimize);\n\t\t\t\t},\n\n\t\t\t\tform_updated: (item, field, value) => {\n\t\t\t\t\tconst item_row = frappe.model.get_doc(\n\t\t\t\t\t\titem.doctype,\n\t\t\t\t\t\titem.name,\n\t\t\t\t\t);\n\t\t\t\t\tif (item_row && item_row[field] != value) {\n\t\t\t\t\t\tconst args = {\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\titem: this.item_details.current_item,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\treturn this.on_cart_update(args);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t},\n\n\t\t\t\thighlight_cart_item: (item) => {\n\t\t\t\t\tconst cart_item = this.cart.get_cart_item(item);\n\t\t\t\t\tthis.cart.toggle_item_highlight(cart_item);\n\t\t\t\t},\n\n\t\t\t\titem_field_focused: (fieldname) => {\n\t\t\t\t\tthis.cart.toggle_numpad_field_edit(fieldname);\n\t\t\t\t},\n\t\t\t\tset_value_in_current_cart_item: (selector, value) => {\n\t\t\t\t\tthis.cart.update_selector_value_in_cart_item(\n\t\t\t\t\t\tselector,\n\t\t\t\t\t\tvalue,\n\t\t\t\t\t\tthis.item_details.current_item,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tclone_new_batch_item_in_frm: (batch_serial_map, item) => {\n\t\t\t\t\t// called if serial nos are 'auto_selected' and if those serial nos belongs to multiple batches\n\t\t\t\t\t// for each unique batch new item row is added in the form & cart\n\t\t\t\t\tObject.keys(batch_serial_map).forEach((batch) => {\n\t\t\t\t\t\tconst item_to_clone = this.frm.doc.items.find(\n\t\t\t\t\t\t\t(i) => i.name == item.name,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst new_row = this.frm.add_child(\"items\", {\n\t\t\t\t\t\t\t...item_to_clone,\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// update new serialno and batch\n\t\t\t\t\t\tnew_row.batch_no = batch;\n\t\t\t\t\t\tnew_row.serial_no = batch_serial_map[batch].join(`\\n`);\n\t\t\t\t\t\tnew_row.qty = batch_serial_map[batch].length;\n\t\t\t\t\t\tthis.frm.doc.items.forEach((row) => {\n\t\t\t\t\t\t\tif (item.item_code === row.item_code) {\n\t\t\t\t\t\t\t\tthis.update_cart_html(row);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremove_item_from_cart: () => this.remove_item_from_cart(),\n\t\t\t\tget_item_stock_map: () => this.item_stock_map,\n\t\t\t\tclose_item_details: () => {\n\t\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\t\tthis.cart.prev_action = null;\n\t\t\t\t\tthis.cart.toggle_item_highlight();\n\t\t\t\t},\n\t\t\t\tget_available_stock: (item_code, warehouse) =>\n\t\t\t\t\tthis.get_available_stock(item_code, warehouse),\n\t\t\t},\n\t\t});\n\t}\n\n\tinit_payments() {\n\t\tthis.payment = new edp_online_vehicles.PartOrder.Payment({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm || {},\n\n\t\t\t\tget_customer_details: () => this.customer_details || {},\n\n\t\t\t\ttoggle_other_sections: (show) => {\n\t\t\t\t\tif (show) {\n\t\t\t\t\t\tthis.item_details.$component.is(\":visible\")\n\t\t\t\t\t\t\t? this.item_details.$component.css(\n\t\t\t\t\t\t\t\t\t\"display\",\n\t\t\t\t\t\t\t\t\t\"none\",\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: \"\";\n\t\t\t\t\t\tthis.item_selector.toggle_component(false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.item_selector.toggle_component(true);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tsubmit_invoice: () => {\n\t\t\t\t\tthis.frm.savesubmit().then((r) => {\n\t\t\t\t\t\tthis.toggle_components(false);\n\t\t\t\t\t\tthis.order_summary.toggle_component(true);\n\t\t\t\t\t\tthis.order_summary.load_summary_of(this.frm.doc, true);\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t\tmessage: __(\"Part Order {0} created succesfully\", [\n\t\t\t\t\t\t\t\tr.doc.name,\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tinit_recent_order_list() {\n\t\tthis.recent_order_list =\n\t\t\tnew edp_online_vehicles.PartOrder.PastOrderList({\n\t\t\t\twrapper: this.$components_wrapper,\n\t\t\t\tevents: {\n\t\t\t\t\topen_invoice_data: (name) => {\n\t\t\t\t\t\tfrappe.db.get_doc(\"Part Order\", name).then((doc) => {\n\t\t\t\t\t\t\tthis.order_summary.load_summary_of(doc);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\treset_summary: () =>\n\t\t\t\t\t\tthis.order_summary.toggle_summary_placeholder(true),\n\t\t\t\t},\n\t\t\t});\n\t}\n\n\tinit_order_summary() {\n\t\tthis.order_summary = new edp_online_vehicles.PartOrder.PastOrderSummary(\n\t\t\t{\n\t\t\t\twrapper: this.$components_wrapper,\n\t\t\t\tevents: {\n\t\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\t\tprocess_return: (name) => {\n\t\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\t\tfrappe.db.get_doc(\"Part Order\", name).then((doc) => {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => this.make_return_invoice(doc),\n\t\t\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t\t\t() => this.item_selector.toggle_component(true),\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tedit_order: (name) => {\n\t\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => this.frm.refresh(name),\n\t\t\t\t\t\t\t() => this.frm.call(\"reset_mode_of_payments\"),\n\t\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t\t() => this.item_selector.toggle_component(true),\n\t\t\t\t\t\t]);\n\t\t\t\t\t},\n\t\t\t\t\tdelete_order: (name) => {\n\t\t\t\t\t\tfrappe.model.delete_doc(\n\t\t\t\t\t\t\tthis.frm.doc.doctype,\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tthis.recent_order_list.refresh_list();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\tnew_order: () => {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t\t\t\t() => this.make_new_invoice(),\n\t\t\t\t\t\t\t() => this.item_selector.toggle_component(true),\n\t\t\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t\t\t]);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tpos_profile: this.pos_profile,\n\t\t\t},\n\t\t);\n\t}\n\n\ttoggle_recent_order_list(show) {\n\t\tthis.toggle_components(!show);\n\t\tthis.recent_order_list.toggle_component(show);\n\t\tthis.order_summary.toggle_component(show);\n\t}\n\n\ttoggle_components(show) {\n\t\tthis.cart.toggle_component(show);\n\t\tthis.item_selector.toggle_component(show);\n\n\t\t// do not show item details or payment if recent order is toggled off\n\t\t!show\n\t\t\t? this.item_details.toggle_component(false) ||\n\t\t\t\tthis.payment.toggle_component(false)\n\t\t\t: \"\";\n\t}\n\n\tmake_new_invoice() {\n\t\treturn frappe.run_serially([\n\t\t\t() => frappe.dom.freeze(),\n\t\t\t() => this.make_sales_invoice_frm(),\n\t\t\t() => this.set_pos_profile_data(),\n\t\t\t() => this.set_pos_profile_status(),\n\t\t\t() => this.cart.load_invoice(),\n\t\t\t() => frappe.dom.unfreeze(),\n\t\t]);\n\t}\n\n\tmake_sales_invoice_frm() {\n\t\tconst doctype = \"Part Order\";\n\t\treturn new Promise((resolve) => {\n\t\t\tif (this.frm) {\n\t\t\t\tthis.frm = this.get_new_frm(this.frm);\n\t\t\t\tthis.frm.doc.table_avsu = [];\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\t\t\tthis.frm = this.get_new_frm();\n\t\t\t\t\tthis.frm.doc.items = [];\n\t\t\t\t\tthis.frm.doc.is_pos = 1;\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget_new_frm(_frm) {\n\t\tconst doctype = \"Part Order\";\n\t\tconst page = $(\"<div>\");\n\t\tconst frm = _frm || new frappe.ui.form.Form(doctype, page, false);\n\t\tconst name = frappe.model.make_new_doc_and_get_name(doctype, true);\n\t\tfrm.refresh(name);\n\n\t\treturn frm;\n\t}\n\n\tasync make_return_invoice(doc) {\n\t\tfrappe.dom.freeze();\n\t\tthis.frm = this.get_new_frm(this.frm);\n\t\tthis.frm.doc.items = [];\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pos_invoice.pos_invoice.make_sales_return\",\n\t\t\targs: {\n\t\t\t\tsource_name: doc.name,\n\t\t\t\ttarget_doc: this.frm.doc,\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tfrappe.model.sync(r.message);\n\t\t\t\tfrappe.get_doc(\n\t\t\t\t\tr.message.doctype,\n\t\t\t\t\tr.message.name,\n\t\t\t\t).__run_link_triggers = false;\n\t\t\t\tthis.set_pos_profile_data().then(() => {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\t}\n\n\tset_pos_profile_data() {\n\t\tif (this.company && !this.frm.doc.company)\n\t\t\tthis.frm.doc.company = this.company;\n\t\tif (\n\t\t\t(this.pos_profile && !this.frm.doc.pos_profile) |\n\t\t\t(this.frm.doc.is_return &&\n\t\t\t\tthis.pos_profile != this.frm.doc.pos_profile)\n\t\t) {\n\t\t\tthis.frm.doc.pos_profile = this.pos_profile;\n\t\t}\n\n\t\tif (!this.frm.doc.company) return;\n\n\t\treturn this.frm.trigger(\"set_pos_data\");\n\t}\n\n\tset_pos_profile_status() {\n\t\t// this.page.set_indicator(this.pos_profile, \"blue\");\n\t}\n\n\tasync on_cart_update(args) {\n\t\tconsole.log(args);\n\n\t\tfrappe.dom.freeze();\n\t\tif (this.frm.doc.set_warehouse != this.settings.warehouse)\n\t\t\tthis.frm.doc.set_warehouse = this.settings.warehouse;\n\t\tlet item_row = undefined;\n\t\ttry {\n\t\t\tlet { field, value, item } = args;\n\t\t\tlet { dealer_company } = item;\n\n\t\t\tif (dealer_company == undefined) {\n\t\t\t\tlet { dealer } = item;\n\t\t\t\tdealer_company = dealer;\n\t\t\t}\n\n\t\t\t// Function to find an item row with the same part_no and dealer\n\t\t\tconst find_item_row = (part_no, dealer) => {\n\t\t\t\treturn this.frm.doc.table_avsu.find(\n\t\t\t\t\t(row) => row.part_no === part_no && row.dealer === dealer,\n\t\t\t\t);\n\t\t\t};\n\n\t\t\t// Attempt to find an existing item row with the same part_no and dealer\n\t\t\titem_row = find_item_row(item.part_no, dealer_company);\n\n\t\t\tconst item_row_exists = item_row !== undefined;\n\n\t\t\tconst from_selector = field === \"qty\" && value === \"+1\";\n\t\t\tif (from_selector) value = flt(item_row?.qty || 0) + flt(value);\n\n\t\t\tif (item_row_exists) {\n\t\t\t\tif (item.dealer_ordered_qty > 0) {\n\t\t\t\t\tif (field === \"qty\")\n\t\t\t\t\t\tvalue += flt(item.dealer_ordered_qty) - 1;\n\t\t\t\t} else {\n\t\t\t\t\tif (field === \"qty\") value = flt(value);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\t[\"qty\", \"conversion_factor\"].includes(field) &&\n\t\t\t\t\tvalue > 0 &&\n\t\t\t\t\t!this.allow_negative_stock\n\t\t\t\t) {\n\t\t\t\t\tconst qty_needed =\n\t\t\t\t\t\tfield === \"qty\"\n\t\t\t\t\t\t\t? value * item_row.conversion_factor\n\t\t\t\t\t\t\t: item_row.qty * value;\n\t\t\t\t\tawait this.check_stock_availability(\n\t\t\t\t\t\titem_row,\n\t\t\t\t\t\tqty_needed,\n\t\t\t\t\t\tthis.frm.doc.set_warehouse,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tthis.is_current_item_being_edited(item_row) ||\n\t\t\t\t\tfrom_selector\n\t\t\t\t) {\n\t\t\t\t\tawait frappe.model.set_value(\n\t\t\t\t\t\titem_row.doctype,\n\t\t\t\t\t\titem_row.name,\n\t\t\t\t\t\tfield,\n\t\t\t\t\t\tvalue,\n\t\t\t\t\t);\n\t\t\t\t\tthis.update_cart_html(item_row);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet {\n\t\t\t\t\tpart_no,\n\t\t\t\t\tbatch_no,\n\t\t\t\t\tserial_no,\n\t\t\t\t\tuom,\n\t\t\t\t\trate,\n\t\t\t\t\tstock_uom,\n\t\t\t\t\titem_name,\n\t\t\t\t\titem_image,\n\t\t\t\t\tdealer_ordered_qty,\n\t\t\t\t\tbackorder,\n\t\t\t\t\tdealer_billing_excl,\n\t\t\t\t\tstatus,\n\t\t\t\t\timage,\n\t\t\t\t\tdescription,\n\t\t\t\t\tparenttype,\n\t\t\t\t\tpart,\n\t\t\t\t\tqty,\n\t\t\t\t\tprice,\n\t\t\t\t} = item;\n\n\t\t\t\tif (!part_no) {\n\t\t\t\t\tpart_no = part;\n\n\t\t\t\t\tif (!part_no) return;\n\t\t\t\t}\n\n\t\t\t\tif (rate == undefined || rate == 0) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tdealer_billing_excl == undefined ||\n\t\t\t\t\t\tdealer_billing_excl == 0\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (price == undefined || price == 0) {\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"Price is not set for the item.\"),\n\t\t\t\t\t\t\t\tindicator: \"orange\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (description == undefined || description == \"\") {\n\t\t\t\t\tdescription = item_name;\n\t\t\t\t}\n\t\t\t\tlet new_item = {};\n\t\t\t\tlet order_from = \"\";\n\t\t\t\tlet dealer = dealer_company || \"\";\n\n\t\t\t\tif (status == \"Declined\") {\n\t\t\t\t\tawait frappe.call({\n\t\t\t\t\t\tmethod: \"edp_online_vehicles.events.get_hq_company.get_hq_company\",\n\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\tbackorder = true;\n\t\t\t\t\t\t\t\titem_image = image;\n\t\t\t\t\t\t\t\torder_from = \"BackOrder\";\n\t\t\t\t\t\t\t\tdealer = r.message;\n\t\t\t\t\t\t\t\tdealer_ordered_qty = value;\n\t\t\t\t\t\t\t\tnew_item = {\n\t\t\t\t\t\t\t\t\tpart_no,\n\t\t\t\t\t\t\t\t\tdescription,\n\t\t\t\t\t\t\t\t\t[field]: value,\n\t\t\t\t\t\t\t\t\titem_image,\n\t\t\t\t\t\t\t\t\torder_from,\n\t\t\t\t\t\t\t\t\tbackorder,\n\t\t\t\t\t\t\t\t\tdealer,\n\t\t\t\t\t\t\t\t\tdealer_ordered_qty,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tif (parenttype == \"Catalogue\") {\n\t\t\t\t\t\tawait frappe.call({\n\t\t\t\t\t\t\tmethod: \"edp_online_vehicles.events.get_hq_company.get_data_for_catalogue\",\n\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\tpart_no: part,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\t\tdealer = r.message[0];\n\t\t\t\t\t\t\t\t\tbackorder = false;\n\t\t\t\t\t\t\t\t\titem_image = r.message[1];\n\t\t\t\t\t\t\t\t\torder_from = \"Warehouse\";\n\t\t\t\t\t\t\t\t\tpart_no = part;\n\n\t\t\t\t\t\t\t\t\tnew_item = {\n\t\t\t\t\t\t\t\t\t\tpart_no,\n\t\t\t\t\t\t\t\t\t\tdescription,\n\t\t\t\t\t\t\t\t\t\t[field]: qty,\n\t\t\t\t\t\t\t\t\t\titem_image,\n\t\t\t\t\t\t\t\t\t\torder_from,\n\t\t\t\t\t\t\t\t\t\tbackorder,\n\t\t\t\t\t\t\t\t\t\tdealer,\n\t\t\t\t\t\t\t\t\t\tdealer_ordered_qty,\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (dealer_ordered_qty > 0) {\n\t\t\t\t\t\t\tif (backorder) {\n\t\t\t\t\t\t\t\torder_from = \"BackOrder\";\n\t\t\t\t\t\t\t\tnew_item = {\n\t\t\t\t\t\t\t\t\tpart_no,\n\t\t\t\t\t\t\t\t\tdescription,\n\t\t\t\t\t\t\t\t\t[field]: dealer_ordered_qty,\n\t\t\t\t\t\t\t\t\titem_image,\n\t\t\t\t\t\t\t\t\tdealer_ordered_qty,\n\t\t\t\t\t\t\t\t\torder_from,\n\t\t\t\t\t\t\t\t\tbackorder,\n\t\t\t\t\t\t\t\t\tdealer,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\torder_from = \"Dealer\";\n\t\t\t\t\t\t\t\tnew_item = {\n\t\t\t\t\t\t\t\t\tpart_no,\n\t\t\t\t\t\t\t\t\tdescription,\n\t\t\t\t\t\t\t\t\t[field]: dealer_ordered_qty,\n\t\t\t\t\t\t\t\t\titem_image,\n\t\t\t\t\t\t\t\t\tdealer_ordered_qty,\n\t\t\t\t\t\t\t\t\torder_from,\n\t\t\t\t\t\t\t\t\tdealer,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\torder_from = \"Warehouse\";\n\t\t\t\t\t\t\tnew_item = {\n\t\t\t\t\t\t\t\tpart_no,\n\t\t\t\t\t\t\t\tdescription,\n\t\t\t\t\t\t\t\t[field]: value,\n\t\t\t\t\t\t\t\titem_image,\n\t\t\t\t\t\t\t\tdealer_ordered_qty,\n\t\t\t\t\t\t\t\trate,\n\t\t\t\t\t\t\t\torder_from,\n\t\t\t\t\t\t\t\tdealer,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (serial_no) {\n\t\t\t\t\tawait this.check_serial_no_availablilty(\n\t\t\t\t\t\tpart_no,\n\t\t\t\t\t\tthis.frm.doc.set_warehouse,\n\t\t\t\t\t\tserial_no,\n\t\t\t\t\t);\n\t\t\t\t\tnew_item[\"serial_no\"] = serial_no;\n\t\t\t\t}\n\n\t\t\t\tif (field === \"serial_no\")\n\t\t\t\t\tnew_item[\"qty\"] = value.split(`\\n`).length || 0;\n\n\t\t\t\titem_row = this.frm.add_child(\"table_avsu\", new_item);\n\n\t\t\t\tconsole.log(item_row);\n\n\t\t\t\tif (\n\t\t\t\t\tfield === \"qty\" &&\n\t\t\t\t\tvalue !== 0 &&\n\t\t\t\t\t!this.allow_negative_stock\n\t\t\t\t) {\n\t\t\t\t\tconst qty_needed = value * item_row.conversion_factor;\n\t\t\t\t\tawait this.check_stock_availability(\n\t\t\t\t\t\titem_row,\n\t\t\t\t\t\tqty_needed,\n\t\t\t\t\t\tthis.frm.doc.set_warehouse,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tawait this.trigger_new_item_events(item_row);\n\n\t\t\t\tthis.update_cart_html(item_row);\n\n\t\t\t\tif (this.item_details.$component.is(\":visible\"))\n\t\t\t\t\tthis.edit_item_details_of(item_row);\n\n\t\t\t\tif (\n\t\t\t\t\tthis.check_serial_batch_selection_needed(item_row) &&\n\t\t\t\t\t!this.item_details.$component.is(\":visible\")\n\t\t\t\t)\n\t\t\t\t\tthis.edit_item_details_of(item_row);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t} finally {\n\t\t\tfrappe.dom.unfreeze();\n\t\t}\n\t\treturn item_row;\n\t}\n\n\traise_customer_selection_alert() {\n\t\tfrappe.dom.unfreeze();\n\t\tfrappe.show_alert({\n\t\t\tmessage: __(\"You must select a customer before adding an item.\"),\n\t\t\tindicator: \"orange\",\n\t\t});\n\t\tfrappe.utils.play_sound(\"error\");\n\t}\n\n\tget_item_from_frm({ name, part_no, batch_no, uom, rate }) {\n\t\tlet item_row = null;\n\t\tif (name) {\n\t\t\titem_row = this.frm.doc.table_avsu.find((i) => i.name == name);\n\t\t} else {\n\t\t\t// if item is clicked twice from item selector\n\t\t\t// then \"part_no, batch_no, uom, rate\" will help in getting the exact item\n\t\t\t// to increase the qty by one\n\n\t\t\titem_row = this.frm.doc.table_avsu.find(\n\t\t\t\t(i) =>\n\t\t\t\t\ti.part_no === part_no &&\n\t\t\t\t\ti.dealer_billing_excl === flt(rate),\n\t\t\t);\n\t\t}\n\n\t\treturn item_row || {};\n\t}\n\n\tedit_item_details_of(item_row) {\n\t\tthis.item_details.toggle_item_details_section(item_row);\n\t}\n\n\tis_current_item_being_edited(item_row) {\n\t\treturn item_row.name == this.item_details.current_item.name;\n\t}\n\n\tasync update_cart_html(item_row, remove_item) {\n\t\tif (remove_item) {\n\t\t\tawait this.trigger_new_item_events(item_row, remove_item);\n\t\t}\n\n\t\tthis.cart.update_item_html(item_row, remove_item);\n\t\tthis.cart.update_totals_section(this.frm);\n\t}\n\n\tcheck_serial_batch_selection_needed(item_row) {\n\t\t// right now item details is shown for every type of item.\n\t\t// if item details is not shown for every item then this fn will be needed\n\t\tconst serialized = item_row.has_serial_no;\n\t\tconst batched = item_row.has_batch_no;\n\t\tconst no_serial_selected = !item_row.serial_no;\n\t\tconst no_batch_selected = !item_row.batch_no;\n\n\t\tif (\n\t\t\t(serialized && no_serial_selected) ||\n\t\t\t(batched && no_batch_selected) ||\n\t\t\t(serialized && batched && (no_batch_selected || no_serial_selected))\n\t\t) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tasync trigger_new_item_events(item_row, remove_item) {\n\t\tif (remove_item) {\n\t\t\tawait this.frm.script_manager.trigger(\n\t\t\t\t\"recalculate_totals\",\n\t\t\t\tthis.frm.doc.doctype,\n\t\t\t\tthis.frm.doc.name,\n\t\t\t);\n\t\t\tawait this.frm.script_manager.trigger(\n\t\t\t\t\"total_excl\",\n\t\t\t\tthis.frm.doc.doctype,\n\t\t\t\tthis.frm.doc.name,\n\t\t\t);\n\t\t} else {\n\t\t\tawait this.frm.script_manager.trigger(\n\t\t\t\t\"part_no\",\n\t\t\t\titem_row.doctype,\n\t\t\t\titem_row.name,\n\t\t\t);\n\t\t\tawait this.frm.script_manager.trigger(\n\t\t\t\t\"total_excl\",\n\t\t\t\titem_row.doctype,\n\t\t\t\titem_row.name,\n\t\t\t);\n\t\t\tawait this.frm.script_manager.trigger(\n\t\t\t\t\"total_excl\",\n\t\t\t\tthis.frm.doc.doctype,\n\t\t\t\tthis.frm.doc.name,\n\t\t\t);\n\t\t\tawait this.frm.script_manager.trigger(\n\t\t\t\t\"qty\",\n\t\t\t\titem_row.doctype,\n\t\t\t\titem_row.name,\n\t\t\t);\n\t\t}\n\t}\n\n\tasync check_stock_availability(item_row, qty_needed, warehouse) {\n\t\t// const resp = (await this.get_available_stock(item_row.part_no, warehouse)).message;\n\t\t// const available_qty = resp[0];\n\t\t// const is_stock_item = resp[1];\n\t\t// frappe.dom.unfreeze();\n\t\t// // const bold_uom = item_row.stock_uom.bold();\n\t\t// const bold_item_code = item_row.part_no.bold();\n\t\t// const bold_warehouse = warehouse.bold();\n\t\t// const bold_available_qty = available_qty.toString().bold();\n\t\t// if (!(available_qty > 0)) {\n\t\t// \tif (is_stock_item) {\n\t\t// \t\tfrappe.model.clear_doc(item_row.doctype, item_row.name);\n\t\t// \t\tfrappe.throw({\n\t\t// \t\t\ttitle: __(\"Not Available\"),\n\t\t// \t\t\tmessage: __(\"Item Code: {0} is not available under warehouse {1}.\", [\n\t\t// \t\t\t\tbold_item_code,\n\t\t// \t\t\t\tbold_warehouse,\n\t\t// \t\t\t]),\n\t\t// \t\t});\n\t\t// \t} else {\n\t\t// \t\treturn;\n\t\t// \t}\n\t\t// } else if (is_stock_item && available_qty < qty_needed) {\n\t\t// \tfrappe.throw({\n\t\t// \t\tmessage: __(\n\t\t// \t\t\t\"Stock quantity not enough for Item Code: {0} under warehouse {1}. Available quantity {2} {3}.\",\n\t\t// \t\t\t[bold_item_code, bold_warehouse, bold_available_qty, bold_uom]\n\t\t// \t\t),\n\t\t// \t\tindicator: \"orange\",\n\t\t// \t});\n\t\t// \tfrappe.utils.play_sound(\"error\");\n\t\t// }\n\t\t// frappe.dom.freeze();\n\t}\n\n\tasync check_serial_no_availablilty(item_code, warehouse, serial_no) {\n\t\tconst method =\n\t\t\t\"erpnext.stock.doctype.serial_no.serial_no.get_pos_reserved_serial_nos\";\n\t\tconst args = { filters: { item_code, warehouse } };\n\t\tconst res = await frappe.call({ method, args });\n\n\t\tif (res.message.includes(serial_no)) {\n\t\t\tfrappe.throw({\n\t\t\t\ttitle: __(\"Not Available\"),\n\t\t\t\tmessage: __(\n\t\t\t\t\t\"Serial No: {0} has already been transacted into another Part Order.\",\n\t\t\t\t\t[serial_no.bold()],\n\t\t\t\t),\n\t\t\t});\n\t\t}\n\t}\n\n\tget_available_stock(item_code, warehouse) {\n\t\tconst me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pos_invoice.pos_invoice.get_stock_availability\",\n\t\t\targs: {\n\t\t\t\titem_code: item_code,\n\t\t\t\twarehouse: warehouse,\n\t\t\t},\n\t\t\tcallback(res) {\n\t\t\t\tif (!me.item_stock_map[item_code])\n\t\t\t\t\tme.item_stock_map[item_code] = {};\n\t\t\t\tme.item_stock_map[item_code][warehouse] = res.message;\n\t\t\t},\n\t\t});\n\t}\n\n\tupdate_item_field(value, field_or_action) {\n\t\tif (field_or_action === \"checkout\") {\n\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t} else if (field_or_action === \"remove\") {\n\t\t\tthis.remove_item_from_cart();\n\t\t} else {\n\t\t\tconst field_control =\n\t\t\t\tthis.item_details[`${field_or_action}_control`];\n\t\t\tif (!field_control) return;\n\t\t\tfield_control.set_focus();\n\t\t\tvalue != \"\" && field_control.set_value(value);\n\t\t}\n\t}\n\n\tremove_item_from_cart() {\n\t\tfrappe.dom.freeze();\n\t\tconst { doctype, name, current_item } = this.item_details;\n\n\t\treturn frappe.model\n\t\t\t.set_value(doctype, name, \"qty\", 0)\n\t\t\t.then(() => {\n\t\t\t\tfrappe.model.clear_doc(doctype, name);\n\t\t\t\tthis.update_cart_html(current_item, true);\n\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t})\n\t\t\t.catch((e) => console.log(e));\n\t}\n\n\tasync save_and_checkout() {\n\t\tfrappe.model.sync(this.frm.doc);\n\t\tfrappe.set_route(\"Form\", this.frm.doc.doctype, this.frm.doc.name);\n\t}\n};\n"],
  "mappings": "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",
  "names": ["onScan", "precision", "onScan", "max_width", "$btn", "max_width"]
}
